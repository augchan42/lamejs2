"use strict";var Re=Object.defineProperty;var w1=Object.getOwnPropertyDescriptor;var R1=Object.getOwnPropertyNames;var E1=Object.prototype.hasOwnProperty;var kt=A=>{throw TypeError(A)};var B1=(A,e,t)=>e in A?Re(A,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):A[e]=t;var Lt=(A,e)=>{for(var t in e)Re(A,t,{get:e[t],enumerable:!0})},T1=(A,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of R1(e))!E1.call(A,n)&&n!==t&&Re(A,n,{get:()=>e[n],enumerable:!(s=w1(e,n))||s.enumerable});return A};var y1=A=>T1(Re({},"__esModule",{value:!0}),A);var S=(A,e,t)=>B1(A,typeof e!="symbol"?e+"":e,t),I1=(A,e,t)=>e.has(A)||kt("Cannot "+t);var et=(A,e,t)=>e.has(A)?kt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(A):e.set(A,t),tt=(A,e,t,s)=>(I1(A,e,"write to private field"),s?s.call(A,t):e.set(A,t),t);var vs={};Lt(vs,{MPEGMode:()=>Ee,Mp3Encoder:()=>Je});module.exports=y1(vs);var Ee=(l=>(l[l.STEREO=0]="STEREO",l[l.JOINT_STEREO=1]="JOINT_STEREO",l[l.DUAL_CHANNEL=2]="DUAL_CHANNEL",l[l.MONO=3]="MONO",l[l.NOT_SET=4]="NOT_SET",l))(Ee||{}),C0={STEREO:{value:0,ordinal:()=>0},JOINT_STEREO:{value:1,ordinal:()=>1},DUAL_CHANNEL:{value:2,ordinal:()=>2},MONO:{value:3,ordinal:()=>3},NOT_SET:{value:4,ordinal:()=>4}};var Be=class{constructor(e){this.context=e}getLameShortVersion(){return"3.100"}getLameVersion(){return"3.100"}getLameVeryShortVersion(){return"LAME3.100"}getPsyVersion(){return"0.93"}getLameUrl(){return"http://www.mp3dev.org/"}getLameOsBitness(){return"32bits"}};var G={};Lt(G,{Arrays:()=>E0,Float:()=>g0,ShortBlock:()=>o0,System:()=>c0,Util:()=>v0,VbrMode:()=>J,assert:()=>C,new_array_n:()=>J0,new_byte:()=>X0,new_double:()=>be,new_float:()=>p0,new_float_n:()=>q0,new_int:()=>N0,new_int_n:()=>$0,new_short:()=>Nt,new_short_n:()=>Ot});function X0(A){return new Int8Array(A)}function Nt(A){return new Int16Array(A)}function N0(A){return new Int32Array(A)}function p0(A){return new Float32Array(A)}function be(A){return new Float64Array(A)}function q0(A){if(A.length==1)return p0(A[0]);var e=A[0];A=A.slice(1);for(var t=[],s=0;s<e;s++)t.push(q0(A));return t}function $0(A){if(A.length==1)return N0(A[0]);var e=A[0];A=A.slice(1);for(var t=[],s=0;s<e;s++)t.push($0(A));return t}function Ot(A){if(A.length==1)return Nt(A[0]);var e=A[0];A=A.slice(1);for(var t=[],s=0;s<e;s++)t.push(Ot(A));return t}function J0(A){if(A.length==1)return new Array(A[0]);var e=A[0];A=A.slice(1);for(var t=[],s=0;s<e;s++)t.push(J0(A));return t}var E0={};E0.fill=function(A,e,t,s){if(arguments.length==2)for(var n=0;n<A.length;n++)A[n]=arguments[1];else for(var n=e;n<t;n++)A[n]=s};var c0={};c0.arraycopy=function(A,e,t,s,n){for(var l=e+n;e<l;)t[s++]=A[e++]};c0.out={};c0.out.println=function(A){console.log(A)};c0.out.printf=function(){console.log.apply(console,arguments)};var v0={};v0.SQRT2=1.4142135623730951;v0.FAST_LOG10=function(A){return Math.log10(A)};v0.FAST_LOG10_X=function(A,e){return Math.log10(A)*e};function o0(A){this.ordinal=A}o0.short_block_allowed=new o0(0);o0.short_block_coupled=new o0(1);o0.short_block_dispensed=new o0(2);o0.short_block_forced=new o0(3);var g0={};g0.MAX_VALUE=34028235e31;function J(A){this.ordinal=A}J.vbr_off=new J(0);J.vbr_mt=new J(1);J.vbr_rh=new J(2);J.vbr_abr=new J(3);J.vbr_mtrh=new J(4);J.vbr_default=J.vbr_mtrh;var C=function(A){};var k1=c0;var i0=v0,L1=E0;var N1=p0;function Ht(){var A=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*i0.SQRT2*.5/2384e-9,.017876148*i0.SQRT2*.5/2384e-9,.003134727*i0.SQRT2*.5/2384e-9,.002457142*i0.SQRT2*.5/2384e-9,971317e-9*i0.SQRT2*.5/2384e-9,218868e-9*i0.SQRT2*.5/2384e-9,101566e-9*i0.SQRT2*.5/2384e-9,13828e-9*i0.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],e=12,t=36,s=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],n=s[x.SHORT_TYPE],l=s[x.SHORT_TYPE],a=s[x.SHORT_TYPE],_=s[x.SHORT_TYPE],r=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function h(o,f,i){for(var b=10,d=f+238-14-286,v=-15;v<0;v++){var M,p,B;M=A[b+-10],p=o[d+-224]*M,B=o[f+224]*M,M=A[b+-9],p+=o[d+-160]*M,B+=o[f+160]*M,M=A[b+-8],p+=o[d+-96]*M,B+=o[f+96]*M,M=A[b+-7],p+=o[d+-32]*M,B+=o[f+32]*M,M=A[b+-6],p+=o[d+32]*M,B+=o[f+-32]*M,M=A[b+-5],p+=o[d+96]*M,B+=o[f+-96]*M,M=A[b+-4],p+=o[d+160]*M,B+=o[f+-160]*M,M=A[b+-3],p+=o[d+224]*M,B+=o[f+-224]*M,M=A[b+-2],p+=o[f+-256]*M,B-=o[d+256]*M,M=A[b+-1],p+=o[f+-192]*M,B-=o[d+192]*M,M=A[b+0],p+=o[f+-128]*M,B-=o[d+128]*M,M=A[b+1],p+=o[f+-64]*M,B-=o[d+64]*M,M=A[b+2],p+=o[f+0]*M,B-=o[d+0]*M,M=A[b+3],p+=o[f+64]*M,B-=o[d+-64]*M,M=A[b+4],p+=o[f+128]*M,B-=o[d+-128]*M,M=A[b+5],p+=o[f+192]*M,B-=o[d+-192]*M,p*=A[b+6],M=B-p,i[30+v*2]=B+p,i[31+v*2]=A[b+7]*M,b+=18,f--,d++}{var p,B,w,y;B=o[f+-16]*A[b+-10],p=o[f+-32]*A[b+-2],B+=(o[f+-48]-o[f+16])*A[b+-9],p+=o[f+-96]*A[b+-1],B+=(o[f+-80]+o[f+48])*A[b+-8],p+=o[f+-160]*A[b+0],B+=(o[f+-112]-o[f+80])*A[b+-7],p+=o[f+-224]*A[b+1],B+=(o[f+-144]+o[f+112])*A[b+-6],p-=o[f+32]*A[b+2],B+=(o[f+-176]-o[f+144])*A[b+-5],p-=o[f+96]*A[b+3],B+=(o[f+-208]+o[f+176])*A[b+-4],p-=o[f+160]*A[b+4],B+=(o[f+-240]-o[f+208])*A[b+-3],p-=o[f+224],w=p-B,y=p+B,B=i[14],p=i[15]-B,i[31]=y+B,i[30]=w+p,i[15]=w-p,i[14]=y-B}{var u;u=i[28]-i[0],i[0]+=i[28],i[28]=u*A[b+-2*18+7],u=i[29]-i[1],i[1]+=i[29],i[29]=u*A[b+-2*18+7],u=i[26]-i[2],i[2]+=i[26],i[26]=u*A[b+-4*18+7],u=i[27]-i[3],i[3]+=i[27],i[27]=u*A[b+-4*18+7],u=i[24]-i[4],i[4]+=i[24],i[24]=u*A[b+-6*18+7],u=i[25]-i[5],i[5]+=i[25],i[25]=u*A[b+-6*18+7],u=i[22]-i[6],i[6]+=i[22],i[22]=u*i0.SQRT2,u=i[23]-i[7],i[7]+=i[23],i[23]=u*i0.SQRT2-i[7],i[7]-=i[6],i[22]-=i[7],i[23]-=i[22],u=i[6],i[6]=i[31]-u,i[31]=i[31]+u,u=i[7],i[7]=i[30]-u,i[30]=i[30]+u,u=i[22],i[22]=i[15]-u,i[15]=i[15]+u,u=i[23],i[23]=i[14]-u,i[14]=i[14]+u,u=i[20]-i[8],i[8]+=i[20],i[20]=u*A[b+-10*18+7],u=i[21]-i[9],i[9]+=i[21],i[21]=u*A[b+-10*18+7],u=i[18]-i[10],i[10]+=i[18],i[18]=u*A[b+-12*18+7],u=i[19]-i[11],i[11]+=i[19],i[19]=u*A[b+-12*18+7],u=i[16]-i[12],i[12]+=i[16],i[16]=u*A[b+-14*18+7],u=i[17]-i[13],i[13]+=i[17],i[17]=u*A[b+-14*18+7],u=-i[20]+i[24],i[20]+=i[24],i[24]=u*A[b+-12*18+7],u=-i[21]+i[25],i[21]+=i[25],i[25]=u*A[b+-12*18+7],u=i[4]-i[8],i[4]+=i[8],i[8]=u*A[b+-12*18+7],u=i[5]-i[9],i[5]+=i[9],i[9]=u*A[b+-12*18+7],u=i[0]-i[12],i[0]+=i[12],i[12]=u*A[b+-4*18+7],u=i[1]-i[13],i[1]+=i[13],i[13]=u*A[b+-4*18+7],u=i[16]-i[28],i[16]+=i[28],i[28]=u*A[b+-4*18+7],u=-i[17]+i[29],i[17]+=i[29],i[29]=u*A[b+-4*18+7],u=i0.SQRT2*(i[2]-i[10]),i[2]+=i[10],i[10]=u,u=i0.SQRT2*(i[3]-i[11]),i[3]+=i[11],i[11]=u,u=i0.SQRT2*(-i[18]+i[26]),i[18]+=i[26],i[26]=u-i[18],u=i0.SQRT2*(-i[19]+i[27]),i[19]+=i[27],i[27]=u-i[19],u=i[2],i[19]-=i[3],i[3]-=u,i[2]=i[31]-u,i[31]+=u,u=i[3],i[11]-=i[19],i[18]-=u,i[3]=i[30]-u,i[30]+=u,u=i[18],i[27]-=i[11],i[19]-=u,i[18]=i[15]-u,i[15]+=u,u=i[19],i[10]-=u,i[19]=i[14]-u,i[14]+=u,u=i[10],i[11]-=u,i[10]=i[23]-u,i[23]+=u,u=i[11],i[26]-=u,i[11]=i[22]-u,i[22]+=u,u=i[26],i[27]-=u,i[26]=i[7]-u,i[7]+=u,u=i[27],i[27]=i[6]-u,i[6]+=u,u=i0.SQRT2*(i[0]-i[4]),i[0]+=i[4],i[4]=u,u=i0.SQRT2*(i[1]-i[5]),i[1]+=i[5],i[5]=u,u=i0.SQRT2*(i[16]-i[20]),i[16]+=i[20],i[20]=u,u=i0.SQRT2*(i[17]-i[21]),i[17]+=i[21],i[21]=u,u=-i0.SQRT2*(i[8]-i[12]),i[8]+=i[12],i[12]=u-i[8],u=-i0.SQRT2*(i[9]-i[13]),i[9]+=i[13],i[13]=u-i[9],u=-i0.SQRT2*(i[25]-i[29]),i[25]+=i[29],i[29]=u-i[25],u=-i0.SQRT2*(i[24]+i[28]),i[24]-=i[28],i[28]=u-i[24],u=i[24]-i[16],i[24]=u,u=i[20]-u,i[20]=u,u=i[28]-u,i[28]=u,u=i[25]-i[17],i[25]=u,u=i[21]-u,i[21]=u,u=i[29]-u,i[29]=u,u=i[17]-i[1],i[17]=u,u=i[9]-u,i[9]=u,u=i[25]-u,i[25]=u,u=i[5]-u,i[5]=u,u=i[21]-u,i[21]=u,u=i[13]-u,i[13]=u,u=i[29]-u,i[29]=u,u=i[1]-i[0],i[1]=u,u=i[16]-u,i[16]=u,u=i[17]-u,i[17]=u,u=i[8]-u,i[8]=u,u=i[9]-u,i[9]=u,u=i[24]-u,i[24]=u,u=i[25]-u,i[25]=u,u=i[4]-u,i[4]=u,u=i[5]-u,i[5]=u,u=i[20]-u,i[20]=u,u=i[21]-u,i[21]=u,u=i[12]-u,i[12]=u,u=i[13]-u,i[13]=u,u=i[28]-u,i[28]=u,u=i[29]-u,i[29]=u,u=i[0],i[0]+=i[31],i[31]-=u,u=i[1],i[1]+=i[30],i[30]-=u,u=i[16],i[16]+=i[15],i[15]-=u,u=i[17],i[17]+=i[14],i[14]-=u,u=i[8],i[8]+=i[23],i[23]-=u,u=i[9],i[9]+=i[22],i[22]-=u,u=i[24],i[24]+=i[7],i[7]-=u,u=i[25],i[25]+=i[6],i[6]-=u,u=i[4],i[4]+=i[27],i[27]-=u,u=i[5],i[5]+=i[26],i[26]-=u,u=i[20],i[20]+=i[11],i[11]-=u,u=i[21],i[21]+=i[10],i[10]-=u,u=i[12],i[12]+=i[19],i[19]-=u,u=i[13],i[13]+=i[18],i[18]-=u,u=i[28],i[28]+=i[3],i[3]-=u,u=i[29],i[29]+=i[2],i[2]-=u}}function c(o,f){for(var i=0;i<3;i++){var b,d,v,M,p,B;M=o[f+2*3]*s[x.SHORT_TYPE][0]-o[f+5*3],b=o[f+0*3]*s[x.SHORT_TYPE][2]-o[f+3*3],d=M+b,v=M-b,M=o[f+5*3]*s[x.SHORT_TYPE][0]+o[f+2*3],b=o[f+3*3]*s[x.SHORT_TYPE][2]+o[f+0*3],p=M+b,B=-M+b,b=(o[f+1*3]*s[x.SHORT_TYPE][1]-o[f+4*3])*2069978111953089e-26,M=(o[f+4*3]*s[x.SHORT_TYPE][1]+o[f+1*3])*2069978111953089e-26,o[f+3*0]=d*190752519173728e-25+b,o[f+3*5]=-p*190752519173728e-25+M,v=v*.8660254037844387*1907525191737281e-26,p=p*.5*1907525191737281e-26+M,o[f+3*1]=v-p,o[f+3*2]=v+p,d=d*.5*1907525191737281e-26-b,B=B*.8660254037844387*1907525191737281e-26,o[f+3*3]=d+B,o[f+3*4]=d-B,f++}}function m(o,f,i){var b,d;{var v,M,p,B,w,y,u,E;v=i[17]-i[9],p=i[15]-i[11],B=i[14]-i[12],w=i[0]+i[8],y=i[1]+i[7],u=i[2]+i[6],E=i[3]+i[5],o[f+17]=w+u-E-(y-i[4]),d=(w+u-E)*l[19]+(y-i[4]),b=(v-p-B)*l[18],o[f+5]=b+d,o[f+6]=b-d,M=(i[16]-i[10])*l[18],y=y*l[19]+i[4],b=v*l[12]+M+p*l[13]+B*l[14],d=-w*l[16]+y-u*l[17]+E*l[15],o[f+1]=b+d,o[f+2]=b-d,b=v*l[13]-M-p*l[14]+B*l[12],d=-w*l[17]+y-u*l[15]+E*l[16],o[f+9]=b+d,o[f+10]=b-d,b=v*l[14]-M+p*l[12]-B*l[13],d=w*l[15]-y+u*l[16]-E*l[17],o[f+13]=b+d,o[f+14]=b-d}{var I,N,X,F,R,T,k,O;I=i[8]-i[0],X=i[6]-i[2],F=i[5]-i[3],R=i[17]+i[9],T=i[16]+i[10],k=i[15]+i[11],O=i[14]+i[12],o[f+0]=R+k+O+(T+i[13]),b=(R+k+O)*l[19]-(T+i[13]),d=(I-X+F)*l[18],o[f+11]=b+d,o[f+12]=b-d,N=(i[7]-i[1])*l[18],T=i[13]-T*l[19],b=R*l[15]-T+k*l[16]+O*l[17],d=I*l[14]+N+X*l[12]+F*l[13],o[f+3]=b+d,o[f+4]=b-d,b=-R*l[17]+T-k*l[15]-O*l[16],d=I*l[13]+N-X*l[14]-F*l[12],o[f+7]=b+d,o[f+8]=b-d,b=-R*l[16]+T-k*l[17]-O*l[15],d=I*l[12]-N+X*l[13]-F*l[14],o[f+15]=b+d,o[f+16]=b-d}}this.mdct_sub48=function(o,f,i){for(var b=f,d=286,v=0;v<o.channels_out;v++){for(var M=0;M<o.mode_gr;M++){for(var p,B=o.l3_side.tt[M][v],w=B.xr,y=0,u=o.sb_sample[v][1-M],E=0,I=0;I<18/2;I++)for(h(b,d,u[E]),h(b,d+32,u[E+1]),E+=2,d+=64,p=1;p<32;p+=2)u[E-1][p]*=-1;for(p=0;p<32;p++,y+=18){var N=B.block_type,X=o.sb_sample[v][M],F=o.sb_sample[v][1-M];if(B.mixed_block_flag!=0&&p<2&&(N=0),o.amp_filter[p]<1e-12)L1.fill(w,y+0,y+18,0);else{if(o.amp_filter[p]<1)for(var I=0;I<18;I++)F[I][r[p]]*=o.amp_filter[p];if(N==x.SHORT_TYPE){for(var I=-e/4;I<0;I++){var R=s[x.SHORT_TYPE][I+3];w[y+I*3+9]=X[9+I][r[p]]*R-X[8-I][r[p]],w[y+I*3+18]=X[14-I][r[p]]*R+X[15+I][r[p]],w[y+I*3+10]=X[15+I][r[p]]*R-X[14-I][r[p]],w[y+I*3+19]=F[2-I][r[p]]*R+F[3+I][r[p]],w[y+I*3+11]=F[3+I][r[p]]*R-F[2-I][r[p]],w[y+I*3+20]=F[8-I][r[p]]*R+F[9+I][r[p]]}c(w,y)}else{for(var T=N1(18),I=-t/4;I<0;I++){var k,O;k=s[N][I+27]*F[I+9][r[p]]+s[N][I+36]*F[8-I][r[p]],O=s[N][I+9]*X[I+9][r[p]]-s[N][I+18]*X[8-I][r[p]],T[I+9]=k-O*n[3+I+9],T[I+18]=k*n[3+I+9]+O}m(w,y,T)}}if(N!=x.SHORT_TYPE&&p!=0)for(var I=7;I>=0;--I){var P,q;P=w[y+I]*a[20+I]+w[y+-1-I]*_[28+I],q=w[y+I]*_[28+I]-w[y+-1-I]*a[20+I],w[y+-1-I]=P,w[y+I]=q}}}if(b=i,d=286,o.mode_gr==1)for(var Y=0;Y<18;Y++)k1.arraycopy(o.sb_sample[v][1][Y],0,o.sb_sample[v][0][Y],0,32)}}}var{System:O1,VbrMode:Ts,Float:ys,ShortBlock:Is,Util:ks,Arrays:Ls,new_array_n:Ns,new_byte:Os,new_double:Hs,new_float:H1,new_float_n:C1,new_int:Cs,new_int_n:Vs,assert:Fs}=G,Y0=class{constructor(){this.l=H1(x.SBMAX_l),this.s=C1([x.SBMAX_s,3])}assign(e){O1.arraycopy(e.l,0,this.l,0,x.SBMAX_l);for(var t=0;t<x.SBMAX_s;t++)for(var s=0;s<3;s++)this.s[t][s]=e.s[t][s]}};var B0=class{constructor(){this.thm=new Y0,this.en=new Y0}};function j(A){var e=A;this.ordinal=function(){return e}}j.STEREO=new j(0);j.JOINT_STEREO=new j(1);j.DUAL_CHANNEL=new j(2);j.MONO=new j(3);j.NOT_SET=new j(4);var M0=class{};S(M0,"SFBMAX",st*3);var{Float:$s,ShortBlock:Js,Util:gs,Arrays:ei,new_array_n:ti,new_byte:si,new_float:V1,new_float_n:Ct,new_int:F1,new_int_n:ii,assert:ni}=G,K=class K{constructor(){S(this,"bs",null);S(this,"psy",null);S(this,"vbr",null);S(this,"qupvt",null);S(this,"newMDCT");this.newMDCT=new Ht}setModules(e,t,s,n){this.bs=e,this.psy=t,this.qupvt=s,this.vbr=n}_adjust_ATH(e){}_updateStats(e){}_lame_encode_frame_init(e,t){}lame_encode_mp3_frame(e,t,s,n,l,a){let _,r=[[new B0,new B0],[new B0,new B0]],h=[[new B0,new B0],[new B0,new B0]],c,m=[t,s],o=e.internal_flags,f=V1(2),i=Ct([2,2]),b=Ct([2,2]),d,v,M;if(o.lame_encode_frame_init===0&&this._lame_encode_frame_init(e,m),o.padding=0,o.frac_SpF>1e-9&&(o.slot_lag-=o.frac_SpF,o.slot_lag<0&&(o.slot_lag+=e.out_samplerate,o.padding=1)),o.psymodel!==0){let p,B=[null,null],w=F1(2);for(M=0;M<o.mode_gr;M++){let y=576+M*576-K.FFTOFFSET;if(B[0]=m[0].subarray(y),o.channels_out===2&&(B[1]=m[1].subarray(y)),e.VBR===J.vbr_mtrh||e.VBR===J.vbr_mt?p=this.psy.L3psycho_anal_vbr(e,B,0,M,r,h,i[M],b[M],o.tot_ener,w):p=this.psy.L3psycho_anal_ns(e,B,0,M,r,h,i[M],b[M],o.tot_ener,w),p!==0)return-4;if(e.mode===j.JOINT_STEREO){let u=o.tot_ener[2]+o.tot_ener[3];u>0?f[M]=o.tot_ener[3]/u:f[M]=.5}for(v=0;v<o.channels_out;v++){let u=o.l3_side.tt[M][v];u.block_type=w[v],u.mixed_block_flag=0}}}else for(M=0;M<o.mode_gr;M++)for(v=0;v<o.channels_out;v++)o.l3_side.tt[M][v].block_type=K.NORM_TYPE,o.l3_side.tt[M][v].mixed_block_flag=0,b[M][v]=i[M][v]=700;if(this._adjust_ATH(o),this.newMDCT.mdct_sub48(o,m[0],m[1]),o.mode_ext=K.MPG_MD_LR_LR,e.force_ms)o.mode_ext=K.MPG_MD_MS_LR;else if(e.mode===j.JOINT_STEREO&&o.channels_out==2){let p=0,B=0;for(M=0;M<o.mode_gr;M++)p+=b[M][0]+b[M][1],B+=i[M][0]+i[M][1];if(p<=1*B){let w=o.l3_side.tt[0][0].block_type===o.l3_side.tt[0][1].block_type,y=o.mode_gr===1||o.l3_side.tt[1][0].block_type===o.l3_side.tt[1][1].block_type;w&&y&&(o.mode_ext=K.MPG_MD_MS_LR)}}if(o.mode_ext===K.MPG_MD_MS_LR?(c=h,d=b):(c=r,d=i),e.analysis&&o.pinfo!=null,e.VBR===J.vbr_off||e.VBR===J.vbr_abr){let p=0;for(M=0;M<o.mode_gr;M++)for(v=0;v<o.channels_out;v++)p+=d[M][v];for(let w=0;w<18;w++)o.nsPsy.pefirbuf[w]=o.nsPsy.pefirbuf[w+1];o.nsPsy.pefirbuf[18]=p,p=o.nsPsy.pefirbuf[9];for(let w=0;w<9;w++)p+=(o.nsPsy.pefirbuf[w]+o.nsPsy.pefirbuf[18-w])*K.fircoef[w];let B=670*5*o.mode_gr*o.channels_out;for(p!==0?p=B/p:p=1,M=0;M<o.mode_gr;M++)for(v=0;v<o.channels_out;v++)d[M][v]*=p}return o.iteration_loop.iteration_loop(e,d,f,c),this.bs.format_bitstream(e),_=this.bs.copy_buffer(o,n,l,a,1),_<0||(e.bWriteVbrTag,e.analysis&&o.pinfo!=null,this._updateStats(o)),_}};S(K,"ENCDELAY",576),S(K,"POSTDELAY",K.ENCDELAY+1152-576-1),S(K,"MDCTDELAY",48),S(K,"FFTOFFSET",224+K.MDCTDELAY),S(K,"DECDELAY",528),S(K,"SBLIMIT",32),S(K,"CBANDS",64),S(K,"SBPSY_l",21),S(K,"SBPSY_s",12),S(K,"SBMAX_l",22),S(K,"SBMAX_s",13),S(K,"PSFB21",6),S(K,"PSFB12",6),S(K,"BLKSIZE",1024),S(K,"HBLKSIZE",K.BLKSIZE/2+1),S(K,"BLKSIZE_s",256),S(K,"HBLKSIZE_s",K.BLKSIZE_s/2+1),S(K,"NORM_TYPE",0),S(K,"START_TYPE",1),S(K,"SHORT_TYPE",2),S(K,"STOP_TYPE",3),S(K,"MPG_MD_LR_LR",0),S(K,"MPG_MD_LR_I",1),S(K,"MPG_MD_MS_LR",2),S(K,"MPG_MD_MS_I",3),S(K,"fircoef",[-.0207887*5,-.0378413*5,-.0432472*5,-.031183*5,779609e-23*5,.0467745*5,.10091*5,.151365*5,.187098*5]);var x=K;var ai=x.ENCDELAY,_i=x.POSTDELAY,li=x.MDCTDELAY,ri=x.FFTOFFSET,oi=x.DECDELAY,hi=x.SBLIMIT,ci=x.CBANDS,mi=x.SBPSY_l,fi=x.SBPSY_s,X1=x.SBMAX_l,st=x.SBMAX_s,bi=x.PSFB21,ui=x.PSFB12,A0=x.BLKSIZE,di=x.HBLKSIZE,T0=x.BLKSIZE_s,xi=x.HBLKSIZE_s,pi=x.NORM_TYPE,Si=x.START_TYPE,it=x.SHORT_TYPE,vi=x.STOP_TYPE,Mi=x.MPG_MD_LR_LR,Ai=x.MPG_MD_LR_I,wi=x.MPG_MD_MS_LR,Ri=x.MPG_MD_MS_I;function U(A,e,t,s){this.xlen=A,this.linmax=e,this.table=t,this.hlen=s}var L={};L.t1HB=[1,1,1,0];L.t2HB=[1,2,1,3,1,1,3,2,0];L.t3HB=[3,2,1,1,1,1,3,2,0];L.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0];L.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0];L.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0];L.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0];L.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0];L.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0];L.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0];L.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0];L.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1];L.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0];L.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3];L.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3];L.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16];L.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0];L.t1l=[1,4,3,5];L.t2l=[1,4,7,4,5,7,6,7,8];L.t3l=[2,3,7,4,4,7,6,7,8];L.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10];L.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9];L.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12];L.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13];L.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11];L.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13];L.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12];L.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12];L.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18];L.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15];L.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12];L.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10];L.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6];L.t32l=[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10];L.t33l=[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8];var r0=[new U(0,0,null,null),new U(2,0,L.t1HB,L.t1l),new U(3,0,L.t2HB,L.t2l),new U(3,0,L.t3HB,L.t3l),new U(0,0,null,null),new U(4,0,L.t5HB,L.t5l),new U(4,0,L.t6HB,L.t6l),new U(6,0,L.t7HB,L.t7l),new U(6,0,L.t8HB,L.t8l),new U(6,0,L.t9HB,L.t9l),new U(8,0,L.t10HB,L.t10l),new U(8,0,L.t11HB,L.t11l),new U(8,0,L.t12HB,L.t12l),new U(16,0,L.t13HB,L.t13l),new U(0,0,null,L.t16_5l),new U(16,0,L.t15HB,L.t15l),new U(1,1,L.t16HB,L.t16l),new U(2,3,L.t16HB,L.t16l),new U(3,7,L.t16HB,L.t16l),new U(4,15,L.t16HB,L.t16l),new U(6,63,L.t16HB,L.t16l),new U(8,255,L.t16HB,L.t16l),new U(10,1023,L.t16HB,L.t16l),new U(13,8191,L.t16HB,L.t16l),new U(4,15,L.t24HB,L.t24l),new U(5,31,L.t24HB,L.t24l),new U(6,63,L.t24HB,L.t24l),new U(7,127,L.t24HB,L.t24l),new U(8,255,L.t24HB,L.t24l),new U(9,511,L.t24HB,L.t24l),new U(11,2047,L.t24HB,L.t24l),new U(13,8191,L.t24HB,L.t24l),new U(0,0,L.t32HB,L.t32l),new U(0,0,L.t33HB,L.t33l)],nt=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],Ft=[65538,262147,458759,262148,327684,458759,393222,458759,524296],Xt=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],O0=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]];L.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]];L.scfsi_band=[0,6,11,16,21];var{System:Bi,VbrMode:Ti,Float:yi,ShortBlock:Ii,Util:ki,Arrays:Li,new_array_n:Ni,new_byte:Oi,new_double:Hi,new_float:Y1,new_float_n:Ci,new_int:Z0,new_int_n:Vi,assert:Fi}=G,V0=class A{constructor(){this.xr=Y1(576),this.l3_enc=Z0(576),this.scalefac=Z0(M0.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=Z0(3),this.subblock_gain=Z0(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=Z0(M0.SFBMAX),this.window=Z0(M0.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=Z0(4),this.max_nonzero_coeff=0}static clone_int(e){return new Int32Array(e)}static clone_float(e){return new Float32Array(e)}assign(e){this.xr=A.clone_float(e.xr),this.l3_enc=A.clone_int(e.l3_enc),this.scalefac=A.clone_int(e.scalefac),this.xrpow_max=e.xrpow_max,this.part2_3_length=e.part2_3_length,this.big_values=e.big_values,this.count1=e.count1,this.global_gain=e.global_gain,this.scalefac_compress=e.scalefac_compress,this.block_type=e.block_type,this.mixed_block_flag=e.mixed_block_flag,this.table_select=A.clone_int(e.table_select),this.subblock_gain=A.clone_int(e.subblock_gain),this.region0_count=e.region0_count,this.region1_count=e.region1_count,this.preflag=e.preflag,this.scalefac_scale=e.scalefac_scale,this.count1table_select=e.count1table_select,this.part2_length=e.part2_length,this.sfb_lmax=e.sfb_lmax,this.sfb_smin=e.sfb_smin,this.psy_lmax=e.psy_lmax,this.sfbmax=e.sfbmax,this.psymax=e.psymax,this.sfbdivide=e.sfbdivide,this.width=A.clone_int(e.width),this.window=A.clone_int(e.window),this.count1bits=e.count1bits,this.sfb_partition_table=e.sfb_partition_table.slice(0),this.slen=A.clone_int(e.slen),this.max_nonzero_coeff=e.max_nonzero_coeff}};var{System:Te,VbrMode:Yi,Float:Di,ShortBlock:Pi,Util:Gi,Arrays:Zi,new_array_n:Ki,new_byte:zi,new_double:ji,new_float:Ui,new_float_n:Wi,new_int:ye,new_int_n:Qi,assert:$i}=G,b0=class{constructor(e,t,s,n){this.l=ye(1+x.SBMAX_l),this.s=ye(1+x.SBMAX_s),this.psfb21=ye(1+x.PSFB21),this.psfb12=ye(1+x.PSFB12);let l=this.l,a=this.s;arguments.length==4&&(this.arrL=e,this.arrS=t,this.arr21=s,this.arr12=n,Te.arraycopy(this.arrL,0,l,0,Math.min(this.arrL.length,this.l.length)),Te.arraycopy(this.arrS,0,a,0,Math.min(this.arrS.length,this.s.length)),Te.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),Te.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}};var ee=class{constructor(e){this.bits=e}};var{System:tn,VbrMode:sn,Float:nn,ShortBlock:an,Util:_n,Arrays:ln,new_array_n:rn,new_byte:on,new_double:hn,new_float:cn,new_float_n:mn,new_int:qt,new_int_n:fn,assert:bn}=G,Ie=class{constructor(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[qt(4),qt(4)];for(var e=0;e<2;e++)for(var t=0;t<2;t++)this.tt[e][t]=new V0}};var{System:xn,VbrMode:pn,Float:Sn,ShortBlock:vn,Util:Mn,Arrays:An,new_array_n:wn,new_byte:Rn,new_double:En,new_float:at,new_float_n:D1,new_int:P1,new_int_n:Bn,assert:Tn}=G,ke=class{constructor(){this.last_en_subshort=D1([4,9]),this.lastAttacks=P1(4),this.pefirbuf=at(19),this.longfact=at(x.SBMAX_l),this.shortfact=at(x.SBMAX_s),this.attackthre=0,this.attackthre_s=0}};var Le=class{constructor(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}};var{Arrays:qn,new_array_n:G1,new_byte:Z1,new_float:u0,new_float_n:ue,new_int:y0,new_int_n:Ne,assert:Yn}=G;var m0=class m0{constructor(){S(this,"Class_ID",0);S(this,"lame_encode_frame_init",0);S(this,"iteration_init_init",0);S(this,"fill_buffer_resample_init",0);S(this,"mfbuf");S(this,"inbuf_old");S(this,"nb_1");S(this,"nb_2");S(this,"nb_s1");S(this,"nb_s2");S(this,"loudness_sq_save");S(this,"loudness_sq");S(this,"numlines_l");S(this,"numlines_s");S(this,"bo_l");S(this,"bo_s");S(this,"bm_l");S(this,"bm_s");S(this,"mld_l");S(this,"mld_s");S(this,"mld_cb_l");S(this,"mld_cb_s");S(this,"rnumlines_l");S(this,"s3ind");S(this,"s3ind_s");S(this,"s3_ll",null);S(this,"s3_ss",null);S(this,"minval_l");S(this,"minval_s");S(this,"pseudohalf");S(this,"tot_ener");S(this,"decay",0);S(this,"mode_gr",0);S(this,"channels_in",0);S(this,"channels_out",0);S(this,"resample_ratio",0);S(this,"mf_samples_to_encode",0);S(this,"mf_size",0);S(this,"VBR_min_bitrate",0);S(this,"VBR_max_bitrate",0);S(this,"bitrate_index",0);S(this,"samplerate_index",0);S(this,"mode_ext",0);S(this,"lowpass1",0);S(this,"lowpass2",0);S(this,"highpass1",0);S(this,"highpass2",0);S(this,"noise_shaping",0);S(this,"noise_shaping_amp",0);S(this,"substep_shaping",0);S(this,"noise_shaping_stop",0);S(this,"subblock_gain",0);S(this,"psymodel",0);S(this,"use_best_huffman",0);S(this,"full_outer_loop",0);S(this,"l3_side");S(this,"padding",0);S(this,"frac_SpF",0);S(this,"slot_lag",0);S(this,"tag_spec",null);S(this,"nMusicCRC",0);S(this,"OldValue");S(this,"CurrentStep");S(this,"masking_lower",0);S(this,"bv_scf");S(this,"sfb21_extra");S(this,"blackfilt");S(this,"itime");S(this,"sideinfo_len",0);S(this,"sb_sample");S(this,"amp_filter");S(this,"header");S(this,"h_ptr",0);S(this,"w_ptr",0);S(this,"ancillary_flag",0);S(this,"ResvSize",0);S(this,"ResvMax",0);S(this,"scalefac_band");S(this,"thm");S(this,"en");S(this,"ms_ratio_s_old",0);S(this,"ms_ratio_l_old",0);S(this,"ms_ener_ratio_old",0);S(this,"blocktype_old");S(this,"nsPsy");S(this,"VBR_seek_table");S(this,"ATH",null);S(this,"PSY",null);S(this,"nogap_total",0);S(this,"nogap_current",0);S(this,"decode_on_the_fly",!1);S(this,"findReplayGain",!1);S(this,"findPeakSample",!1);S(this,"PeakSample",0);S(this,"RadioGain",0);S(this,"AudiophileGain",0);S(this,"rgdata",null);S(this,"noclipGainChange",0);S(this,"noclipScale",0);S(this,"bitrate_stereoMode_Hist",null);S(this,"bitrate_blockType_Hist",null);S(this,"pinfo",null);S(this,"hip",null);S(this,"in_buffer_nsamples",0);S(this,"in_buffer_0",null);S(this,"in_buffer_1",null);S(this,"iteration_loop",null);this.mfbuf=[u0(m0.MFSIZE),u0(m0.MFSIZE)],this.inbuf_old=[u0(m0.INBUF_SIZE),u0(m0.INBUF_SIZE)],this.sfb21_extra=!1,this.nb_1=ue([4,x.CBANDS]),this.nb_2=ue([4,x.CBANDS]),this.nb_s1=ue([4,x.CBANDS]),this.nb_s2=ue([4,x.CBANDS]),this.loudness_sq_save=u0(2),this.loudness_sq=ue([2,2]),this.numlines_l=y0(x.CBANDS),this.numlines_s=y0(x.CBANDS),this.bo_l=y0(x.SBMAX_l),this.bo_s=y0(x.SBMAX_s),this.bm_l=y0(x.SBMAX_l),this.bm_s=y0(x.SBMAX_s),this.mld_l=u0(x.SBMAX_l),this.mld_s=u0(x.SBMAX_s),this.mld_cb_l=u0(x.CBANDS),this.mld_cb_s=u0(x.CBANDS),this.rnumlines_l=u0(x.CBANDS),this.s3ind=Ne([x.CBANDS,2]),this.s3ind_s=Ne([x.CBANDS,2]),this.minval_l=u0(x.CBANDS),this.minval_s=u0(x.CBANDS),this.pseudohalf=y0(x.SBMAX_l),this.tot_ener=u0(4),this.OldValue=y0(2),this.CurrentStep=y0(2),this.bv_scf=y0(576),this.blackfilt=new Array(2*m0.BPC+1).fill(null),this.itime=new Float64Array(2),this.sb_sample=G1([2,2,18,x.SBLIMIT],()=>0),this.amp_filter=u0(32),this.header=new Array(m0.MAX_HEADER_BUF),this.scalefac_band=new b0,this.thm=new Array(4),this.en=new Array(4);for(let e=0;e<4;e++)this.thm[e]=new Y0,this.en[e]=new Y0;this.blocktype_old=y0(2),this.nsPsy=new ke,this.VBR_seek_table=new Le,this.l3_side=new Ie;for(let e=0;e<m0.MAX_HEADER_BUF;e++){class t{constructor(){this.write_timing=0,this.ptr=0,this.buf=Z1(40)}}this.header[e]=new t}this.bitrate_stereoMode_Hist||(this.bitrate_stereoMode_Hist=Ne([16,5])),this.bitrate_blockType_Hist||(this.bitrate_blockType_Hist=Ne([16,6])),this.ATH=null,this.PSY=null,this.rgdata=null,this.iteration_loop=null,this.hip=null,this.pinfo=null,this.tag_spec=null,this.in_buffer_0=null,this.in_buffer_1=null,this.s3_ll=null,this.s3_ss=null}};S(m0,"MFSIZE",3*1152+x.ENCDELAY-x.MDCTDELAY),S(m0,"MAX_HEADER_BUF",256),S(m0,"MAX_BITS_PER_CHANNEL",4095),S(m0,"MAX_BITS_PER_GRANULE",7680),S(m0,"BPC",320),S(m0,"INBUF_SIZE",4096);var W=m0,I0=W.MAX_HEADER_BUF;var{VbrMode:K0,Float:Oe,ShortBlock:Un,Util:_t,Arrays:Wn,new_float:ne,new_float_n:Qn,new_int:Yt,assert:F0}=G,ie=257,se=116;var z1=8206,z0=z1+2,Dt=2220446049250313e-31,j1=100,Pt=ne(ie+se+1),Gt=ne(ie),te=ne(z0),lt=ne(z0),d0=class{constructor(){S(this,"tak",null);S(this,"rv",null);S(this,"psy",null);S(this,"pretab",[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0]);S(this,"sfBandIndex",[new b0([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new b0([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new b0([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new b0([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new b0([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new b0([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new b0([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new b0([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new b0([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])]);S(this,"nr_of_sfb_block",[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]]);S(this,"adj43",lt);S(this,"_StartLine",class{constructor(e){this.s=e}})}setModules(e,t,s){this.tak=e,this.rv=t,this.psy=s}IPOW20(e){return F0(0<=e&&e<ie,`IPOW20 index out of bounds: ${e}`),Gt[e]}_POW20(e){return F0(0<=e+se&&e<ie+se+1,`POW20 index out of bounds: ${e}`),Pt[e+se]}_ATHmdct(e,t){let s=this.psy.ATHformula(t,e);return s-=j1,s=Math.pow(10,s/10+e.ATHlower),s}_compute_ath(e){let t=e.internal_flags,s=t.ATH.l,n=t.ATH.psfb21,l=t.ATH.s,a=t.ATH.psfb12,_=e.out_samplerate;for(let r=0;r<x.SBMAX_l;r++){let h=t.scalefac_band.l[r],c=t.scalefac_band.l[r+1];s[r]=Oe.MAX_VALUE;for(let m=h;m<c;m++){let o=m*_/1152,f=this._ATHmdct(e,o);s[r]=Math.min(s[r],f)}}for(let r=0;r<x.PSFB21;r++){let h=t.scalefac_band.psfb21[r],c=t.scalefac_band.psfb21[r+1];n[r]=Oe.MAX_VALUE;for(let m=h;m<c;m++){let o=m*_/1152,f=this._ATHmdct(e,o);n[r]=Math.min(n[r],f)}}for(let r=0;r<x.SBMAX_s;r++){let h=t.scalefac_band.s[r],c=t.scalefac_band.s[r+1];l[r]=Oe.MAX_VALUE;for(let m=h;m<c;m++){let o=m*_/384,f=this._ATHmdct(e,o);l[r]=Math.min(l[r],f)}l[r]*=t.scalefac_band.s[r+1]-t.scalefac_band.s[r]}for(let r=0;r<x.PSFB12;r++){let h=t.scalefac_band.psfb12[r],c=t.scalefac_band.psfb12[r+1];a[r]=Oe.MAX_VALUE;for(let m=h;m<c;m++){let o=m*_/384,f=this._ATHmdct(e,o);a[r]=Math.min(a[r],f)}a[r]*=t.scalefac_band.s[13]-t.scalefac_band.s[12]}if(e.noATH){for(let r=0;r<x.SBMAX_l;r++)s[r]=1e-20;for(let r=0;r<x.PSFB21;r++)n[r]=1e-20;for(let r=0;r<x.SBMAX_s;r++)l[r]=1e-20;for(let r=0;r<x.PSFB12;r++)a[r]=1e-20}t.ATH.floor=10*Math.log10(this._ATHmdct(e,-1))}iteration_init(e){let t=e.internal_flags,s;if(t.iteration_init_init===0){for(t.iteration_init_init=1,t.l3_side.main_data_begin=0,this._compute_ath(e),te[0]=0,s=1;s<z0;s++)te[s]=Math.pow(s,4/3);for(s=0;s<z0-1;s++)lt[s]=s+1-Math.pow(.5*(te[s]+te[s+1]),.75);for(lt[z0-1]=.5,s=0;s<ie;s++)Gt[s]=Math.pow(2,(s-210)*-.1875);for(s=0;s<=ie+se;s++)Pt[s]=Math.pow(2,(s-210-se)*.25);this.tak.huffman_init(t);{let n,l,a,_;for(s=e.exp_nspsytune>>2&63,s>=32&&(s-=64),n=Math.pow(10,s/4/10),s=e.exp_nspsytune>>8&63,s>=32&&(s-=64),l=Math.pow(10,s/4/10),s=e.exp_nspsytune>>14&63,s>=32&&(s-=64),a=Math.pow(10,s/4/10),s=e.exp_nspsytune>>20&63,s>=32&&(s-=64),_=a*Math.pow(10,s/4/10),s=0;s<x.SBMAX_l;s++){let r=s<=6?n:s<=13?l:s<=20?a:_;t.nsPsy.longfact[s]=r}for(s=0;s<x.SBMAX_s;s++){let r=s<=5?n:s<=10?l:s<=11?a:_;t.nsPsy.shortfact[s]=r}}}}on_pe(e,t,s,n,l,a){let _=e.internal_flags,r=0,h=0,c=Yt(2),m=_.channels_out,o=new ee(r),f=this.rv.ResvMaxBits(e,n,o,a);r=o.bits;let i=r+f,b=Math.min(i,W.MAX_BITS_PER_GRANULE);for(let M=0;M<m;++M){s[M]=Math.min(W.MAX_BITS_PER_CHANNEL,Math.floor(r/m)),c[M]=Math.floor(s[M]*t[l][M]/700)-s[M];let p=n/m;c[M]>p*.75&&(c[M]=Math.floor(p*.75)),c[M]<0&&(c[M]=0),c[M]+s[M]>W.MAX_BITS_PER_CHANNEL&&(c[M]=Math.max(0,W.MAX_BITS_PER_CHANNEL-s[M])),h+=c[M]}let d=f;if(h>d)for(let M=0;M<m;++M)c[M]=Math.floor(d*c[M]/h);let v=0;for(let M=0;M<m;++M)s[M]+=c[M],v+=s[M];if(v>W.MAX_BITS_PER_GRANULE){let M=0;for(let p=0;p<m;++p)s[p]=Math.floor(s[p]*W.MAX_BITS_PER_GRANULE/v),M+=s[p];F0(M<=W.MAX_BITS_PER_GRANULE,"on_pe rescaling failed")}return b}reduce_side(e,t,s,n){F0(n<=W.MAX_BITS_PER_GRANULE,"max_bits exceeds granule limit in reduce_side"),F0(e[0]+e[1]<=W.MAX_BITS_PER_GRANULE,"Initial targ_bits exceed granule limit");let l=.33*(.5-t)/.5;l<0&&(l=0),l>.5&&(l=.5);let a=Math.floor(l*.5*(e[0]+e[1]));a>W.MAX_BITS_PER_CHANNEL-e[0]&&(a=W.MAX_BITS_PER_CHANNEL-e[0]),a<0&&(a=0);let _=125;if(e[1]>=_)if(e[1]-a>=_)e[0]<s&&(e[0]+=a,e[1]-=a);else{let h=e[1]-_;e[0]<s&&(e[0]+=h),e[1]=_}let r=e[0]+e[1];r>n&&(r>0?(e[0]=Math.floor(n*e[0]/r),e[1]=Math.floor(n*e[1]/r)):(e[0]=Math.floor(n/2),e[1]=Math.floor(n/2))),F0(e[0]>=0&&e[0]<=W.MAX_BITS_PER_CHANNEL,`Mid bits out of range: ${e[0]}`),F0(e[1]>=0&&e[1]<=W.MAX_BITS_PER_CHANNEL,`Side bits out of range: ${e[1]}`),F0(e[0]+e[1]<=W.MAX_BITS_PER_GRANULE,"Total bits exceed granule limit after reduce_side")}athAdjust(e,t,s){let n=90.30873362,l=94.82444863,a=_t.FAST_LOG10_X(t,10),_=e*e,r=0;return a-=s,_>1e-20&&(r=1+_t.FAST_LOG10_X(_,10/n)),r<0&&(r=0),a*=r,a+=s+n-l,Math.pow(10,.1*a)}calc_xmin(e,t,s,n){let l=0,a=e.internal_flags,_,r=0,h=0,c=a.ATH,m=s.xr,o=e.VBR===K0.vbr_mtrh?1:0,f=a.masking_lower;for((e.VBR===K0.vbr_mtrh||e.VBR===K0.vbr_mt)&&(f=1),_=0;_<s.psy_lmax;_++){let d,v,M=s.width[_],p=0;e.VBR===K0.vbr_rh||e.VBR===K0.vbr_mtrh?d=this.athAdjust(c.adjust,c.l[_],c.floor):d=c.adjust*c.l[_];let B=d/M,w=Dt;if(M>0){let y=M>>1;do{let u=m[r]*m[r];p+=u,w+=Math.min(u,B),r++;let E=m[r]*m[r];p+=E,w+=Math.min(E,B),r++}while(--y>0)}if(p>d&&h++,_===x.SBPSY_l){let y=d*a.nsPsy.longfact[_];w<y&&(w=y)}if(v=o!==0?w:d,!e.ATHonly){let y=t.en.l[_];if(y>0){let u=p*t.thm.l[_]*f/y;o!==0&&(u*=a.nsPsy.longfact[_]),v<u&&(v=u)}}n[l++]=o!==0?v:v*a.nsPsy.longfact[_]}let i=575;if(s.block_type!==x.SHORT_TYPE){let d=576;for(;d-- >0&&!(Math.abs(m[d])>1e-9););i=d,i<0&&(i=0),s.max_nonzero_coeff=i}else s.max_nonzero_coeff=575;let b=s.sfb_smin;for(;_<s.psymax;){let d=s.width[_],v;e.VBR===K0.vbr_rh||e.VBR===K0.vbr_mtrh?v=this.athAdjust(c.adjust,c.s[b],c.floor):v=c.adjust*c.s[b];for(let M=0;M<3;M++){let p=0,B,w=v/d,y=Dt;if(d>0){let u=d>>1;do{let E=m[r]*m[r];p+=E,y+=Math.min(E,w),r++;let I=m[r]*m[r];p+=I,y+=Math.min(I,w),r++}while(--u>0)}if(p>v&&h++,b===x.SBPSY_s){let u=v*a.nsPsy.shortfact[b];y<u&&(y=u)}if(B=o!==0?y:v,!e.ATHonly&&!e.ATHshort){let u=t.en.s[b][M];if(u>0){let E=p*t.thm.s[b][M]*f/u;o!==0&&(E*=a.nsPsy.shortfact[b]),B<E&&(B=E)}}n[l++]=o!==0?B:B*a.nsPsy.shortfact[b],_++}e.useTemporal&&(n[l-3]>n[l-2]&&(n[l-2]+=(n[l-3]-n[l-2])*a.decay),n[l-2]>n[l-1]&&(n[l-1]+=(n[l-2]-n[l-1])*a.decay)),b++}return h}calc_noise_core(e,t,s,n){let l=0,a=t.s,_=e.l3_enc,r=e.xr;if(a>=e.count1)for(;s-- >0;){let h;h=r[a],a++,l+=h*h,h=r[a],a++,l+=h*h}else if(a>=e.big_values){let h=[0,n];for(;s-- >0;){let c;c=Math.abs(r[a])-h[_[a]],a++,l+=c*c,c=Math.abs(r[a])-h[_[a]],a++,l+=c*c}}else for(;s-- >0;){let h,c=_[a],m=c<z0?te[c]*n:Math.pow(c,4/3)*n;h=Math.abs(r[a])-m,a++,l+=h*h;let o=_[a],f=o<z0?te[o]*n:Math.pow(o,4/3)*n;h=Math.abs(r[a])-f,a++,l+=h*h}return t.s=a,l}calc_noise(e,t,s,n,l){let a=0,_=0,r=0,h=0,c=0,m=-20,o=0,f=e.scalefac,i=0;n.over_SSD=0;let b=l!=null&&l.global_gain===e.global_gain;for(let d=0;d<e.psymax;d++){let v,M=0,p=0;if(v=e.global_gain-(f[i++]+(e.preflag!==0?this.pretab[d]:0)<<e.scalefac_scale+1)-e.subblock_gain[e.window[d]]*8,b&&l.step[d]===v)M=l.noise[d],p=l.noise_log[d],o+=e.width[d],s[a++]=M/t[_++];else{let B=this._POW20(v),w=e.width[d],y=w>>1,u=o;if(o+w>e.max_nonzero_coeff){let I=e.max_nonzero_coeff-o+1;y=I>0?I>>1:0}y<0&&(y=0);let E=new this._StartLine(u);M=this.calc_noise_core(e,E,y,B),o=E.s,l!=null&&(l.step[d]=v,l.noise[d]=M),s[a++]=M/t[_++],p=_t.FAST_LOG10(Math.max(s[a-1],1e-20)),l!=null&&(l.noise_log[d]=p)}if(c+=p,p>0){let B=Math.max(Math.floor(p*10+.5),1);n.over_SSD+=B*B,r++,h+=p}m=Math.max(m,p)}return n.over_count=r,n.tot_noise=c,n.over_noise=h,n.max_noise=m,l!=null&&(l.global_gain=e.global_gain),r}set_pinfo(e,t,s,n,l){let a=e.internal_flags,_,r,h,c,m=t.scalefac_scale===0?.5:1,o=t.scalefac,f=ne(L3Side.SFBMAX),i=ne(L3Side.SFBMAX),b=new CalcNoiseResult;this.calc_xmin(e,s,t,f),this.calc_noise(t,f,i,b,null);let d=a.pinfo,v=0;for(r=t.sfb_lmax,t.block_type!==x.SHORT_TYPE&&t.mixed_block_flag===0&&(r=22),_=0;_<r;_++){let M=a.scalefac_band.l[_],p=a.scalefac_band.l[_+1],B=p-M;if(B===0)continue;for(c=0,h=M;h<p;h++)c+=t.xr[h]*t.xr[h];v=p,c/=B;let w=1e15;d.en[n][l][_]=w*c,d.xfsf[n][l][_]=w*f[_]*i[_]/B;let y=a.ATH.l[_];if(!e.ATHonly&&s.en.l[_]>0){let E=0;s.en.l[_]>0&&(E=c/s.en.l[_]*s.thm.l[_]),y=Math.max(E,a.ATH.l[_])}d.thr[n][l][_]=w*y,d.LAMEsfb[n][l][_]=0,t.preflag!==0&&_>=11&&(d.LAMEsfb[n][l][_]-=m*this.pretab[_]),_<x.SBPSY_l&&(F0(o[_]>=0,`Negative scalefactor found: sfb=${_}, val=${o[_]}`),d.LAMEsfb[n][l][_]-=m*o[_])}if(t.block_type===x.SHORT_TYPE){let M=r;for(_=t.sfb_smin;_<x.SBMAX_s;_++){let p=a.scalefac_band.s[_],w=a.scalefac_band.s[_+1]-p;if(w!==0)for(let y=0;y<3;y++){c=0;let u=v;for(h=0;h<w;h++)c+=t.xr[v]*t.xr[v],v++;c=Math.max(c/w,1e-20);let E=3*_+y,I=1e15;d.en_s[n][l][E]=I*c,d.xfsf_s[n][l][E]=I*f[M]*i[M]/w;let N=a.ATH.s[_];if(!e.ATHonly&&!e.ATHshort){let X=s.en.s[_][y];if(X>0){let F=c/X*s.thm.s[_][y];N=Math.max(F,a.ATH.s[_])}}d.thr_s[n][l][E]=I*N,d.LAMEsfb_s[n][l][E]=-2*t.subblock_gain[y],_<x.SBPSY_s&&(d.LAMEsfb_s[n][l][E]-=m*o[M]),M++}}}d.LAMEqss[n][l]=t.global_gain,d.LAMEmainbits[n][l]=t.part2_3_length+t.part2_length,d.LAMEsfbits[n][l]=t.part2_length,d.over[n][l]=b.over_count,d.max_noise[n][l]=b.max_noise*10,d.over_noise[n][l]=b.over_noise*10,d.tot_noise[n][l]=b.tot_noise*10,d.over_SSD[n][l]=b.over_SSD}_set_frame_pinfo(e,t){let s=e.internal_flags;s.masking_lower=1;for(let n=0;n<s.mode_gr;n++)for(let l=0;l<s.channels_out;l++){let a=s.l3_side.tt[n][l],_=Yt(L3Side.SFBMAX);if(System.arraycopy(a.scalefac,0,_,0,L3Side.SFBMAX),n===1)for(let r=0;r<a.sfb_lmax;r++)a.scalefac[r]<0&&(a.scalefac[r]=s.l3_side.tt[0][l].scalefac[r]);this.set_pinfo(e,a,t[n][l],n,l),System.arraycopy(_,0,a.scalefac,0,L3Side.SFBMAX)}}};var{System:aa,VbrMode:_a,Float:la,ShortBlock:ra,Util:oa,Arrays:Zt,new_array_n:ha,new_byte:ca,new_double:ma,new_float:fa,new_float_n:ba,new_int:de,new_int_n:ua,assert:xe}=G,zt=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],jt=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3],He=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]],Kt=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13],k0=class{constructor(e=0){this.bits=0|e}};function Ut(A){return A!==0?1:0}var Ce=class{constructor(){S(this,"qupvt",null);S(this,"quantize_lines_xrpow",this._quantize_lines_xrpow);S(this,"quantize_lines_xrpow_01",this._quantize_lines_xrpow_01);S(this,"quantize_xrpow",this._quantize_xrpow)}setModules(e){this.qupvt=e}_quantize_lines_xrpow(e,t,s,n,l,a){xe(e>0,`quantize_lines_xrpow length must be > 0: ${e}`),e=e>>1;let _=e%2;for(e=e>>1;e-- >0;){let r=s[n++]*t,h=s[n++]*t,c=Math.floor(r),m=Math.floor(h),o=s[n++]*t,f=s[n++]*t,i=Math.floor(o),b=Math.floor(f);c=Math.max(0,Math.min(c,d0.IXMAX_VAL+1)),m=Math.max(0,Math.min(m,d0.IXMAX_VAL+1)),i=Math.max(0,Math.min(i,d0.IXMAX_VAL+1)),b=Math.max(0,Math.min(b,d0.IXMAX_VAL+1)),r+=this.qupvt.adj43[c],h+=this.qupvt.adj43[m],l[a++]=Math.floor(r),l[a++]=Math.floor(h),o+=this.qupvt.adj43[i],f+=this.qupvt.adj43[b],l[a++]=Math.floor(o),l[a++]=Math.floor(f)}if(_!==0){let r=s[n++]*t,h=s[n++]*t,c=Math.floor(r),m=Math.floor(h);c=Math.max(0,Math.min(c,d0.IXMAX_VAL+1)),m=Math.max(0,Math.min(m,d0.IXMAX_VAL+1)),r+=this.qupvt.adj43[c],h+=this.qupvt.adj43[m],l[a++]=Math.floor(r),l[a++]=Math.floor(h)}}_quantize_lines_xrpow_01(e,t,s,n,l,a){let _=.5946/t;for(xe(e>0),e=e>>1;e-- >0;)l[a++]=_>s[n++]?0:1,l[a++]=_>s[n++]?0:1}_ix_max(e,t,s){let n=0,l=0;for(s=Math.min(s,e.length),t=Math.min(t,s);t<s;){let a=e[t++];if(n<a&&(n=a),t<s){let _=e[t++];l<_&&(l=_)}}return Math.max(n,l)}_count_bit_ESC(e,t,s,n,l,a){let _=r0[n].xlen,r=r0[l].xlen,h=0,c=0,m=(1<<_)-1,o=(1<<r)-1;for(;t<s;){let b=e[t++],d=e[t++],v=0,M=0,p=0,B=0,w=!1,y=!1;b!==0&&(b>14&&(b=15,w=!0,p+=_),v=b*16),d!==0&&(d>14&&(d=15,w=!0,p+=_),v+=d),p+=nt[v]>>16,b=e[t-2],d=e[t-1],b!==0&&(b>14&&(b=15,y=!0,B+=r),M=b*16),d!==0&&(d>14&&(d=15,y=!0,B+=r),M+=d),B+=nt[v]&65535,h+=p,c+=B}let f=h,i=n;return h>c&&(f=c,i=l),a.bits+=f,i}_count_bit_noESC(e,t,s,n){let l=0,a=r0[1].hlen;for(;t<s;){let _=e[t]*2+e[t+1];t+=2,l+=a[_]}return n.bits+=l,1}_count_bit_noESC_from2(e,t,s,n,l){let a=0,_=0,r=r0[n].xlen,h=n===2?Ft:Xt;for(;t<s;){let o=e[t]*r+e[t+1];t+=2;let f=h[o];a+=f>>16,_+=f&65535}let c=a,m=n;return a>_&&(c=_,m=n+1),l.bits+=c,m}_count_bit_noESC_from3(e,t,s,n,l){let a=0,_=0,r=0,h=r0[n].xlen,c=r0[n].hlen,m=r0[n+1].hlen,o=r0[n+2].hlen;for(;t<s;){let b=e[t]*h+e[t+1];t+=2,a+=c[b],_+=m[b],r+=o[b]}let f=a,i=n;return f>_&&(f=_,i=n+1),f>r&&(f=r,i=n+2),l.bits+=f,i}_choose_table(e,t,s,n){let l=this._ix_max(e,t,s);switch(l){case 0:return 0;case 1:return this._count_bit_noESC(e,t,s,n);case 2:case 3:return this._count_bit_noESC_from2(e,t,s,Kt[l-1],n);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return this._count_bit_noESC_from3(e,t,s,Kt[l-1],n);default:if(l>d0.IXMAX_VAL)return n.bits=LARGE_BITS,-1;let a=24;for(;a<32&&!(r0[a].linmax>=l-15);a++);let _=16;for(;_<24&&!(r0[_].linmax>=l-15);_++);return this._count_bit_ESC(e,t,s,_,a,n)}}_recalc_divide_init(e,t,s,n,l,a,_){let r=t.big_values;Zt.fill(n,d0.LARGE_BITS);for(let h=0;h<16;h++){let c=e.scalefac_band.l[h+1];if(c>=r)break;let m=0,o=new k0(m),f=this._choose_table(s,0,c,o);if(m=o.bits,!(f<0))for(let i=0;i<8;i++){let b=e.scalefac_band.l[h+i+2];if(b>=r)break;let d=m,v=new k0(d),M=this._choose_table(s,c,b,v);if(d=v.bits,M<0)continue;let p=h+i;n[p]>d&&(n[p]=d,l[p]=h,a[p]=f,_[p]=M)}}}_recalc_divide_sub(e,t,s,n,l,a,_,r){let h=t.big_values;for(let c=0;c<=22;c++){if(l[c]>=LARGE_BITS)continue;let m=c+2,o=e.scalefac_band.l[m];if(o>=h)continue;let f=l[c]+t.count1bits;if(s.part2_3_length<=f)continue;let i=new k0(f),b=this._choose_table(n,o,h,i);f=i.bits,!(b<0)&&s.part2_3_length>f&&(s.assign(t),s.part2_3_length=f,s.region0_count=a[c],s.region1_count=c-s.region0_count,s.table_select[0]=_[c],s.table_select[1]=r[c],s.table_select[2]=b)}}noquant_count_bits(e,t,s){let n=t.l3_enc,l=t.max_nonzero_coeff+1;for(l&1&&l++,l=Math.min(576,l),s!=null&&(s.sfb_count1=0);l>1&&(n[l-1]|n[l-2])===0;l-=2);t.count1=l;let a=0,_=0,r=l;for(;r>3&&!((n[r-1]|n[r-2]|n[r-3]|n[r-4])>1);r-=4){let o=((n[r-4]*3+n[r-3])*3+n[r-2])*3+n[r-1],f=n[r-4]<<3|n[r-3]<<2|n[r-2]<<1|n[r-1],i=((n[r-4]*3+n[r-3])*3+n[r-2])*3+n[r-1],b=((n[r-4]*2+n[r-3])*2+n[r-2])*2+n[r-1];b>=0&&b<L.t32l.length&&b<L.t33l.length?(a+=L.t32l[b],_+=L.t33l[b]):console.error("Invalid index for count1 tables:",b)}t.big_values=r;let h=a;if(t.count1table_select=0,a>_&&(h=_,t.count1table_select=1),t.count1bits=h,t.big_values===0)return h;let c=0,m=0;if(t.block_type===x.SHORT_TYPE)console.warn("Short block region calculation in noquant_count_bits needs gfc context."),c=Math.min(t.big_values,3*e.scalefac_band.s[3]),m=t.big_values;else if(t.block_type===x.NORM_TYPE){xe(t.big_values<=576,"big_values out of bounds"),t.big_values>=2?(t.region0_count=e.bv_scf[t.big_values-2],t.region1_count=e.bv_scf[t.big_values-1]):(t.region0_count=0,t.region1_count=0);let o=x.SBPSY_l-1;t.region0_count>o&&(t.region0_count=o);let f=x.SBPSY_l-t.region0_count-1;t.region1_count>f&&(t.region1_count=f),c=e.scalefac_band.l[t.region0_count+1],m=e.scalefac_band.l[t.region0_count+t.region1_count+2]}else t.region0_count=7,t.region1_count=x.SBMAX_l-1-7-1,c=e.scalefac_band.l[t.region0_count+1],m=t.big_values;if(c=Math.min(c,t.big_values),m=Math.min(m,t.big_values),c>0){let o=new k0(h);t.table_select[0]=this._choose_table(n,0,c,o),h=o.bits}if(m>c){let o=new k0(h);t.table_select[1]=this._choose_table(n,c,m,o),h=o.bits}if(t.big_values>m){let o=new k0(h);t.table_select[2]=this._choose_table(n,m,t.big_values,o),h=o.bits}if(e.use_best_huffman===2&&(t.part2_3_length=h,this.best_huffman_divide(e,t),h=t.part2_3_length),s!=null&&t.block_type===x.NORM_TYPE){let o=0;for(;o<x.SBMAX_l&&e.scalefac_band.l[o+1]<t.big_values;)o++;s.sfb_count1=o}return h}count_bits(e,t,s,n){let l=this.qupvt.IPOW20(s.global_gain),a=d0.IXMAX_VAL/l;if(s.xrpow_max>a)return LARGE_BITS;if(this._quantize_xrpow(t,s.l3_enc,l,s,n),(e.substep_shaping&2)!==0){let _=0,h=.634521682242439/this.qupvt.IPOW20(s.global_gain+s.scalefac_scale);for(let c=0;c<s.sfbmax;c++){let m=s.width[c];if(e.pseudohalf[c]===0)_+=m;else{let o=_+m;for(;_<o;++_);}}}return this.noquant_count_bits(e,s,n)}best_huffman_divide(e,t){if(t.block_type!==x.NORM_TYPE&&t.block_type!==x.START_TYPE&&t.block_type!==x.STOP_TYPE)return t.block_type===x.SHORT_TYPE&&e.mode_gr===1,void 0;let s=new V0,n=t.l3_enc,l=de(23),a=de(23),_=de(23),r=de(23);s.assign(t),t.block_type===x.NORM_TYPE&&(this._recalc_divide_init(e,t,n,l,a,_,r),this._recalc_divide_sub(e,s,t,n,l,a,_,r));let h=s.big_values;if(h===0||h>=t.count1||(n[h-1]|n[h-2])>1||(h=t.count1+2,h>576))return;s.assign(t),s.count1=h;let c=0,m=0,o=h;for(;o>s.big_values;o-=4){let b=n[o-4]<<3|n[o-3]<<2|n[o-2]<<1|n[o-1];if(b>=0&&b<L.t32l.length&&b<L.t33l.length)c+=L.t32l[b],m+=L.t33l[b];else{console.error("Invalid index for count1 tables in best_huffman_divide:",b);return}}s.big_values=o,s.count1table_select=c>m?1:0,s.count1bits=Math.min(c,m),s.part2_3_length=s.count1bits;let f=0,i=0;if(s.block_type===x.NORM_TYPE?(f=e.scalefac_band.l[t.region0_count+1],i=e.scalefac_band.l[t.region0_count+t.region1_count+2]):(f=e.scalefac_band.l[8],i=s.big_values),f=Math.min(f,s.big_values),i=Math.min(i,s.big_values),f>0){let b=new k0(s.part2_3_length);s.table_select[0]=this._choose_table(n,0,f,b),s.part2_3_length=b.bits}if(i>f){let b=new k0(s.part2_3_length);s.table_select[1]=this._choose_table(n,f,i,b),s.part2_3_length=b.bits}if(s.big_values>i){let b=new k0(s.part2_3_length);s.table_select[2]=this._choose_table(n,i,s.big_values,b),s.part2_3_length=b.bits}t.part2_3_length>s.part2_3_length&&t.assign(s)}scale_bitcount(e){let t,s,n=0,l=0,a,_=e.scalefac;if(xe(this._all_scalefactors_not_negative(_,e.sfbmax),"Negative scalefactor found before scale_bitcount"),e.block_type===x.SHORT_TYPE)a=e.mixed_block_flag!==0?scale_mixed:scale_short;else if(a=scale_long,e.preflag===0){for(s=11;s<x.SBPSY_l&&!(_[s]<this.qupvt.pretab[s]);s++);if(s===x.SBPSY_l)for(e.preflag=1,s=11;s<x.SBPSY_l;s++)_[s]-=this.qupvt.pretab[s]}for(s=0;s<e.sfbdivide;s++)n<_[s]&&(n=_[s]);for(;s<e.sfbmax;s++)l<_[s]&&(l=_[s]);e.part2_length=LARGE_BITS;let r=!1;for(t=0;t<16;t++)n<W1[t]&&l<Q1[t]&&(r=!0,e.part2_length>a[t]&&(e.part2_length=a[t],e.scalefac_compress=t));return!r}scale_bitcount_lsf(e,t){let s,n,l,a,_,r=!1,h,c,m=de(4),o=t.scalefac;if(s=t.preflag!==0?2:0,Zt.fill(m,0),t.block_type===x.SHORT_TYPE){n=1;let f=this.qupvt.nr_of_sfb_block[s][n];for(c=0,l=0;l<4;l++)for(a=f[l]/3,h=0;h<a;h++,c++)for(_=0;_<3;_++){let i=o[c*3+_];i>m[l]&&(m[l]=i)}}else{n=0;let f=this.qupvt.nr_of_sfb_block[s][n];for(c=0,l=0;l<4;l++)for(a=f[l],h=0;h<a;h++,c++)o[c]>m[l]&&(m[l]=o[c])}for(l=0;l<4;l++)if(m[l]>$1[s][l]){r=!0;break}if(!r){for(t.sfb_partition_table=this.qupvt.nr_of_sfb_block[s][n],l=0;l<4;l++)t.slen[l]=U1[m[l]];let f=t.slen[0],i=t.slen[1],b=t.slen[2],d=t.slen[3];switch(s){case 0:t.scalefac_compress=(f*5+i<<4)+(b<<2)+d;break;case 1:t.scalefac_compress=400+(f*5+i<<2)+b;break;case 2:t.scalefac_compress=500+f*3+i;break;default:console.error("LSF intensity stereo not implemented");break}for(t.part2_length=0,xe(t.sfb_partition_table!=null,"Partition table is null in scale_bitcount_lsf"),l=0;l<4;l++)t.part2_length+=t.slen[l]*t.sfb_partition_table[l]}return r}huffman_init(e){for(let t=2;t<=576;t+=2){let s=0;for(;s<x.SBMAX_l&&e.scalefac_band.l[s+1]<t;)s++;s>=x.SBMAX_l&&(s=x.SBMAX_l-1);let n=He[s][0];for(;n>0&&e.scalefac_band.l[n+1]>=t;)n--;for(n<0&&(n=He[s][0]),e.bv_scf[t-2]=n,n=He[s][1];n>0&&e.scalefac_band.l[n+e.bv_scf[t-2]+2]>=t;)n--;n<0&&(n=He[s][1]),e.bv_scf[t-1]=n}}},U1=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4],W1=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],Q1=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],$1=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];var ae=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475],Ve=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];function Wt(A,e,t){var s=0,n,l,a;t<<=1;var _=e+t;n=4;do{var r,h,c,m,o,f,i;i=n>>1,m=n,o=n<<1,f=o+m,n=o<<1,l=e,a=l+i;do{var b,d,v,M;d=A[l+0]-A[l+m],b=A[l+0]+A[l+m],M=A[l+o]-A[l+f],v=A[l+o]+A[l+f],A[l+o]=b-v,A[l+0]=b+v,A[l+f]=d-M,A[l+m]=d+M,d=A[a+0]-A[a+m],b=A[a+0]+A[a+m],M=v0.SQRT2*A[a+f],v=v0.SQRT2*A[a+o],A[a+o]=b-v,A[a+0]=b+v,A[a+f]=d-M,A[a+m]=d+M,a+=n,l+=n}while(l<_);for(h=ae[s+0],r=ae[s+1],c=1;c<i;c++){var p,B;p=1-2*r*r,B=2*r*h,l=e+c,a=e+m-c;do{var w,y,u,b,d,E,v,I,M,N;y=B*A[l+m]-p*A[a+m],w=p*A[l+m]+B*A[a+m],d=A[l+0]-w,b=A[l+0]+w,E=A[a+0]-y,u=A[a+0]+y,y=B*A[l+f]-p*A[a+f],w=p*A[l+f]+B*A[a+f],M=A[l+o]-w,v=A[l+o]+w,N=A[a+o]-y,I=A[a+o]+y,y=r*v-h*N,w=h*v+r*N,A[l+o]=b-w,A[l+0]=b+w,A[a+f]=E-y,A[a+m]=E+y,y=h*I-r*M,w=r*I+h*M,A[a+o]=u-w,A[a+0]=u+w,A[l+f]=d-y,A[l+m]=d+y,a+=n,l+=n}while(l<_);p=h,h=p*ae[s+0]-r*ae[s+1],r=p*ae[s+1]+r*ae[s+0]}s+=2}while(n<t)}var Fe=class{constructor(){this.window=p0(A0),this.window_s=p0(T0/2)}init_fft(e){for(let t=0;t<A0;t++)this.window[t]=.42-.5*Math.cos(2*Math.PI*(t+.5)/A0)+.08*Math.cos(4*Math.PI*(t+.5)/A0);for(let t=0;t<T0/2;t++)this.window_s[t]=.5*(1-Math.cos(2*Math.PI*(t+.5)/T0))}fft_short(e,t,s,n,l){for(let a=0;a<3;a++){let _=T0/2,r=65535&576/3*(a+1),h=T0/8-1;do{let c,m,o,f,i,b=h<<2;if(b<0||b>=Ve.length){console.error("rv_tbl index out of bounds:",b);break}let d=Ve[b]&255;c=this.window_s[d]*n[s][l+d+r],i=this.window_s[127-d]*n[s][l+d+r+128],m=c-i,c=c+i,o=this.window_s[d+64]*n[s][l+d+r+64],i=this.window_s[63-d]*n[s][l+d+r+192],f=o-i,o=o+i,_-=4,t[a][_+0]=c+o,t[a][_+2]=c-o,t[a][_+1]=m+f,t[a][_+3]=m-f,c=this.window_s[d+1]*n[s][l+d+r+1],i=this.window_s[126-d]*n[s][l+d+r+129],m=c-i,c=c+i,o=this.window_s[d+65]*n[s][l+d+r+65],i=this.window_s[62-d]*n[s][l+d+r+193],f=o-i,o=o+i,t[a][_+T0/2+0]=c+o,t[a][_+T0/2+2]=c-o,t[a][_+T0/2+1]=m+f,t[a][_+T0/2+3]=m-f}while(--h>=0);Wt(t[a],0,T0/2)}}fft_long(e,t,s,n,l){let a=A0/8-1,_=A0/2;do{let r,h,c,m,o;if(a<0||a>=Ve.length){console.error("rv_tbl index out of bounds:",a);break}let f=Ve[a]&255;r=this.window[f]*n[s][l+f],o=this.window[f+512]*n[s][l+f+512],h=r-o,r=r+o,c=this.window[f+256]*n[s][l+f+256],o=this.window[f+768]*n[s][l+f+768],m=c-o,c=c+o,_-=4,t[_+0]=r+c,t[_+2]=r-c,t[_+1]=h+m,t[_+3]=h-m,r=this.window[f+1]*n[s][l+f+1],o=this.window[f+513]*n[s][l+f+513],h=r-o,r=r+o,c=this.window[f+257]*n[s][l+f+257],o=this.window[f+769]*n[s][l+f+769],m=c-o,c=c+o,t[_+A0/2+0]=r+c,t[_+A0/2+2]=r-c,t[_+A0/2+1]=h+m,t[_+A0/2+3]=h-m}while(--a>=0);Wt(t,0,A0/2)}};var{VbrMode:_e,Float:J1,ShortBlock:le,Util:f0,Arrays:g1,new_float:n0,new_float_n:S0,new_int:D0,new_int_n:es,assert:V}=G,rt=2.302585092994046,Qt=.2302585093,ot=2,$t=16,ts=2,ss=16,is=.34,ns=1/(14752*14752)/(x.BLKSIZE/2),as=.01,Jt=.8,gt=.6,pe=.3,_s=3.5,e1=4.4,t1=25,P0=21;var ls=8,rs=23,os=15,mt,Xe,a1;function hs(){mt=Math.pow(10,(ls+1)/16),Xe=Math.pow(10,(rs+1)/16),a1=Math.pow(10,os/10)}var w0=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749],s1=[3.3246*3.3246,3.23837*3.23837,3.15437*3.15437,3.00412*3.00412,2.86103*2.86103,2.65407*2.65407,2.46209*2.46209,2.284*2.284,2.11879*2.11879,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,1.56911*1.56911,1.46658*1.46658,1.37074*1.37074,1.31036*1.31036,1.25264*1.25264,1.20648*1.20648,1.16203*1.16203,1.12765*1.12765,1.09428*1.09428,1.0659*1.0659,1.03826*1.03826,1.01895*1.01895,1],cs=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1],i1=[2.35364*2.35364,2.29259*2.29259,2.23313*2.23313,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,1.49999*1.49999,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.11084*1.11084,1.03826*1.03826],ms=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1],ft=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2],n1=ft,ht=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130],ct=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1],re=class{constructor(){S(this,"fft");this.fft=new Fe,this.s3ind=es([x.CBANDS,2]),this.s3=S0([x.CBANDS,x.CBANDS])}_psycho_loudness_approx(e,t){let s=0;for(let n=0;n<x.BLKSIZE/2;++n)s+=e[n]*t.ATH.eql_w[n];return s*=ns,s}_compute_ffts(e,t,s,n,l,a,_,r,h,c,m){let o=e.internal_flags,f=n[l],i=a[_];if(h<2)this.fft.fft_long(o,f,h,c,m),this.fft.fft_short(o,i,h,c,m);else if(h===2){let v=n[0],M=n[1];for(let w=x.BLKSIZE-1;w>=0;--w){let y=v[w],u=M[w];n[0][w]=(y+u)*f0.SQRT2*.5,n[1][w]=(y-u)*f0.SQRT2*.5}let p=a[0],B=a[1];for(let w=2;w>=0;--w)for(let y=x.BLKSIZE_s-1;y>=0;--y){let u=p[w][y],E=B[w][y];a[0][w][y]=(u+E)*f0.SQRT2*.5,a[1][w][y]=(u-E)*f0.SQRT2*.5}}let b=n[l];t[0]=b[0],t[0]*=t[0];for(let v=x.BLKSIZE/2-1;v>=0;--v){let M=b[x.BLKSIZE/2-v],p=b[x.BLKSIZE/2+v];t[x.BLKSIZE/2-v]=(M*M+p*p)*.5}let d=a[_];for(let v=2;v>=0;--v){s[v][0]=d[v][0],s[v][0]*=s[v][0];for(let M=x.BLKSIZE_s/2-1;M>=0;--M){let p=d[v][x.BLKSIZE_s/2-M],B=d[v][x.BLKSIZE_s/2+M];s[v][x.BLKSIZE_s/2-M]=(p*p+B*B)*.5}}{let v=0;for(let M=11;M<x.HBLKSIZE;M++)v+=t[M];o.tot_ener[h]=v}if(e.analysis){for(let v=0;v<x.HBLKSIZE;v++)o.pinfo.energy[r][h][v]=o.pinfo.energy_save[h][v],o.pinfo.energy_save[h][v]=t[v];o.pinfo.pe[r][h]=o.pe[h]}e.athaa_loudapprox===2&&h<2&&(o.loudness_sq[r][h]=o.loudness_sq_save[h],o.loudness_sq_save[h]=this._psycho_loudness_approx(t,o))}_mask_add(e,t,s,n,l,a){let _;if(t>e)if(t<e*Xe)_=t/e;else return e+t;else{if(e>=t*Xe)return e+t;_=e/t}V(e>=0),V(t>=0);let r=e+t;if(n+3<=6){if(_>=mt)return r;let m=0|f0.FAST_LOG10_X(_,16);return r*cs[m]}let h=0|f0.FAST_LOG10_X(_,16),c;if(a!==0?c=l.ATH.cb_s[s]*l.ATH.adjust:c=l.ATH.cb_l[s]*l.ATH.adjust,V(c>=0),r<a1*c){if(r>c){let m=1;h<=13&&(m=i1[h]);let o=f0.FAST_LOG10_X(r/c,10/15);return r*((s1[h]-m)*o+m)}return h>13?r:r*i1[h]}return r*s1[h]}_vbrpsy_mask_add(e,t,s){let n;if(e<0&&(e=0),t<0&&(t=0),e<=0)return t;if(t<=0)return e;if(t>e?n=t/e:n=e/t,-2<=s&&s<=2){if(n>=mt)return e+t;{let l=0|f0.FAST_LOG10_X(n,16);return(e+t)*ms[l]}}return n<Xe?e+t:e<t?t:e}_calc_interchannel_masking(e,t){let s=e.internal_flags;if(s.channels_out>1){for(let n=0;n<x.SBMAX_l;n++){let l=s.thm[0].l[n],a=s.thm[1].l[n];s.thm[0].l[n]+=a*t,s.thm[1].l[n]+=l*t}for(let n=0;n<x.SBMAX_s;n++)for(let l=0;l<3;l++){let a=s.thm[0].s[n][l],_=s.thm[1].s[n][l];s.thm[0].s[n][l]+=_*t,s.thm[1].s[n][l]+=a*t}}}_msfix1(e){for(let t=0;t<x.SBMAX_l;t++){let s=e.thm[0].l[t],n=e.thm[1].l[t];if(s>1.58*n||n>1.58*s)continue;let l=e.thm[2].l[t],a=e.thm[3].l[t],_=e.en[2].l[t],r=e.en[3].l[t],h=e.mld_l[t],c=h*r,m=Math.max(l,Math.min(a,c)),o=h*_,f=Math.max(a,Math.min(l,o));e.thm[2].l[t]=m,e.thm[3].l[t]=f}for(let t=0;t<x.SBMAX_s;t++)for(let s=0;s<3;s++){let n=e.thm[0].s[t][s],l=e.thm[1].s[t][s];if(n>1.58*l||l>1.58*n)continue;let a=e.thm[2].s[t][s],_=e.thm[3].s[t][s],r=e.en[2].s[t][s],h=e.en[3].s[t][s],c=e.mld_s[t],m=c*h,o=Math.max(a,Math.min(_,m)),f=c*r,i=Math.max(_,Math.min(a,f));e.thm[2].s[t][s]=o,e.thm[3].s[t][s]=i}}_ns_msfix(e,t,s){let n=t*2,l=Math.pow(10,s);for(let a=0;a<x.SBMAX_l;a++){let _=e.ATH.cb_l[e.bm_l[a]]*l,r=Math.max(e.thm[0].l[a],_),h=Math.max(e.thm[1].l[a],_),c=Math.max(e.thm[2].l[a],_),m=Math.max(e.thm[3].l[a],_),o=Math.min(r,h),f=c+m;if(f>0&&o*n<f){let i=o*n/f;c*=i,m*=i,V(c+m>=0)}e.thm[2].l[a]=Math.min(c,e.thm[2].l[a]),e.thm[3].l[a]=Math.min(m,e.thm[3].l[a])}l*=x.BLKSIZE_s/x.BLKSIZE;for(let a=0;a<x.SBMAX_s;a++)for(let _=0;_<3;_++){let r=e.ATH.cb_s[e.bm_s[a]]*l,h=Math.max(e.thm[0].s[a][_],r),c=Math.max(e.thm[1].s[a][_],r),m=Math.max(e.thm[2].s[a][_],r),o=Math.max(e.thm[3].s[a][_],r),f=Math.min(h,c),i=m+o;if(i>0&&f*t<i){let b=f*t/i;m*=b,o*=b,V(m+o>=0)}e.thm[2].s[a][_]=Math.min(e.thm[2].s[a][_],m),e.thm[3].s[a][_]=Math.min(e.thm[3].s[a][_],o)}}_convert_partition2scalefac_s(e,t,s,n,l){let a,_,r=0,h=0,c=e.npart_s;for(a=_=0;a<x.SBMAX_s;++a){let m=e.bo_s[a],o=m<c?m:c;for(;_<o;)V(t[_]>=0),V(s[_]>=0),r+=t[_],h+=s[_],_++;if(e.en[n].s[a][l]=r,e.thm[n].s[a][l]=h,_>=c){++a;break}V(t[_]>=0),V(s[_]>=0);{let f=e.PSY.bo_s_weight[a],i=1-f,b=f*t[_],d=f*s[_];e.en[n].s[a][l]+=b,e.thm[n].s[a][l]+=d,r=i*t[_],h=i*s[_]}_++}for(;a<x.SBMAX_s;++a)e.en[n].s[a][l]=0,e.thm[n].s[a][l]=0}_convert_partition2scalefac_l(e,t,s,n){let l,a,_=0,r=0,h=e.npart_l;for(l=a=0;l<x.SBMAX_l;++l){let c=e.bo_l[l],m=c<h?c:h;for(;a<m;)V(t[a]>=0),V(s[a]>=0),_+=t[a],r+=s[a],a++;if(e.en[n].l[l]=_,e.thm[n].l[l]=r,a>=h){++l;break}V(t[a]>=0),V(s[a]>=0);{let o=e.PSY.bo_l_weight[l],f=1-o,i=o*t[a],b=o*s[a];e.en[n].l[l]+=i,e.thm[n].l[l]+=b,_=f*t[a],r=f*s[a]}a++}for(;l<x.SBMAX_l;++l)e.en[n].l[l]=0,e.thm[n].l[l]=0}_compute_masking_s(e,t,s,n,l,a){let _=e.internal_flags,r,h;for(h=r=0;h<_.npart_s;++h){let m=0,o=_.numlines_s[h];for(let f=0;f<o;++f,++r)m+=t[a][r];s[h]=m}V(h===_.npart_s),V(r===x.HBLKSIZE_s);let c=0;for(h=0;h<_.npart_s;h++){let m=_.s3ind_s[h][0],o=_.s3ind_s[h][1],f=m,i=0;for(;f<=o;)i+=_.s3_ss[c]*s[f],c++,f++;{let b=ts*_.nb_s1[l][h];if(n[h]=Math.min(i,b),_.blocktype_old[l&1]===x.SHORT_TYPE){let d=ss*_.nb_s2[l][h];n[h]=Math.min(n[h],d)}}_.nb_s2[l][h]=_.nb_s1[l][h],_.nb_s1[l][h]=i,V(n[h]>=0)}for(V(h===_.npart_s);h<=x.CBANDS;++h)s[h]=0,n[h]=0;h<=x.CBANDS+1&&(n[h]=0)}_block_type_set(e,t,s,n){let l=e.internal_flags;e.short_blocks===le.short_block_coupled&&!(t[0]!==0&&t[1]!==0)&&(t[0]=t[1]=0);for(let a=0;a<l.channels_out;a++){e.short_blocks===le.short_block_dispensed&&(t[a]=1),e.short_blocks===le.short_block_forced&&(t[a]=0),n[a]=x.NORM_TYPE;let _=l.blocktype_old[a];t[a]!==0?(V(l.blocktype_old[a]!==x.START_TYPE),l.blocktype_old[a]===x.SHORT_TYPE&&(n[a]=x.STOP_TYPE,_=x.STOP_TYPE)):(n[a]=x.SHORT_TYPE,l.blocktype_old[a]===x.NORM_TYPE?_=x.START_TYPE:l.blocktype_old[a]===x.STOP_TYPE&&(_=x.SHORT_TYPE)),s[a]=_,l.blocktype_old[a]=n[a]}}_NS_INTERP(e,t,s){return s>=1?e:s<=0?t:t>0?Math.pow(e/t,s)*t:0}_pecalc_s(e,t){let s=309.07;for(let n=0;n<x.SBMAX_s-1;n++){V(n<ht.length);for(let l=0;l<3;l++){let a=e.thm.s[n][l];if(a>0){let _=a*t,r=e.en.s[n][l];r>_&&(r>_*1e10?s+=ht[n]*(10*rt):(V(_>0),s+=ht[n]*f0.FAST_LOG10(r/_)))}}}return s}_pecalc_l(e,t){let s=281.0575;for(let n=0;n<x.SBMAX_l-1;n++){V(n<ct.length);let l=e.thm.l[n];if(l>0){let a=l*t,_=e.en.l[n];_>a&&(_>a*1e10?s+=ct[n]*(10*rt):(V(a>0),s+=ct[n]*f0.FAST_LOG10(_/a)))}}return s}_calc_energy(e,t,s,n,l){let a,_;for(a=_=0;a<e.npart_l;++a){let r=0,h=0,c=e.numlines_l[a];for(let m=0;m<c;++m,++_){let o=t[_];V(o>=0),r+=o,h<o&&(h=o)}s[a]=r,n[a]=h,l[a]=r*e.rnumlines_l[a],V(e.rnumlines_l[a]>=0),V(r>=0),V(s[a]>=0),V(n[a]>=0),V(l[a]>=0)}V(a===e.npart_l),V(_===x.HBLKSIZE)}_calc_mask_index_l(e,t,s,n){let l=w0.length-1,a=0,_=s[a]+s[a+1];if(V(_>=0),_>0){let r=t[a];r<t[a+1]&&(r=t[a+1]);let h=e.numlines_l[a]+e.numlines_l[a+1];V(h-1>0),_=20*(r*2-_)/(_*(h-1));let c=0|_;c<0&&(c=0),c>l&&(c=l),n[a]=c}else n[a]=0;for(a=1;a<e.npart_l-1;a++)if(_=s[a-1]+s[a]+s[a+1],V(_>=0),_>0){let r=t[a-1];r<t[a]&&(r=t[a]),r<t[a+1]&&(r=t[a+1]);let h=e.numlines_l[a-1]+e.numlines_l[a]+e.numlines_l[a+1];V(h-1>0),_=20*(r*3-_)/(_*(h-1));let c=0|_;c<0&&(c=0),c>l&&(c=l),n[a]=c}else n[a]=0;if(V(a>0),V(a===e.npart_l-1),_=s[a-1]+s[a],V(_>=0),_>0){let r=t[a-1];r<t[a]&&(r=t[a]);let h=e.numlines_l[a-1]+e.numlines_l[a];V(h-1>0),_=20*(r*2-_)/(_*(h-1));let c=0|_;c<0&&(c=0),c>l&&(c=l),n[a]=c}else n[a]=0;V(a===e.npart_l-1)}_psyvbr_calc_mask_index_s(e,t,s,n){let l=w0.length-1,a=0,_=s[a]+s[a+1];if(V(_>=0),_>0){let r=t[a];r<t[a+1]&&(r=t[a+1]);let h=e.numlines_s[a]+e.numlines_s[a+1];V(h-1>0),_=20*(r*2-_)/(_*(h-1));let c=0|_;c<0&&(c=0),c>l&&(c=l),n[a]=c}else n[a]=0;for(a=1;a<e.npart_s-1;a++)if(_=s[a-1]+s[a]+s[a+1],V(a+1<e.npart_s),V(_>=0),_>0){let r=t[a-1];r<t[a]&&(r=t[a]),r<t[a+1]&&(r=t[a+1]);let h=e.numlines_s[a-1]+e.numlines_s[a]+e.numlines_s[a+1];V(h-1>0),_=20*(r*3-_)/(_*(h-1));let c=0|_;c<0&&(c=0),c>l&&(c=l),n[a]=c}else n[a]=0;if(V(a>0),V(a===e.npart_s-1),_=s[a-1]+s[a],V(_>=0),_>0){let r=t[a-1];r<t[a]&&(r=t[a]);let h=e.numlines_s[a-1]+e.numlines_s[a];V(h-1>0),_=20*(r*2-_)/(_*(h-1));let c=0|_;c<0&&(c=0),c>l&&(c=l),n[a]=c}else n[a]=0;V(a===e.npart_s-1)}_vbrpsy_compute_masking_s(e,t,s,n,l,a){let _=e.internal_flags,r=n0(x.CBANDS),h=n0(x.CBANDS),c=D0(x.CBANDS),m,o,f;for(f=o=0;f<_.npart_s;++f){let b=0,d=0,v=_.numlines_s[f];for(m=0;m<v;++m,++o){let M=t[a][o];b+=M,d<M&&(d=M)}s[f]=b,V(b>=0),r[f]=d,V(v>0),h[f]=b/v,V(h[f]>=0)}for(V(f===_.npart_s),V(o===x.HBLKSIZE_s);f<x.CBANDS;++f)r[f]=0,h[f]=0;this._psyvbr_calc_mask_index_s(_,r,h,c);let i=0;for(f=0;f<_.npart_s;f++){let b=_.s3ind_s[f][0],d=_.s3ind_s[f][1],v=b,M=0,p=0,B=0;if(v<=d){for(p=c[v],B=1,M=_.s3_ss[i]*s[v]*w0[c[v]],i++,v++;v<=d;){p+=c[v],B+=1;let y=_.s3_ss[i]*s[v]*w0[c[v]];M=this._vbrpsy_mask_add(M,y,v-f),i++,v++}p=(1+2*p)/(2*B);let w=w0[p]*.5;M*=w}else M=0;n[f]=M,_.nb_s2[l][f]=_.nb_s1[l][f],_.nb_s1[l][f]=M;{let w=r[f]*_.minval_s[f]*w0[(1+2*p)/(2*B)]*.5;n[f]>w&&(n[f]=w)}_.masking_lower>1&&(n[f]*=_.masking_lower),n[f]>s[f]&&(n[f]=s[f]),_.masking_lower<1&&(n[f]*=_.masking_lower),V(n[f]>=0)}for(V(f===_.npart_s);f<x.CBANDS;++f)s[f]=0,n[f]=0;for(;f<=x.CBANDS+1;++f)n[f]=0}_vbrpsy_compute_masking_l(e,t,s,n,l){let a=n0(x.CBANDS),_=n0(x.CBANDS),r=D0(x.CBANDS+2),h;this._calc_energy(e,t,s,a,_),this._calc_mask_index_l(e,a,_,r);let c=0;for(h=0;h<e.npart_l;h++){let m=0,o=0,f=0,i=e.s3ind[h][0],b=e.s3ind[h][1],d=i;if(d<=b){for(o=r[d],f=1,m=e.s3_ll[c]*s[d]*w0[r[d]],c++,d++;d<=b;){o+=r[d],f+=1;let p=e.s3_ll[c]*s[d]*w0[r[d]];m=this._vbrpsy_mask_add(m,p,d-h),c++,d++}o=(1+2*o)/(2*f);let M=w0[o]*.5;m*=M}else m=0;let v=e.blocktype_old[l&1];if(v===x.SHORT_TYPE||v===x.START_TYPE){let M=ot*e.nb_1[l][h];M>0?n[h]=Math.min(m,M):n[h]=Math.min(m,s[h]*pe)}else{let M=$t*e.nb_2[l][h],p=ot*e.nb_1[l][h];M<=0&&(M=m),p<=0&&(p=m);let B=v===x.NORM_TYPE?Math.min(p,M):p;n[h]=Math.min(m,B)}e.nb_2[l][h]=e.nb_1[l][h],e.nb_1[l][h]=m;{let M=a[h]*e.minval_l[h]*w0[(1+2*o)/(2*f)]*.5;n[h]>M&&(n[h]=M)}e.masking_lower>1&&(n[h]*=e.masking_lower),n[h]>s[h]&&(n[h]=s[h]),e.masking_lower<1&&(n[h]*=e.masking_lower),V(n[h]>=0)}for(V(h===e.npart_l);h<x.CBANDS;++h)s[h]=0,n[h]=0;for(;h<=x.CBANDS+1;++h)n[h]=0}_vbrpsy_compute_block_type(e,t){let s=e.internal_flags;e.short_blocks===le.short_block_coupled&&!(t[0]!==0&&t[1]!==0)&&(t[0]=t[1]=0);for(let n=0;n<s.channels_out;n++)e.short_blocks===le.short_block_dispensed&&(t[n]=1),e.short_blocks===le.short_block_forced&&(t[n]=0)}_vbrpsy_apply_block_type(e,t,s){let n=e.internal_flags;for(let l=0;l<n.channels_out;l++){let a=x.NORM_TYPE,_=n.blocktype_old[l];t[l]!==0?(V(n.blocktype_old[l]!==x.START_TYPE),n.blocktype_old[l]===x.SHORT_TYPE&&(a=x.STOP_TYPE,_=x.STOP_TYPE)):(a=x.SHORT_TYPE,n.blocktype_old[l]===x.NORM_TYPE?_=x.START_TYPE:n.blocktype_old[l]===x.STOP_TYPE&&(_=x.SHORT_TYPE)),s[l]=_,n.blocktype_old[l]=a}}_vbrpsy_compute_MS_thresholds(e,t,s,n,l,a,_){let r=a*2,h=a>0?l:1,c,m;for(let o=0;o<_;++o){let f=e[2][o],i=e[3][o],b=t[0][o],d=t[1][o],v=t[2][o],M=t[3][o];if(b<=1.58*d&&d<=1.58*b){let p=s[o],B=p*i,w=p*f;m=Math.max(v,Math.min(M,B)),c=Math.max(M,Math.min(v,w))}else m=v,c=M;if(a>0){let p=n[o]*h,B=Math.max(b,p),w=Math.max(d,p),y=Math.max(m,p),u=Math.max(c,p),E=Math.min(B,w),I=y+u;if(I>0&&E*r<I){let N=E*r/I;y*=N,u*=N,V(y+u>=0)}m=Math.min(y,m),c=Math.min(u,c)}m>f&&(m=f),c>i&&(c=i),t[2][o]=m,t[3][o]=c}}_vbrpsy_compute_fft_l(e,t,s,n,l,a,_,r){let h=e.internal_flags,c=_[r];if(n<2)this.fft.fft_long(h,c,n,t,s);else if(n===2){let m=_[0],o=_[1];for(let f=x.BLKSIZE-1;f>=0;--f){let i=m[f],b=o[f];_[0][f]=(i+b)*f0.SQRT2*.5,_[1][f]=(i-b)*f0.SQRT2*.5}}a[0]=c[0],a[0]*=a[0];for(let m=x.BLKSIZE/2-1;m>=0;--m){let o=c[x.BLKSIZE/2-m],f=c[x.BLKSIZE/2+m];a[x.BLKSIZE/2-m]=(o*o+f*f)*.5}{let m=0;for(let o=11;o<x.HBLKSIZE;o++)m+=a[o];h.tot_ener[n]=m}if(e.analysis){for(let m=0;m<x.HBLKSIZE;m++)h.pinfo.energy[l][n][m]=h.pinfo.energy_save[n][m],h.pinfo.energy_save[n][m]=a[m];h.pinfo.pe[l][n]=h.pe[n]}}_vbrpsy_compute_fft_s(e,t,s,n,l,a,_,r){let h=e.internal_flags,c=_[r];if(l===0&&n<2&&this.fft.fft_short(h,c,n,t,s),n===2){let o=_[0],f=_[1];for(let i=x.BLKSIZE_s-1;i>=0;--i){let b=o[l][i],d=f[l][i];_[0][l][i]=(b+d)*f0.SQRT2*.5,_[1][l][i]=(b-d)*f0.SQRT2*.5}}let m=c[l];a[l][0]=m[0],a[l][0]*=a[l][0];for(let o=x.BLKSIZE_s/2-1;o>=0;--o){let f=m[x.BLKSIZE_s/2-o],i=m[x.BLKSIZE_s/2+o];a[l][x.BLKSIZE_s/2-o]=(f*f+i*i)*.5}}_vbrpsy_compute_loudness_approximation_l(e,t,s,n){let l=e.internal_flags;e.athaa_loudapprox===2&&s<2&&(l.loudness_sq[t][s]=l.loudness_sq_save[s],l.loudness_sq_save[s]=this._psycho_loudness_approx(n,l))}_vbrpsy_attack_detection(e,t,s,n,l,a,_,r,h,c){let m=S0([2,576]),o=e.internal_flags,f=o.channels_out,i=e.mode===j.JOINT_STEREO?4:f;for(let b=0;b<f;b++){let d=t[b],v=s+288-(P0-1)/2;for(let M=0;M<576;M++){let p=0,B=0,w=v+M;p=d[w+10];for(let y=0;y<(P0-1)/2;y+=2)p+=n1[y]*(d[w+y]+d[w+P0-1-y]),B+=n1[y+1]*(d[w+y+1]+d[w+P0-1-(y+1)]);m[b][M]=p+B}l[n][b].en.assign(o.en[b]),l[n][b].thm.assign(o.thm[b]),i>2&&(a[n][b].en.assign(o.en[b+2]),a[n][b].thm.assign(o.thm[b+2]))}for(let b=0;b<i;b++){let d=n0(12),v=n0(12),M=[0,0,0,0],p=b===3?t1:e1,B=1;if(b===2)for(let u=0;u<576;++u){let E=m[0][u],I=m[1][u];m[0][u]=E+I,m[1][u]=E-I}let w=m[b&1],y=0;for(let u=0;u<3;u++)v[u]=o.nsPsy.last_en_subshort[b][u+6],V(o.nsPsy.last_en_subshort[b][u+4]>0),d[u]=v[u]/o.nsPsy.last_en_subshort[b][u+4],M[0]+=v[u];for(let u=0;u<9;u++){let E=y+64,I=1;for(;y<E;y++){let X=Math.abs(w[y]);I<X&&(I=X)}o.nsPsy.last_en_subshort[b][u]=v[u+3]=I,M[1+Math.floor(u/3)]+=I;let N=v[u+3-2];I>N?(V(N>0),d[u+3]=I/N):N>I*10?(V(I>0),d[u+3]=N/(I*10)):d[u+3]=0}for(let u=0;u<3;++u){let E=u*3+3,I=v[E]+v[E+1]+v[E+2],N=1;I>0&&v[E+2]*6<I&&(N*=.5,v[E+1]*6<I&&(N*=.5)),r[b][u]=N}if(e.analysis){let u=d[0];for(let E=1;E<12;E++)u<d[E]&&(u=d[E]);o.pinfo.ers[n][b]=o.pinfo.ers_save[b],o.pinfo.ers_save[b]=u}g1.fill(h[b],0);for(let u=0;u<12;u++){let E=Math.floor(u/3);h[b][E]===0&&d[u]>p&&(h[b][E]=u%3+1)}for(let u=1;u<4;u++){let E=M[u-1],I=M[u];Math.max(E,I)<4e4&&E<1.7*I&&I<1.7*E&&(u===1&&h[b][0]<=h[b][u]&&(h[b][0]=0),h[b][u]=0)}h[b][0]<=o.nsPsy.lastAttacks[b]&&(h[b][0]=0),(o.nsPsy.lastAttacks[b]===3||h[b][0]+h[b][1]+h[b][2]+h[b][3]!==0)&&(B=0,h[b][1]!==0&&h[b][0]!==0&&(h[b][1]=0),h[b][2]!==0&&h[b][1]!==0&&(h[b][2]=0),h[b][3]!==0&&h[b][2]!==0&&(h[b][3]=0)),b<2?c[b]=B:B===0&&(c[0]=c[1]=0),_[b]=o.tot_ener[b]}}_vbrpsy_skip_masking_s(e,t,s){if(s===0)for(let n=0;n<e.npart_s;n++)e.nb_s2[t][n]=e.nb_s1[t][n],e.nb_s1[t][n]=0}_vbrpsy_skip_masking_l(e,t){for(let s=0;s<e.npart_l;s++)e.nb_2[t][s]=e.nb_1[t][s],e.nb_1[t][s]=0}_s3_func_x(e,t){let s=e,n;return s>=0?n=-s*27:n=s*t,n<=-72?0:Math.exp(n*Qt)}_norm_s3_func_x(e){let t=0,s=0;{let n=0,l,a;for(n=0;this._s3_func_x(n,e)>1e-20;n-=1);for(l=n,a=0;Math.abs(a-l)>1e-12;)n=(a+l)/2,this._s3_func_x(n,e)>0?a=n:l=n;t=l}{let n=0,l,a;for(n=0;this._s3_func_x(n,e)>1e-20;n+=1);for(l=0,a=n;Math.abs(a-l)>1e-12;)n=(a+l)/2,this._s3_func_x(n,e)>0?l=n:a=n;s=a}{let n=0,l=1e3,a=(s-t)/l;for(let r=0;r<=l;++r){let h=t+r*a;n+=this._s3_func_x(h,e)}return n===0||s===t?1:(l+1)/(n*(s-t))}}_s3_func(e){let t,s,n,l;return t=e,t>=0?t*=3:t*=1.5,t>=.5&&t<=2.5?(l=t-.5,s=8*(l*l-2*l)):s=0,t+=.474,n=15.811389+7.5*t-17.5*Math.sqrt(1+t*t),n<=-60?0:(t=Math.exp((s+n)*Qt),t/=.6609193,t)}_freq2bark(e){return e<0&&(e=0),e=e*.001,13*Math.atan(.76*e)+3.5*Math.atan(e*e/(7.5*7.5))}_init_numline(e,t,s,n,l,a,_,r,h,c,m,o){let f=n0(x.CBANDS+1),i=o>15?576:192,b=r/(2*i),d=D0(x.HBLKSIZE),v=0,M=r/h,p=0;for(let w=0;w<x.CBANDS;w++){let y=this._freq2bark(M*p);f[w]=M*p;let u=p;for(;this._freq2bark(M*u)-y<is&&u<=h/2;)u++;for(e[w]=u-p,v=w+1;p<u;)V(p<x.HBLKSIZE),d[p++]=w;if(p>h/2){p=h/2;break}}V(v<x.CBANDS),f[v]=M*p;for(let w=0;w<o;w++){let y=c[w],u=c[w+1],E=0|Math.floor(.5+m*(y-.5));E<0&&(E=0);let I=0|Math.floor(.5+m*(u-.5));I>=h/2&&(I=h/2-1),I<E&&(I=E);let N=E<x.HBLKSIZE?d[E]:v-1,X=I<x.HBLKSIZE?d[I]:v-1;s[w]=Math.floor((N+X)/2),t[w]=X;let F=b*u,R=f[t[w]],T=f[t[w]+1];T>R?_[w]=(F-R)/(T-R):_[w]=F>=R?1:0,_[w]<0?_[w]=0:_[w]>1&&(_[w]=1);let k=M*E;a[w]=this._stereo_demask(k)}let B=0;for(let w=0;w<v;w++){let y=e[w];if(y>0){let u=this._freq2bark(M*B),E=this._freq2bark(M*(B+y-1));n[w]=.5*(u+E);let I=this._freq2bark(M*(B-.5)),N=this._freq2bark(M*(B+y-.5));l[w]=N-I}else n[w]=w>0?n[w-1]:0,l[w]=0;B+=y}return v}_init_s3_values(e,t,s,n,l){let a=S0([x.CBANDS,x.CBANDS]),_=0;if(l)for(let c=0;c<e;c++)for(let m=0;m<e;m++)a[c][m]=this._s3_func(t[c]-t[m])*s[m]*n[c];else for(let c=0;c<e;c++){let m=15+Math.min(21/(t[c]>0?t[c]:1e-6),12),o=this._norm_s3_func_x(m);for(let f=0;f<e;f++)a[f][c]=o*this._s3_func_x(t[f]-t[c],m)*s[c]*n[f]}for(let c=0;c<e;c++)this.s3ind[c][0]=0,this.s3ind[c][1]=e-1;for(let c=0;c<e;c++){let m,o;for(m=0;m<e&&!(a[c][m]>1e-20);m++);for(o=e-1;o>=m&&!(a[c][o]>1e-20);o--);m<=o?(this.s3ind[c][0]=m,this.s3ind[c][1]=o,_+=o-m+1):(this.s3ind[c][0]=0,this.s3ind[c][1]=-1)}let r=n0(_),h=0;for(let c=0;c<e;c++){let m=this.s3ind[c][0],o=this.s3ind[c][1];if(m<=o)for(let f=m;f<=o;f++)r[h++]=a[c][f]}return V(h===_),r}_stereo_demask(e){let t=this._freq2bark(e);return t=Math.min(t,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*t))-2.5)}_ATHformula_GB(e,t){return e<-.3&&(e=3410),e/=1e3,e=Math.max(.1,e),3.64*Math.pow(e,-.8)-6.8*Math.exp(-.6*Math.pow(e-3.4,2))+6*Math.exp(-.15*Math.pow(e-8.7,2))+(.6+.04*t)*.001*Math.pow(e,4)}L3psycho_anal_ns(e,t,s,n,l,a,_,r,h,c){let m=e.internal_flags,o=S0([2,x.BLKSIZE]),f=S0([2,3,x.BLKSIZE_s]),i=n0(x.CBANDS+1),b=n0(x.CBANDS+1),d=n0(x.CBANDS+2),v=D0(2),M=D0(2),p=S0([2,576]),B,w=D0(x.CBANDS+2),y=m.channels_out;e.mode===j.JOINT_STEREO&&(y=4),e.VBR===_e.vbr_off?B=m.ResvMax===0?0:m.ResvSize/m.ResvMax*.5:e.VBR===_e.vbr_rh||e.VBR===_e.vbr_mtrh||e.VBR===_e.vbr_mt?B=.6:B=1;for(let u=0;u<m.channels_out;u++){let E=t[u],I=s+288-(P0-1)/2;for(let N=0;N<576;N++){let X=0,F=0,R=I+N;X=E[R+10];for(let T=0;T<(P0-1)/2;T+=2)X+=ft[T]*(E[R+T]+E[R+P0-1-T]),F+=ft[T+1]*(E[R+T+1]+E[R+P0-1-(T+1)]);p[u][N]=X+F}l[n][u].en.assign(m.en[u]),l[n][u].thm.assign(m.thm[u]),y>2&&(a[n][u].en.assign(m.en[u+2]),a[n][u].thm.assign(m.thm[u+2]))}for(let u=0;u<y;u++){let E=u&1,I=u&1,N=n0(12),X=[0,0,0,0],F=n0(12),R=1,T=n0(x.CBANDS),k=n0(x.CBANDS),O=[0,0,0,0],P=n0(x.HBLKSIZE),q=S0([3,x.HBLKSIZE_s]);for(let H=0;H<3;H++)N[H]=m.nsPsy.last_en_subshort[u][H+6],V(m.nsPsy.last_en_subshort[u][H+4]>0),F[H]=N[H]/m.nsPsy.last_en_subshort[u][H+4],X[0]+=N[H];if(u===2)for(let H=0;H<576;H++){let Z=p[0][H],D=p[1][H];p[0][H]=Z+D,p[1][H]=Z-D}{let H=p[u&1],Z=0;for(let D=0;D<9;D++){let $=Z+64,s0=1;for(;Z<$;Z++){let h0=Math.abs(H[Z]);s0<h0&&(s0=h0)}m.nsPsy.last_en_subshort[u][D]=N[D+3]=s0,X[1+Math.floor(D/3)]+=s0;let a0=N[D+3-2];s0>a0?(V(a0>0),F[D+3]=s0/a0):a0>s0*10?(V(s0>0),F[D+3]=a0/(s0*10)):F[D+3]=0}V(Z===576)}if(e.analysis){let H=F[0];for(let Z=1;Z<12;Z++)H<F[Z]&&(H=F[Z]);m.pinfo.ers[n][u]=m.pinfo.ers_save[u],m.pinfo.ers_save[u]=H}let Y=u===3?t1:e1;for(let H=0;H<12;H++)O[Math.floor(H/3)]===0&&F[H]>Y&&(O[Math.floor(H/3)]=H%3+1);for(let H=1;H<4;H++){let Z=X[H],D=X[H-1],$=1;D>0&&Z>0?$=D>Z?D/Z:Z/D:(D>0||Z>0)&&($=100),$<1.7&&(O[H]=0,H===1&&(O[0]=0))}O[0]!==0&&m.nsPsy.lastAttacks[u]!==0&&(O[0]=0),(m.nsPsy.lastAttacks[u]===3||O[0]+O[1]+O[2]+O[3]!==0)&&(R=0,O[1]!==0&&O[0]!==0&&(O[1]=0),O[2]!==0&&O[1]!==0&&(O[2]=0),O[3]!==0&&O[2]!==0&&(O[3]=0)),u<2?M[u]=R:R===0&&(M[0]=M[1]=0),h[u]=m.tot_ener[u],this._compute_ffts(e,P,q,o,E,f,I,n,u,t,s);for(let H=0;H<3;H++){this._compute_masking_s(e,q,b,d,u,H),this._convert_partition2scalefac_s(m,b,d,u,H);for(let Z=0;Z<x.SBMAX_s;Z++){let D=m.thm[u].s[Z][H];if(D*=Jt,O[H]>=2||O[H+1]===1){let a0=H!==0?H-1:2,h0=this._NS_INTERP(m.thm[u].s[Z][a0],D,gt*B);D=Math.min(D,h0)}if(O[H]===1){let a0=H!==0?H-1:2,h0=this._NS_INTERP(m.thm[u].s[Z][a0],D,pe*B);D=Math.min(D,h0)}else if(H!==0&&O[H-1]===3||H===0&&m.nsPsy.lastAttacks[u]===3){let a0=H!==2?H+1:0,h0=this._NS_INTERP(m.thm[u].s[Z][a0],D,pe*B);D=Math.min(D,h0)}let $=H*3+3,s0=N[$]+N[$+1]+N[$+2];s0>0&&N[$+2]*6<s0&&(D*=.5,N[$+1]*6<s0&&(D*=.5)),m.thm[u].s[Z][H]=D}}m.nsPsy.lastAttacks[u]=O[2],this._calc_energy(m,P,i,T,k),this._calc_mask_index_l(m,T,k,w);let t0=0;for(let H=0;H<m.npart_l;H++){let Z=m.s3ind[H][0],D=m.s3ind[H][1],$=Z,s0=0;if($<=D){let a0=i[$]*w0[w[$]];for(s0=m.s3_ll[t0]*a0,t0++,$++;$<=D;){a0=i[$]*w0[w[$]];let h0=m.s3_ll[t0]*a0;s0=this._mask_add(s0,h0,$,$-H,m,0),t0++,$++}}if(s0*=.158489319246111,m.blocktype_old[u&1]===x.SHORT_TYPE)d[H]=s0;else{let a0=Math.min(ot*m.nb_1[u][H],$t*m.nb_2[u][H]),h0=Math.min(s0,a0);d[H]=this._NS_INTERP(h0,s0,B)}m.nb_2[u][H]=m.nb_1[u][H],m.nb_1[u][H]=s0}for(let H=m.npart_l;H<=x.CBANDS;++H)i[H]=0,d[H]=0;m.npart_l<=x.CBANDS+1&&(d[m.npart_l+1]=0),this._convert_partition2scalefac_l(m,i,d,u)}if((e.mode===j.STEREO||e.mode===j.JOINT_STEREO)&&e.interChRatio>0&&this._calc_interchannel_masking(e,e.interChRatio),e.mode===j.JOINT_STEREO){this._msfix1(m);let u=e.msfix;if(Math.abs(u)>0){let E=Math.pow(10,e.ATHlower*m.ATH.adjust);this._ns_msfix(m,u,E)}}this._block_type_set(e,M,c,v);for(let u=0;u<y;u++){let E,I,N,X;u>1?(E=r,I=-2,N=x.NORM_TYPE,(c[0]===x.SHORT_TYPE||c[1]===x.SHORT_TYPE)&&(N=x.SHORT_TYPE),X=a[n][u-2]):(E=_,I=0,N=c[u],X=l[n][u]),N===x.SHORT_TYPE||N===x.STOP_TYPE||N===x.START_TYPE?E[I+u]=this._pecalc_s(X,m.masking_lower):E[I+u]=this._pecalc_l(X,m.masking_lower),e.analysis&&(m.pinfo.pe[n][u]=E[I+u])}return 0}L3psycho_anal_vbr(e,t,s,n,l,a,_,r,h,c){let m=e.internal_flags,o=S0([2,x.BLKSIZE]),f=S0([2,3,x.BLKSIZE_s]),i=n0(x.HBLKSIZE),b=S0([3,x.HBLKSIZE_s]),d=S0([4,x.CBANDS+1]),v=S0([4,x.CBANDS+2]),M=S0([4,3]),p=.6,B=new_array_n([4],()=>D0(4)),w=D0(2),y=e.mode===j.JOINT_STEREO?4:m.channels_out;this._vbrpsy_attack_detection(e,t,s,n,l,a,h,M,B,w),this._vbrpsy_compute_block_type(e,w);for(let E=0;E<y;E++){let I=E&1;this._vbrpsy_compute_fft_l(e,t,s,E,n,i,o,I),this._vbrpsy_compute_loudness_approximation_l(e,n,E,i),w[I]!==0?this._vbrpsy_compute_masking_l(m,i,d[E],v[E],E):this._vbrpsy_skip_masking_l(m,E)}if(w[0]!==0&&w[1]!==0){if(e.mode===j.JOINT_STEREO){let E=Math.pow(10,e.ATHlower*m.ATH.adjust);this._vbrpsy_compute_MS_thresholds(d,v,m.mld_cb_l,m.ATH.cb_l,E,e.msfix,m.npart_l)}for(let E=0;E<y;E++)this._convert_partition2scalefac_l(m,d[E],v[E],E)}if(w[0]===0||w[1]===0){for(let E=0;E<3;E++){for(let I=0;I<y;++I){let N=I&1;w[N]===0?(this._vbrpsy_compute_fft_s(e,t,s,I,E,b,f,N),this._vbrpsy_compute_masking_s(e,b,d[I],v[I],I,E)):this._vbrpsy_skip_masking_s(m,I,E)}if(w[0]===0&&w[1]===0){if(e.mode===j.JOINT_STEREO){let I=Math.pow(10,e.ATHlower*m.ATH.adjust)*(x.BLKSIZE_s/x.BLKSIZE);this._vbrpsy_compute_MS_thresholds(d,v,m.mld_cb_s,m.ATH.cb_s,I,e.msfix,m.npart_s)}for(let I=0;I<y;++I)this._convert_partition2scalefac_s(m,d[I],v[I],I,E)}else for(let I=0;I<y;++I)w[I&1]===0&&this._convert_partition2scalefac_s(m,d[I],v[I],I,E)}for(let E=0;E<y;E++){let I=E&1;if(w[I]===0){let N=n0(3);for(let X=0;X<x.SBMAX_s;X++){for(let F=0;F<3;F++){let R=m.thm[E].s[X][F];if(R*=Jt,B[E][F]>=2||B[E][F+1]===1){let T=F!==0?F-1:2,k=this._NS_INTERP(m.thm[E].s[X][T],R,gt*p);R=Math.min(R,k)}else if(B[E][F]===1){let T=F!==0?F-1:2,k=this._NS_INTERP(m.thm[E].s[X][T],R,pe*p);R=Math.min(R,k)}else if(F!==0&&B[E][F-1]===3||F===0&&m.nsPsy.lastAttacks[E]===3){let T=F!==2?F+1:0,k=this._NS_INTERP(m.thm[E].s[X][T],R,pe*p);R=Math.min(R,k)}R*=M[E][F],N[F]=R}for(let F=0;F<3;F++)m.thm[E].s[X][F]=N[F]}}}}for(let E=0;E<y;E++)m.nsPsy.lastAttacks[E]=B[E][2];this._vbrpsy_apply_block_type(e,w,c);for(let E=0;E<y;E++){let I,N,X,F;E>1?(I=r,N=-2,X=x.NORM_TYPE,(c[0]===x.SHORT_TYPE||c[1]===x.SHORT_TYPE)&&(X=x.SHORT_TYPE),F=a[n][E-2]):(I=_,N=0,X=c[E],F=l[n][E]),X===x.SHORT_TYPE||X===x.STOP_TYPE||X===x.START_TYPE?I[N+E]=this._pecalc_s(F,m.masking_lower):I[N+E]=this._pecalc_l(F,m.masking_lower),e.analysis&&(m.pinfo.pe[n][E]=I[N+E])}return 0}psymodel_init(e){let t=e.internal_flags,s,n,l,a=!0,_=13,r=24,h=0,c=0,m=-8.25,o=-4.5,f=n0(x.CBANDS),i=n0(x.CBANDS),b=n0(x.CBANDS),d=e.out_samplerate;switch(e.experimentalZ){default:case 0:a=!0;break;case 1:a=!(e.VBR===_e.vbr_mtrh||e.VBR===_e.vbr_mt);break;case 2:a=!1;break;case 3:_=8,h=-1.75,c=-.0125,m=-8.25,o=-2.25;break}for(t.ms_ener_ratio_old=.25,t.blocktype_old[0]=t.blocktype_old[1]=x.NORM_TYPE,s=0;s<4;++s){for(n=0;n<x.CBANDS;++n)t.nb_1[s][n]=1e20,t.nb_2[s][n]=1e20,t.nb_s1[s][n]=t.nb_s2[s][n]=1;if(t.en[s]&&t.thm[s]){for(let p=0;p<x.SBMAX_l;p++)t.en[s].l[p]=1e20,t.thm[s].l[p]=1e20;for(n=0;n<3;++n)for(let p=0;p<x.SBMAX_s;p++)t.en[s].s[p][n]=1e20,t.thm[s].s[p][n]=1e20}else return console.error(`gfc.en[${s}] or gfc.thm[${s}] is undefined in psymodel_init!`),-1;for(t.nsPsy.lastAttacks[s]=0,n=0;n<9;n++)t.nsPsy.last_en_subshort[s][n]=10}for(t.loudness_sq_save[0]=t.loudness_sq_save[1]=0,t.npart_l=this._init_numline(t.numlines_l,t.bo_l,t.bm_l,f,i,t.mld_l,t.PSY.bo_l_weight,d,x.BLKSIZE,t.scalefac_band.l,x.BLKSIZE/(2*576),x.SBMAX_l),V(t.npart_l<x.CBANDS),s=0;s<t.npart_l;s++){let p=h;f[s]>=_&&(p=c*(f[s]-_)/(r-_)+h*(r-f[s])/(r-_)),b[s]=Math.pow(10,p/10),t.rnumlines_l[s]=t.numlines_l[s]>0?1/t.numlines_l[s]:0}for(t.s3_ll=this._init_s3_values(t.npart_l,f,i,b,a),n=0,s=0;s<t.npart_l;s++){let p=f0.FLOAT_MAX;for(let B=0;B<t.numlines_l[s];B++,n++){let w=d*n/(1e3*x.BLKSIZE),y=this.ATHformula(w*1e3,e)-20;y=Math.pow(10,.1*y)*t.numlines_l[s],p=Math.min(p,y)}t.minval_l[s]=p}for(t.npart_s=this._init_numline(t.numlines_s,t.bo_s,t.bm_s,f,i,t.mld_s,t.PSY.bo_s_weight,d,x.BLKSIZE_s,t.scalefac_band.s,x.BLKSIZE_s/(2*192),x.SBMAX_s),V(t.npart_s<x.CBANDS),n=0,s=0;s<t.npart_s;s++){let p,B=m;for(f[s]>=_&&(B=o*(f[s]-_)/(r-_)+m*(r-f[s])/(r-_)),b[s]=Math.pow(10,B/10),p=J1.MAX_VALUE,l=0;l<t.numlines_s[s];l++,n++){let w=d*n/(1e3*x.BLKSIZE_s),y=this.ATHformula(w*1e3,e)-20;y=Math.pow(10,.1*y)*t.numlines_s[s],p>y&&(p=y)}t.ATH.cb_s[s]=p,p=-7+f[s]*7/12,f[s]>12&&(p*=1+Math.log(1+p)*3.1),f[s]<12&&(p*=1+Math.log(1-p)*2.3),p<-15&&(p=-15),p-=8,t.minval_s[s]=Math.pow(10,p/10)*t.numlines_s[s]}t.s3_ss=this._init_s3_values(t.npart_s,f,i,b,a),hs(),this.fft.init_fft(t),t.decay=Math.exp(-1*rt/(as*d/192));let v=_s;(e.exp_nspsytune&2)!=0&&(v=1),Math.abs(e.msfix)>0&&(v=e.msfix),e.msfix=v;for(let p=0;p<t.npart_l;p++)t.s3ind[p][1]>t.npart_l-1&&(t.s3ind[p][1]=t.npart_l-1);let M=576*t.mode_gr/d;if(t.ATH.decay=Math.pow(10,-12/10*M),t.ATH.adjust=.01,t.ATH.adjustLimit=1,e.ATHtype!=-1){let p=e.out_samplerate/x.BLKSIZE,B=0,w=0;for(s=0;s<x.BLKSIZE/2;++s)w+=p,t.ATH.eql_w[s]=1/Math.pow(10,this.ATHformula(w,e)/10),B+=t.ATH.eql_w[s];for(B>0?B=1/B:B=0,s=x.BLKSIZE/2;--s>=0;)t.ATH.eql_w[s]*=B}for(n=0,s=0;s<t.npart_l;s++){let p=d*(n+t.numlines_l[s]/2)/(1*x.BLKSIZE);t.mld_cb_l[s]=this._stereo_demask(p),n+=t.numlines_l[s]}for(;s<x.CBANDS;++s)t.mld_cb_l[s]=1;for(n=0,s=0;s<t.npart_s;s++){let p=d*(n+t.numlines_s[s]/2)/(1*x.BLKSIZE_s);t.mld_cb_s[s]=this._stereo_demask(p),n+=t.numlines_s[s]}for(;s<x.CBANDS;++s)t.mld_cb_s[s]=1;return 0}ATHformula(e,t){let s;switch(t.ATHtype){case 0:s=this._ATHformula_GB(e,9);break;case 1:s=this._ATHformula_GB(e,-1);break;case 2:s=this._ATHformula_GB(e,0);break;case 3:s=this._ATHformula_GB(e,1)+6;break;case 4:s=this._ATHformula_GB(e,t.ATHcurve);break;default:s=this._ATHformula_GB(e,0);break}return s}};var{VbrMode:Ba,ShortBlock:Ta}=G,qe=class{constructor(){S(this,"internal_flags",null);S(this,"class_id",0);S(this,"num_samples",0);S(this,"num_channels",0);S(this,"in_samplerate",0);S(this,"out_samplerate",0);S(this,"scale",0);S(this,"scale_left",0);S(this,"scale_right",0);S(this,"analysis",!1);S(this,"bWriteVbrTag",!1);S(this,"decode_only",!1);S(this,"quality",0);S(this,"mode",j.STEREO);S(this,"force_ms",!1);S(this,"free_format",!1);S(this,"findReplayGain",!1);S(this,"decode_on_the_fly",!1);S(this,"write_id3tag_automatic",!1);S(this,"brate",0);S(this,"compression_ratio",0);S(this,"copyright",0);S(this,"original",0);S(this,"extension",0);S(this,"emphasis",0);S(this,"error_protection",0);S(this,"strict_ISO",!1);S(this,"disable_reservoir",!1);S(this,"quant_comp",0);S(this,"quant_comp_short",0);S(this,"experimentalY",!1);S(this,"experimentalZ",0);S(this,"exp_nspsytune",0);S(this,"preset",0);S(this,"VBR",null);S(this,"VBR_q_frac",0);S(this,"VBR_q",0);S(this,"VBR_mean_bitrate_kbps",0);S(this,"VBR_min_bitrate_kbps",0);S(this,"VBR_max_bitrate_kbps",0);S(this,"VBR_hard_min",0);S(this,"lowpassfreq",0);S(this,"highpassfreq",0);S(this,"lowpasswidth",0);S(this,"highpasswidth",0);S(this,"maskingadjust",0);S(this,"maskingadjust_short",0);S(this,"ATHonly",!1);S(this,"ATHshort",!1);S(this,"noATH",!1);S(this,"ATHtype",0);S(this,"ATHcurve",0);S(this,"ATHlower",0);S(this,"athaa_type",0);S(this,"athaa_loudapprox",0);S(this,"athaa_sensitivity",0);S(this,"short_blocks",null);S(this,"useTemporal",!1);S(this,"interChRatio",0);S(this,"msfix",0);S(this,"tune",!1);S(this,"tune_value_a",0);S(this,"version",0);S(this,"encoder_delay",0);S(this,"encoder_padding",0);S(this,"framesize",0);S(this,"frameNum",0);S(this,"lame_allocated_gfp",0);this.num_samples=-1,this.num_channels=2,this.in_samplerate=44100,this.out_samplerate=0,this.scale=1,this.scale_left=1,this.scale_right=1,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=5,this.mode=j.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!0,this.brate=0,this.compression_ratio=11.025,this.copyright=0,this.original=1,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=0,this.VBR_q_frac=0,this.VBR_q=4,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=4,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=-1,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=o0.short_block_allowed,this.useTemporal=!0,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}};var j0=p0;function _1(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=j0(x.SBMAX_l),this.s=j0(x.SBMAX_s),this.psfb21=j0(x.PSFB21),this.psfb12=j0(x.PSFB12),this.cb_l=j0(x.CBANDS),this.cb_s=j0(x.CBANDS),this.eql_w=j0(x.BLKSIZE/2)}var x0=c0;var l1=E0;z.STEPS_per_dB=100;z.MAX_dB=120;z.GAIN_NOT_ENOUGH_SAMPLES=-24601;z.GAIN_ANALYSIS_ERROR=0;z.GAIN_ANALYSIS_OK=1;z.INIT_GAIN_ANALYSIS_ERROR=0;z.INIT_GAIN_ANALYSIS_OK=1;z.YULE_ORDER=10;z.MAX_ORDER=z.YULE_ORDER;z.MAX_SAMP_FREQ=48e3;z.RMS_WINDOW_TIME_NUMERATOR=1;z.RMS_WINDOW_TIME_DENOMINATOR=20;z.MAX_SAMPLES_PER_WINDOW=z.MAX_SAMP_FREQ*z.RMS_WINDOW_TIME_NUMERATOR/z.RMS_WINDOW_TIME_DENOMINATOR+1;function z(){var A=64.82,e=z.YULE_ORDER,t=.95,s=z.MAX_SAMP_FREQ,n=z.RMS_WINDOW_TIME_NUMERATOR,l=z.RMS_WINDOW_TIME_DENOMINATOR,a=z.MAX_SAMPLES_PER_WINDOW,_=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],r=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function h(i,b,d,v,M,p){for(;M--!=0;)d[v]=1e-10+i[b+0]*p[0]-d[v-1]*p[1]+i[b-1]*p[2]-d[v-2]*p[3]+i[b-2]*p[4]-d[v-3]*p[5]+i[b-3]*p[6]-d[v-4]*p[7]+i[b-4]*p[8]-d[v-5]*p[9]+i[b-5]*p[10]-d[v-6]*p[11]+i[b-6]*p[12]-d[v-7]*p[13]+i[b-7]*p[14]-d[v-8]*p[15]+i[b-8]*p[16]-d[v-9]*p[17]+i[b-9]*p[18]-d[v-10]*p[19]+i[b-10]*p[20],++v,++b}function c(i,b,d,v,M,p){for(;M--!=0;)d[v]=i[b+0]*p[0]-d[v-1]*p[1]+i[b-1]*p[2]-d[v-2]*p[3]+i[b-2]*p[4],++v,++b}function m(i,b){for(var d=0;d<MAX_ORDER;d++)i.linprebuf[d]=i.lstepbuf[d]=i.loutbuf[d]=i.rinprebuf[d]=i.rstepbuf[d]=i.routbuf[d]=0;switch(0|b){case 48e3:i.reqindex=0;break;case 44100:i.reqindex=1;break;case 32e3:i.reqindex=2;break;case 24e3:i.reqindex=3;break;case 22050:i.reqindex=4;break;case 16e3:i.reqindex=5;break;case 12e3:i.reqindex=6;break;case 11025:i.reqindex=7;break;case 8e3:i.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return i.sampleWindow=0|(b*n+l-1)/l,i.lsum=0,i.rsum=0,i.totsamp=0,l1.ill(i.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(i,b){return m(i,b)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(i.linpre=MAX_ORDER,i.rinpre=MAX_ORDER,i.lstep=MAX_ORDER,i.rstep=MAX_ORDER,i.lout=MAX_ORDER,i.rout=MAX_ORDER,l1.fill(i.B,0),INIT_GAIN_ANALYSIS_OK)};function o(i){return i*i}this.AnalyzeSamples=function(i,b,d,v,M,p,B){var w,y,u,E,I,N,X;if(p==0)return GAIN_ANALYSIS_OK;switch(X=0,I=p,B){case 1:v=b,M=d;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(p<MAX_ORDER?(x0.arraycopy(b,d,i.linprebuf,MAX_ORDER,p),x0.arraycopy(v,M,i.rinprebuf,MAX_ORDER,p)):(x0.arraycopy(b,d,i.linprebuf,MAX_ORDER,MAX_ORDER),x0.arraycopy(v,M,i.rinprebuf,MAX_ORDER,MAX_ORDER));I>0;){N=I>i.sampleWindow-i.totsamp?i.sampleWindow-i.totsamp:I,X<MAX_ORDER?(w=i.linpre+X,y=i.linprebuf,u=i.rinpre+X,E=i.rinprebuf,N>MAX_ORDER-X&&(N=MAX_ORDER-X)):(w=d+X,y=b,u=M+X,E=v),h(y,w,i.lstepbuf,i.lstep+i.totsamp,N,_[i.reqindex]),h(E,u,i.rstepbuf,i.rstep+i.totsamp,N,_[i.reqindex]),c(i.lstepbuf,i.lstep+i.totsamp,i.loutbuf,i.lout+i.totsamp,N,r[i.reqindex]),c(i.rstepbuf,i.rstep+i.totsamp,i.routbuf,i.rout+i.totsamp,N,r[i.reqindex]),w=i.lout+i.totsamp,y=i.loutbuf,u=i.rout+i.totsamp,E=i.routbuf;for(var F=N%8;F--!=0;)i.lsum+=o(y[w++]),i.rsum+=o(E[u++]);for(F=N/8;F--!=0;)i.lsum+=o(y[w+0])+o(y[w+1])+o(y[w+2])+o(y[w+3])+o(y[w+4])+o(y[w+5])+o(y[w+6])+o(y[w+7]),w+=8,i.rsum+=o(E[u+0])+o(E[u+1])+o(E[u+2])+o(E[u+3])+o(E[u+4])+o(E[u+5])+o(E[u+6])+o(E[u+7]),u+=8;if(I-=N,X+=N,i.totsamp+=N,i.totsamp==i.sampleWindow){var R=z.STEPS_per_dB*10*Math.log10((i.lsum+i.rsum)/i.totsamp*.5+1e-37),T=R<=0?0:0|R;T>=i.A.length&&(T=i.A.length-1),i.A[T]++,i.lsum=i.rsum=0,x0.arraycopy(i.loutbuf,i.totsamp,i.loutbuf,0,MAX_ORDER),x0.arraycopy(i.routbuf,i.totsamp,i.routbuf,0,MAX_ORDER),x0.arraycopy(i.lstepbuf,i.totsamp,i.lstepbuf,0,MAX_ORDER),x0.arraycopy(i.rstepbuf,i.totsamp,i.rstepbuf,0,MAX_ORDER),i.totsamp=0}if(i.totsamp>i.sampleWindow)return GAIN_ANALYSIS_ERROR}return p<MAX_ORDER?(x0.arraycopy(i.linprebuf,p,i.linprebuf,0,MAX_ORDER-p),x0.arraycopy(i.rinprebuf,p,i.rinprebuf,0,MAX_ORDER-p),x0.arraycopy(b,d,i.linprebuf,MAX_ORDER-p,p),x0.arraycopy(v,M,i.rinprebuf,MAX_ORDER-p,p)):(x0.arraycopy(b,d+p-MAX_ORDER,i.linprebuf,0,MAX_ORDER),x0.arraycopy(v,M+p-MAX_ORDER,i.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function f(i,b){var d,v=0;for(d=0;d<b;d++)v+=i[d];if(v==0)return GAIN_NOT_ENOUGH_SAMPLES;var M=0|Math.ceil(v*(1-t));for(d=b;d-- >0&&!((M-=i[d])<=0););return A-d/z.STEPS_per_dB}this.GetTitleGain=function(i){for(var b=f(i.A,i.A.length),d=0;d<i.A.length;d++)i.B[d]+=i.A[d],i.A[d]=0;for(var d=0;d<MAX_ORDER;d++)i.linprebuf[d]=i.lstepbuf[d]=i.loutbuf[d]=i.rinprebuf[d]=i.rstepbuf[d]=i.routbuf[d]=0;return i.totsamp=0,i.lsum=i.rsum=0,b}}var{new_float:oe,new_int:r1}=G,Ye=class{constructor(){S(this,"linprebuf");S(this,"linpre",0);S(this,"lstepbuf");S(this,"lstep",0);S(this,"loutbuf");S(this,"lout",0);S(this,"rinprebuf");S(this,"rinpre",0);S(this,"rstepbuf");S(this,"rstep",0);S(this,"routbuf");S(this,"rout",0);S(this,"sampleWindow",0);S(this,"totsamp",0);S(this,"lsum",0);S(this,"rsum",0);S(this,"freqindex",0);S(this,"first",0);S(this,"A");S(this,"B");this.linprebuf=oe(z.MAX_ORDER*2),this.lstepbuf=oe(z.MAX_SAMPLES_PER_WINDOW+z.MAX_ORDER),this.loutbuf=oe(z.MAX_SAMPLES_PER_WINDOW+z.MAX_ORDER),this.rinprebuf=oe(z.MAX_ORDER*2),this.rstepbuf=oe(z.MAX_SAMPLES_PER_WINDOW+z.MAX_ORDER),this.routbuf=oe(z.MAX_SAMPLES_PER_WINDOW+z.MAX_ORDER);let e=Math.max(1,Math.floor(z.STEPS_per_dB*z.MAX_dB));this.A=r1(e),this.B=r1(e)}};var{ShortBlock:Ya,new_float:o1,new_int:fs,assert:h1}=G,Se=class{constructor(e){S(this,"quantize");this.quantize=e}iteration_loop(e,t,s,n){let l=e.internal_flags,a=o1(M0.SFBMAX),_=o1(576),r=fs(2),h=0,c,m=l.l3_side,o=new ee(h);this.quantize.rv.ResvFrameBegin(e,o),h=o.bits;for(let f=0;f<l.mode_gr;f++){c=this.quantize.qupvt.on_pe(e,t,r,h,f,f),l.mode_ext===x.MPG_MD_MS_LR&&(this.quantize.ms_convert(l.l3_side,f),this.quantize.qupvt.reduce_side(r,s[f],h,c));for(let i=0;i<l.channels_out;i++){let b,d,v=m.tt[f][i];v.block_type!==x.SHORT_TYPE?(b=0,d=l.PSY.mask_adjust-b):(b=0,d=l.PSY.mask_adjust_short-b),l.masking_lower=Math.pow(10,d*.1),this.quantize.init_outer_loop(l,v),this.quantize.init_xrpow(l,v,_)&&(this.quantize.qupvt.calc_xmin(e,n[f][i],v,a),this.quantize.outer_loop(e,v,a,_,i,r[i])),this.quantize.iteration_finish_one(l,f,i),h1(v.part2_3_length<=W.MAX_BITS_PER_CHANNEL,`Channel ${i} bits ${v.part2_3_length} exceed MAX_BITS_PER_CHANNEL`),h1(v.part2_3_length<=r[i]+100,`Channel ${i} bits ${v.part2_3_length} significantly exceed target ${r[i]}`)}}this.quantize.rv.ResvFrameEnd(l,h)}};var{VbrMode:g,Float:e_,ShortBlock:bt,Util:bs,Arrays:c1,new_array_n:t_,new_byte:s_,new_float:L0,new_float_n:i_,new_int:n_,new_int_n:m1,new_short_n:a_,assert:U0}=G,ut=class{constructor(){S(this,"mask_adjust",0);S(this,"mask_adjust_short",0);S(this,"bo_l_weight",L0(x.SBMAX_l));S(this,"bo_s_weight",L0(x.SBMAX_s))}},dt=class{constructor(){S(this,"lowerlimit",0)}};var Q=class Q{constructor(){S(this,"ga",null);S(this,"bs",null);S(this,"p",null);S(this,"qupvt",null);S(this,"qu",null);S(this,"psy",new re);S(this,"vbr",null);S(this,"ver",null);S(this,"id3",null);S(this,"mpglib",null);S(this,"enc",new x);S(this,"_LAME_ID",4294479419);S(this,"_InOut",class{constructor(){this.n_in=0,this.n_out=0}});S(this,"_NumUsed",class{constructor(){this.num_used=0}})}setModules(e,t,s,n,l,a,_,r,h){this.ga=e,this.bs=t,this.p=s,this.qupvt=n,this.qu=l,this.vbr=a,this.ver=_,this.id3=r,this.mpglib=h,this.enc.setModules(this.bs,this.psy,this.qupvt,this.vbr)}_lame_init_old(e){let t;return e.class_id=this._LAME_ID,t=e.internal_flags=new W,e.mode=j.NOT_SET,e.original=1,e.in_samplerate=44100,e.num_channels=2,e.num_samples=-1,e.bWriteVbrTag=!0,e.quality=-1,e.short_blocks=null,t.subblock_gain=-1,e.lowpassfreq=0,e.highpassfreq=0,e.lowpasswidth=-1,e.highpasswidth=-1,e.VBR=g.vbr_off,e.VBR_q=4,e.ATHcurve=-1,e.VBR_mean_bitrate_kbps=128,e.VBR_min_bitrate_kbps=0,e.VBR_max_bitrate_kbps=0,e.VBR_hard_min=0,t.VBR_min_bitrate=1,t.VBR_max_bitrate=14,e.quant_comp=-1,e.quant_comp_short=-1,e.msfix=-1,t.resample_ratio=1,t.OldValue[0]=180,t.OldValue[1]=180,t.CurrentStep[0]=4,t.CurrentStep[1]=4,t.masking_lower=1,t.nsPsy.attackthre=-1,t.nsPsy.attackthre_s=-1,e.scale=-1,e.athaa_type=-1,e.ATHtype=-1,e.athaa_loudapprox=-1,e.athaa_sensitivity=0,e.useTemporal=null,e.interChRatio=-1,t.mf_samples_to_encode=x.ENCDELAY+x.POSTDELAY,e.encoder_padding=0,t.mf_size=x.ENCDELAY-x.MDCTDELAY,e.findReplayGain=!1,e.decode_on_the_fly=!1,t.decode_on_the_fly=!1,t.findReplayGain=!1,t.findPeakSample=!1,t.RadioGain=0,t.AudiophileGain=0,t.noclipGainChange=0,t.noclipScale=-1,e.preset=0,e.write_id3tag_automatic=!0,0}_filter_coef(e){return e>1?0:e<=0?1:Math.cos(Math.PI/2*e)}_nearestBitrateFullIndex(e){let t=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],s=16,n=320,l=16,a=320;for(let _=0;_<16;_++)if(t[_+1]>=e){a=t[_+1],l=_+1,n=t[_],s=_;break}return a-e>e-n?s:l}_optimum_samplefreq(e,t){let s=44100;return t>=48e3?s=48e3:t>=44100?s=44100:t>=32e3?s=32e3:t>=24e3?s=24e3:t>=22050?s=22050:t>=16e3?s=16e3:t>=12e3?s=12e3:t>=11025?s=11025:(t>=8e3,s=8e3),e===-1?s:(e<=3970?s=8e3:e<=4510?s=11025:e<=5420?s=12e3:e<=7230?s=16e3:e<=9970?s=22050:e<=11220?s=24e3:e<=15250?s=32e3:e<=15960?s=44100:s=48e3,t>s?t>44100?48e3:t>32e3?44100:t>24e3?32e3:t>22050?24e3:t>16e3?22050:t>12e3?16e3:t>11025?12e3:t>8e3?11025:8e3:s)}_SmpFrqIndex(e,t){switch(e){case 44100:return t.version=1,0;case 48e3:return t.version=1,1;case 32e3:return t.version=1,2;case 22050:return t.version=0,0;case 24e3:return t.version=0,1;case 16e3:return t.version=0,2;case 11025:return t.version=0,0;case 12e3:return t.version=0,1;case 8e3:return t.version=0,2;default:return t.version=0,-1}}_FindNearestBitrate(e,t,s){(s<16e3||s<32e3)&&(t=0);let n=O0[t][1],l=Math.abs(n-e);for(let a=2;a<=14;a++){let _=O0[t][a];if(_>0){let r=Math.abs(_-e);r<l&&(l=r,n=_)}}return n}_BitrateIndex(e,t,s){(s<16e3||s<32e3)&&(t=0);for(let n=1;n<=14;n++)if(O0[t][n]===e)return n;return-1}_optimum_bandwidth(e,t){let s=[new this._BandPass(8,2e3),new this._BandPass(16,3700),new this._BandPass(24,3900),new this._BandPass(32,5500),new this._BandPass(40,7e3),new this._BandPass(48,7500),new this._BandPass(56,1e4),new this._BandPass(64,11e3),new this._BandPass(80,13500),new this._BandPass(96,15100),new this._BandPass(112,15600),new this._BandPass(128,17e3),new this._BandPass(160,17500),new this._BandPass(192,18600),new this._BandPass(224,19400),new this._BandPass(256,19700),new this._BandPass(320,20500)],n=this._nearestBitrateFullIndex(t);e.lowerlimit=s[n].lowpass}_lame_init_params_ppflt(e){let t=e.internal_flags,s=32,n=-1;if(t.lowpass1>0){let l=999;for(let a=0;a<=31;a++){let _=a/31;_>=t.lowpass2&&(s=Math.min(s,a)),t.lowpass1<_&&_<t.lowpass2&&(l=Math.min(l,a))}t.lowpass1=l===999?(s-.75)/31:(l-.75)/31,t.lowpass2=s/31}if(t.highpass2>0&&t.highpass2<.9*(.75/31)&&(t.highpass1=0,t.highpass2=0,console.warn("Warning: highpass filter disabled. Frequency too small.")),t.highpass2>0){let l=-1;for(let a=0;a<=31;a++){let _=a/31;_<=t.highpass1&&(n=Math.max(n,a)),t.highpass1<_&&_<t.highpass2&&(l=Math.max(l,a))}t.highpass1=n/31,t.highpass2=l===-1?(n+.75)/31:(l+.75)/31}for(let l=0;l<32;l++){let a=l/31,_=t.highpass2>t.highpass1?this._filter_coef((t.highpass2-a)/(t.highpass2-t.highpass1+1e-20)):1,r=t.lowpass2>t.lowpass1?this._filter_coef((a-t.lowpass1)/(t.lowpass2-t.lowpass1+1e-20)):1;t.amp_filter[l]=_*r}}_lame_init_qval(e){let t=e.internal_flags,s=5;switch(e.quality<0&&(e.quality=s),e.quality){default:case 9:t.psymodel=0,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 8:e.quality=7;case 7:t.psymodel=1,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 6:case 5:t.psymodel=1,t.noise_shaping===0&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.subblock_gain===-1&&(t.subblock_gain=1),t.use_best_huffman=0,t.full_outer_loop=0;break;case 4:t.psymodel=1,t.noise_shaping===0&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.subblock_gain===-1&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 3:t.psymodel=1,t.noise_shaping===0&&(t.noise_shaping=1),t.noise_shaping_amp=1,t.noise_shaping_stop=1,t.subblock_gain===-1&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 2:t.psymodel=1,t.noise_shaping===0&&(t.noise_shaping=1),t.substep_shaping===0&&(t.substep_shaping=2),t.noise_shaping_amp=1,t.noise_shaping_stop=1,t.subblock_gain===-1&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 1:case 0:t.psymodel=1,t.noise_shaping===0&&(t.noise_shaping=1),t.substep_shaping===0&&(t.substep_shaping=2),t.noise_shaping_amp=2,t.noise_shaping_stop=1,t.subblock_gain===-1&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break}}_lame_init_bitstream(e){let t=e.internal_flags;e.frameNum=0,e.write_id3tag_automatic&&console.warn("ID3v2 tag writing not implemented."),t.bitrate_stereoMode_Hist=m1([16,5]),t.bitrate_blockType_Hist=m1([16,6]),t.PeakSample=0,e.bWriteVbrTag&&console.warn("VBR tag writing not implemented.")}_calcNeeded(e){let t=x.BLKSIZE+e.framesize-x.FFTOFFSET;return t=Math.max(t,512+e.framesize-32),U0(W.MFSIZE>=t,`MFSIZE ${W.MFSIZE} too small, need ${t}`),t}_lame_encode_frame(e,t,s,n,l,a){let _=this.enc.lame_encode_mp3_frame(e,t,s,n,l,a);return e.frameNum++,_}_fill_buffer_resample(e,t,s,n,l,a,_,r,h){let c=e.internal_flags,m,o=0,f,i=Math.min(W.BPC,e.out_samplerate/this._gcd(e.out_samplerate,e.in_samplerate)),b=Math.abs(c.resample_ratio-Math.round(c.resample_ratio))<1e-4?1:0,d=1/c.resample_ratio;d>1&&(d=1);let v=31;if(v%2===0&&--v,v+=b,c.fill_buffer_resample_init===0){for(c.inbuf_old[0]=L0(W.INBUF_SIZE),c.inbuf_old[1]=L0(W.INBUF_SIZE),m=0;m<=2*i;++m)c.blackfilt[m]=L0(Q.BLACKSIZE);for(c.itime[0]=0,c.itime[1]=0,o=0;o<=2*i;o++){let p=0,B=(o-i)/(2*i);for(m=0;m<=v;m++)p+=c.blackfilt[o][m]=this._blackman(m-B,d,v);if(p!==0)for(m=0;m<=v;m++)c.blackfilt[o][m]/=p}c.fill_buffer_resample_init=1}let M=c.inbuf_old[h];for(f=0;f<n;f++){let p=f*c.resample_ratio;if(o=Math.floor(p-c.itime[h]),v+o-Math.floor(v/2)>=_)break;let B=p-c.itime[h]-(o+.5*(v%2));U0(Math.abs(B)<=.501,`Resample offset error: ${B}`);let w=Math.floor(B*2*i+i+.5);U0(w>=0&&w<=2*i,`joff out of bounds: ${w}`);let y=0;for(m=0;m<=v;++m){let u=Math.floor(m+o-v/2),E=u<0?M[W.INBUF_SIZE/2+u]:l[a+u];y+=E*c.blackfilt[w][m]}t[s+f]=y}if(r.num_used=Math.min(_,Math.floor(v+o-v/2)),r.num_used<0&&(r.num_used=0),c.itime[h]+=r.num_used-f*c.resample_ratio,r.num_used>=Q.BLACKSIZE)for(m=0;m<Q.BLACKSIZE;m++)M[m]=l[a+r.num_used+m-Q.BLACKSIZE];else{let p=Q.BLACKSIZE-r.num_used;for(m=0;m<p;++m)M[m]=M[m+r.num_used];for(o=0;m<Q.BLACKSIZE;++m,++o)M[m]=l[a+o];U0(o===r.num_used,`Resample buffer fill mismatch: ${o} vs ${r.num_used}`)}return f}_fill_buffer(e,t,s,n,l,a){let _=e.internal_flags;if(Math.abs(_.resample_ratio-1)>1e-6)for(let r=0;r<_.channels_out;r++){let h=new this._NumUsed,c=W.MFSIZE-_.mf_size,m=Math.min(e.framesize,c);if(m<=0){a.n_out=0,a.n_in=0;continue}a.n_out=this._fill_buffer_resample(e,t[r],_.mf_size,m,s[r],n,l,h,r),a.n_in=h.num_used}else{let r=W.MFSIZE-_.mf_size;if(a.n_out=Math.min(e.framesize,l,r),a.n_in=a.n_out,a.n_out<=0){a.n_in=0;return}for(let h=0;h<a.n_out;++h){let c=_.mf_size+h;if(c>=W.MFSIZE){console.error(`Buffer overflow detected in _fill_buffer: index ${c} >= ${W.MFSIZE}`),a.n_out=h,a.n_in=a.n_out;break}t[0][c]=s[0][n+h],_.channels_out===2&&(t[1][c]=s[1][n+h])}}}_lame_encode_buffer_sample(e,t,s,n,l,a,_){let r=e.internal_flags,h=0,c,m,o,f,i=[r.mfbuf[0],r.mfbuf[1]],b=[t,s];if(r.Class_ID!==this._LAME_ID)return-3;if(n===0)return 0;if(f=this.bs.copy_buffer(r,l,a,_,0),f<0)return f;a+=f,h+=f;let d=this._calcNeeded(e),v=0;for(;n>0;){let M=new this._InOut;this._fill_buffer(e,i,b,v,n,M);let p=M.n_in,B=M.n_out;if(r.findReplayGain&&!r.decode_on_the_fly&&this.ga.AnalyzeSamples(r.rgdata,i[0],r.mf_size,i[1],r.mf_size,B,r.channels_out)===GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(n-=p,v+=p,r.mf_size+=B,U0(r.mf_size<=W.MFSIZE,"mf_size overflow"),r.mf_samples_to_encode<1&&(r.mf_samples_to_encode=x.ENCDELAY+x.POSTDELAY),r.mf_samples_to_encode+=B,r.mf_size>=d){let w=_===0?0:_-h;if(c=this._lame_encode_frame(e,i[0],i[1],l,a,w),c<0)return c;for(a+=c,h+=c,r.mf_size-=e.framesize,r.mf_samples_to_encode-=e.framesize,o=0;o<r.channels_out;o++)i[o].set(i[o].subarray(e.framesize,r.mf_size+e.framesize))}}return U0(n===0,"Not all input samples processed"),h}lame_init(){let e=new qe;return this._lame_init_old(e)!==0?null:(e.lame_allocated_gfp=1,e)}lame_init_params(e){if(!e||!e.internal_flags)return console.error("lame_init_params: lame_init() not called?"),-1;let t=e.internal_flags;if(t.Class_ID=this._LAME_ID,t.ATH==null&&(t.ATH=new _1),t.PSY==null&&(t.PSY=new ut),t.rgdata==null&&(t.rgdata=new Ye),t.channels_in=e.num_channels,t.channels_in===1&&(e.mode=j.MONO),t.channels_out=e.mode===j.MONO?1:2,t.mode_ext=x.MPG_MD_MS_LR,e.mode===j.MONO&&(e.force_ms=!1),e.VBR===g.vbr_off&&e.VBR_mean_bitrate_kbps!==128&&e.brate===0&&(e.brate=e.VBR_mean_bitrate_kbps),e.VBR===g.vbr_off&&e.brate===0&&Math.abs(e.compression_ratio)<1e-6&&(e.compression_ratio=11.025),e.VBR===g.vbr_off||e.VBR===g.vbr_mtrh||e.VBR===g.vbr_mt||(e.free_format=!1),e.VBR===g.vbr_off&&e.compression_ratio>0&&(e.out_samplerate===0&&e.out_samplerate===0&&(e.out_samplerate=e.in_samplerate),e.brate=Math.floor(e.out_samplerate*16*t.channels_out/(1e3*e.compression_ratio)),this._SmpFrqIndex(e.out_samplerate,e),e.free_format||(e.brate=this._FindNearestBitrate(e.brate,e.version,e.out_samplerate))),e.out_samplerate===0){if(e.lowpassfreq===0){let n=16e3;if(e.VBR===g.vbr_off||e.VBR===g.vbr_abr){let l=new dt;this._optimum_bandwidth(l,e.VBR===g.vbr_off?e.brate:e.VBR_mean_bitrate_kbps),n=l.lowerlimit}else{let l=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=e.VBR_q&&e.VBR_q<=9){let a=l[e.VBR_q],_=l[e.VBR_q+1],r=e.VBR_q_frac;n=bs.linear_int(a,_,r)}else n=19500}e.mode===j.MONO&&(e.VBR===g.vbr_off||e.VBR===g.vbr_abr)&&(n*=1.5),e.lowpassfreq=Math.floor(n)}2*e.lowpassfreq>e.in_samplerate&&(e.lowpassfreq=Math.floor(e.in_samplerate/2)),e.out_samplerate=this._optimum_samplefreq(e.lowpassfreq,e.in_samplerate)}if(e.lowpassfreq=Math.min(20500,e.lowpassfreq),e.lowpassfreq=Math.min(Math.floor(e.out_samplerate/2),e.lowpassfreq),e.VBR===g.vbr_abr)e.compression_ratio=e.out_samplerate*16*t.channels_out/(1e3*e.VBR_mean_bitrate_kbps);else if(e.VBR!==g.vbr_off){let n=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];e.compression_ratio=n[e.VBR_q]||8.8}else e.brate>0&&(e.compression_ratio=e.out_samplerate*16*t.channels_out/(1e3*e.brate));if(t.findReplayGain=e.findReplayGain&&e.bWriteVbrTag,t.decode_on_the_fly=e.decode_on_the_fly&&e.bWriteVbrTag,t.findPeakSample=t.decode_on_the_fly,t.findReplayGain&&this.ga.InitGainAnalysis(t.rgdata,e.out_samplerate)===GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(t.decode_on_the_fly&&!e.decode_only&&console.warn("Decode on the fly not implemented."),t.mode_gr=e.out_samplerate<=24e3&&e.version===0?1:2,e.framesize=e.version===1?1152:576*t.mode_gr,e.encoder_delay=x.ENCDELAY,t.resample_ratio=e.in_samplerate/e.out_samplerate,e.mode===j.NOT_SET&&(e.mode=j.JOINT_STEREO),t.samplerate_index=this._SmpFrqIndex(e.out_samplerate,e),t.samplerate_index<0)return-1;if(e.VBR===g.vbr_off){if(e.free_format)t.bitrate_index=0;else if(e.brate=this._FindNearestBitrate(e.brate,e.version,e.out_samplerate),t.bitrate_index=this._BitrateIndex(e.brate,e.version,e.out_samplerate),t.bitrate_index<=0)return-1}else e.VBR===g.vbr_abr?(t.bitrate_index=this._BitrateIndex(this._FindNearestBitrate(e.VBR_mean_bitrate_kbps,e.version,e.out_samplerate),e.version,e.out_samplerate),t.bitrate_index<=0&&(t.bitrate_index=1)):t.bitrate_index=1;if(e.VBR!==g.vbr_off){if(t.VBR_min_bitrate=1,t.VBR_max_bitrate=14,e.out_samplerate<16e3?t.VBR_max_bitrate=8:e.out_samplerate<32e3&&e.version===0&&(t.VBR_max_bitrate=14),e.VBR_min_bitrate_kbps>0&&(e.VBR_min_bitrate_kbps=this._FindNearestBitrate(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),t.VBR_min_bitrate=this._BitrateIndex(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),t.VBR_min_bitrate<0)||e.VBR_max_bitrate_kbps>0&&(e.VBR_max_bitrate_kbps=this._FindNearestBitrate(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),t.VBR_max_bitrate=this._BitrateIndex(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),t.VBR_max_bitrate<0))return-1;t.VBR_min_bitrate>t.VBR_max_bitrate&&(t.VBR_min_bitrate=t.VBR_max_bitrate),e.VBR_min_bitrate_kbps=O0[e.version][t.VBR_min_bitrate],e.VBR_max_bitrate_kbps=O0[e.version][t.VBR_max_bitrate],e.VBR===g.vbr_abr&&(e.VBR_mean_bitrate_kbps=Math.min(e.VBR_max_bitrate_kbps,e.VBR_mean_bitrate_kbps),e.VBR_mean_bitrate_kbps=Math.max(e.VBR_min_bitrate_kbps,e.VBR_mean_bitrate_kbps))}let s=t.samplerate_index+3*e.version;if(e.out_samplerate<16e3&&(s+=6),s>=0&&s<this.qupvt.sfBandIndex.length){let n=this.qupvt.sfBandIndex[s];t.scalefac_band.l.set(n.l.subarray(0,x.SBMAX_l+1)),t.scalefac_band.s.set(n.s.subarray(0,x.SBMAX_s+1));let l=Math.floor((t.scalefac_band.l[22]-t.scalefac_band.l[21])/x.PSFB21);for(let _=0;_<x.PSFB21;_++)t.scalefac_band.psfb21[_]=t.scalefac_band.l[21]+_*l;t.scalefac_band.psfb21[x.PSFB21]=t.scalefac_band.l[22];let a=Math.floor((t.scalefac_band.s[13]-t.scalefac_band.s[12])/x.PSFB12);for(let _=0;_<x.PSFB12;_++)t.scalefac_band.psfb12[_]=t.scalefac_band.s[12]+_*a;t.scalefac_band.psfb12[x.PSFB12]=t.scalefac_band.s[13]}else return console.error("Invalid samplerate index for scalefactor bands."),-1;switch(e.version===1?t.sideinfo_len=t.channels_out===1?21:36:t.sideinfo_len=t.channels_out===1?13:21,e.error_protection&&(t.sideinfo_len+=2),this.bs.init_bit_stream_w(t),this._lame_init_bitstream(e),e.VBR){case g.vbr_mt:case g.vbr_mtrh:console.warn(`Using placeholder CBR loop for VBR mode: ${e.VBR}`),t.iteration_loop=new Se(this.qu);break;case g.vbr_rh:return console.error("VBROldIterationLoop not implemented for VBR mode: vbr_rh"),-1;case g.vbr_abr:return console.error("ABRIterationLoop not implemented for VBR mode: vbr_abr"),-1;case g.vbr_off:default:t.iteration_loop=new Se(this.qu);break}return this.qupvt.iteration_init(e),this.psy.psymodel_init(e),this._lame_init_qval(e),e.scale<0&&(e.scale=1),e.scale_left<0&&(e.scale_left=e.scale),e.scale_right<0&&(e.scale_right=e.scale),e.athaa_type<0?t.ATH.useAdjust=3:t.ATH.useAdjust=e.athaa_type,t.ATH.aaSensitivityP=Math.pow(10,e.athaa_sensitivity/-10),e.short_blocks==null&&(e.short_blocks=bt.short_block_allowed),e.short_blocks===bt.short_block_allowed&&(e.mode===j.JOINT_STEREO||e.mode===j.STEREO)&&(e.short_blocks=bt.short_block_coupled),e.quant_comp<0&&(e.quant_comp=1),e.quant_comp_short<0&&(e.quant_comp_short=0),e.msfix<-10&&(e.msfix=0),e.exp_nspsytune|=1,t.nsPsy.attackthre<0&&(t.nsPsy.attackthre=4.4),t.nsPsy.attackthre_s<0&&(t.nsPsy.attackthre_s=25),e.ATHtype<0&&(e.ATHtype=4),e.ATHcurve<-99&&(e.ATHcurve=0),e.athaa_loudapprox<0&&(e.athaa_loudapprox=2),e.interChRatio<0&&(e.interChRatio=0),e.useTemporal==null&&(e.useTemporal=!0),t.slot_lag=0,t.frac_SpF=0,U0(e.scale>=0,"Scale not initialized"),e.VBR===g.vbr_rh||e.VBR===g.vbr_mtrh?e.experimentalY?t.sfb21_extra=!1:t.sfb21_extra=e.out_samplerate>44e3:t.sfb21_extra=!1,0}lame_encode_flush(e,t,s,n){let l=e.internal_flags,a=[L0(1152),L0(1152)],_=0,r=0,h;if(l.mf_samples_to_encode<1)return 0;let c=l.mf_samples_to_encode-x.POSTDELAY,m=this._calcNeeded(e);e.in_samplerate!==e.out_samplerate&&(c+=Math.floor(16*e.out_samplerate/e.in_samplerate));let o=e.framesize-c%e.framesize;o<576&&e.framesize>=576?o+=e.framesize:o===e.framesize&&(o=0),e.encoder_padding=o;let f=Math.ceil((c+o)/e.framesize);for(;f>0&&_>=0;){let i=m-l.mf_size;l.resample_ratio>1e-6?i=Math.ceil(i*l.resample_ratio):i=Math.ceil(i),i=Math.min(i,1152),i<1&&(i=1),c1.fill(a[0],0,i,0),l.channels_out===2&&c1.fill(a[1],0,i,0),h=n===0?0:n-r;let b=e.frameNum;if(_=this.lame_encode_buffer_ieee_float(e,a[0],a[1],i,t,s,h),_<0)return _;mp3bufPos+=_,r+=_,e.frameNum>b&&f--}if(l.mf_samples_to_encode=0,_<0||(h=mp3buf_size===0?0:mp3buf_size-r,this.bs.flush_bitstream(e),_=this.bs.copy_buffer(l,t,s,h,1),_<0))return _;if(mp3bufPos+=_,r+=_,e.write_id3tag_automatic){if(console.warn("ID3v1 tag writing not implemented."),h=mp3buf_size===0?0:mp3buf_size-r,_=this.bs.copy_buffer(l,t,s,h,0),_<0)return _;r+=_}return r}lame_encode_buffer_ieee_float(e,t,s,n,l,a,_){let r=e.internal_flags;if(!r||r.Class_ID!==this._LAME_ID)return-3;let h=s;if(r.channels_in>1&&!h)return console.error("Right channel buffer required for stereo input."),-1;r.channels_in===1&&(h=t);let c=t,m=h,o=!1;(Math.abs(e.scale-1)>1e-6&&e.scale>0||Math.abs(e.scale_left-1)>1e-6&&e.scale_left>0||r.channels_out===2&&Math.abs(e.scale_right-1)>1e-6&&e.scale_right>0||e.num_channels===2&&r.channels_out===1)&&(o=!0,c=L0(n),r.channels_in>1&&(m=L0(n)));let f=Math.abs(e.scale_left-1)>1e-6&&e.scale_left>0?e.scale_left:e.scale,i=r.channels_in>1&&Math.abs(e.scale_right-1)>1e-6&&e.scale_right>0?e.scale_right:e.scale;if(e.num_channels===2&&r.channels_out===1){for(let b=0;b<n;b++)c[b]=.5*(t[b]*f+s[b]*i);m=null}else{let b=Math.abs(f-1)>1e-6&&f>0,d=r.channels_in>1&&Math.abs(i-1)>1e-6&&i>0;if(o)for(let v=0;v<n;v++)c[v]=b?t[v]*f:t[v],m&&(m[v]=d?s[v]*i:s[v]);else c=t,m=s}return r.channels_out===1&&(m=c),this._lame_encode_buffer_sample(e,c,m,n,l,a,_)}lame_encode_buffer(e,t,s,n,l,a,_){let r=e.internal_flags;if(!r||r.Class_ID!==this._LAME_ID)return-3;if(n===0)return 0;let h=L0(n),c=null;if(r.channels_in>1){if(!s)return console.error("Right channel Int16 buffer required for stereo input."),-1;c=L0(n)}let m=1/32768;for(let o=0;o<n;o++)h[o]=t[o]*m,c&&s&&(c[o]=s[o]*m);return this.lame_encode_buffer_ieee_float(e,h,c,n,l,a,_)}};S(Q,"LAME_MAXALBUMART",128*1024),S(Q,"V9",410),S(Q,"V8",420),S(Q,"V7",430),S(Q,"V6",440),S(Q,"V5",450),S(Q,"V4",460),S(Q,"V3",470),S(Q,"V2",480),S(Q,"V1",490),S(Q,"V0",500),S(Q,"R3MIX",1e3),S(Q,"STANDARD",1001),S(Q,"EXTREME",1002),S(Q,"INSANE",1003),S(Q,"STANDARD_FAST",1004),S(Q,"EXTREME_FAST",1005),S(Q,"MEDIUM",1006),S(Q,"MEDIUM_FAST",1007),S(Q,"LAME_MAXMP3BUFFER",16384+Q.LAME_MAXALBUMART),S(Q,"BLACKSIZE",32);var he=Q,ve=he.LAME_MAXMP3BUFFER;var _0=he;var De=class{constructor(){this.total=0}},Pe=class A{constructor(e){this.context=e,this.CRC16_POLYNOMIAL=32773,this.MAX_LENGTH=32,this.buf=null,this.totbit=0,this.bufByteIdx=0,this.bufBitIdx=0,this.ga=null,this.mpg=null,this.ver=null,this.vbr=null}static EQ(e,t){return Math.abs(e)>Math.abs(t)?Math.abs(e-t)<=Math.abs(e)*1e-6:Math.abs(e-t)<=Math.abs(t)*1e-6}static NEQ(e,t){return!A.EQ(e,t)}setModules(e,t,s,n){this.ga=e,this.mpg=t,this.ver=s,this.vbr=n}putbits2(e,t,s){for(C(s<this.MAX_LENGTH-2);s>0;){var n;this.bufBitIdx==0&&(this.bufBitIdx=8,this.bufByteIdx++,C(this.bufByteIdx<ve),C(e.header&&e.header[e.w_ptr]),C(e.header[e.w_ptr].write_timing>=this.totbit),e.header[e.w_ptr].write_timing==this.totbit&&this.putheader_bits(e),C(this.buf),this.buf[this.bufByteIdx]=0),n=Math.min(s,this.bufBitIdx),s-=n,this.bufBitIdx-=n,C(s<this.MAX_LENGTH),C(this.bufBitIdx<this.MAX_LENGTH),C(this.buf),this.buf[this.bufByteIdx]|=t>>>s<<this.bufBitIdx,this.totbit+=n}}getframebits(e){var t=e.internal_flags,s;t.bitrate_index!=0?(C(O0&&O0[e.version]),s=O0[e.version][t.bitrate_index]):s=e.brate,C(8<=s&&s<=640);var n=Math.floor((e.version+1)*72e3*s/e.out_samplerate+t.padding);return 8*n}drain_into_ancillary(e,t){var s=e.internal_flags,n;C(t>=0);let l=[76,65,77,69];for(let _ of l)if(t>=8)this.putbits2(s,_,8),t-=8;else break;if(t>=32&&this.ver){var a=this.ver.getLameShortVersion();if(a)for(n=0;n<a.length&&t>=8;++n)this.putbits2(s,a.charCodeAt(n),8),t-=8}for(;t>=1;t-=1)this.putbits2(s,s.ancillary_flag,1),s.ancillary_flag^=e.disable_reservoir?0:1;C(t==0)}putheader_bits(e){C(e.header&&e.header[e.w_ptr]&&e.header[e.w_ptr].buf),C(this.buf),C(this.bufByteIdx+e.sideinfo_len<this.buf.length),c0.arraycopy(e.header[e.w_ptr].buf,0,this.buf,this.bufByteIdx,e.sideinfo_len),this.bufByteIdx+=e.sideinfo_len,this.totbit+=e.sideinfo_len*8,e.w_ptr=e.w_ptr+1&I0-1}putbits_noheaders(e,t,s){for(C(s<this.MAX_LENGTH-2);s>0;){var n;this.bufBitIdx==0&&(this.bufBitIdx=8,this.bufByteIdx++,C(this.bufByteIdx<ve),C(this.buf),this.buf[this.bufByteIdx]=0),n=Math.min(s,this.bufBitIdx),s-=n,this.bufBitIdx-=n,C(s<this.MAX_LENGTH),C(this.bufBitIdx<this.MAX_LENGTH),C(this.buf),this.buf[this.bufByteIdx]|=t>>>s<<this.bufBitIdx,this.totbit+=n}}writeheader(e,t,s){C(e.header&&e.header[e.h_ptr]&&e.header[e.h_ptr].buf);for(var n=e.header[e.h_ptr].ptr;s>0;){var l=Math.min(s,8-(n&7));s-=l,C(s<this.MAX_LENGTH);var a=n>>>3;C(a<ve),C(a<e.header[e.h_ptr].buf.length);var _=8-(n&7)-l,r=(1<<l)-1,h=t>>>s&r;e.header[e.h_ptr].buf[a]|=h<<_,n+=l}e.header[e.h_ptr].ptr=n}CRC_update(e,t){e<<=8,t&=65535;for(var s=0;s<8;s++)t<<=1,e<<=1,((t^e)&65536)!==0&&(t^=this.CRC16_POLYNOMIAL),t&=65535;return t}CRC_writeheader(e,t){var s=65535;C(t&&t.length>=6),C(e.sideinfo_len<=t.length),s=this.CRC_update(t[2]&255,s),s=this.CRC_update(t[3]&255,s);for(var n=6;n<e.sideinfo_len;n++)s=this.CRC_update(t[n]&255,s);t[4]=s>>8&255,t[5]=s&255}encodeSideInfo2(e,t){var s=e.internal_flags,n,l,a;n=s.l3_side,C(s.header&&s.header[s.h_ptr]&&s.header[s.h_ptr].buf),s.header[s.h_ptr].ptr=0,E0.fill(s.header[s.h_ptr].buf,0,s.sideinfo_len,0),e.out_samplerate<16e3?this.writeheader(s,4094,12):this.writeheader(s,4095,12),this.writeheader(s,e.version,1),this.writeheader(s,1,2),this.writeheader(s,e.error_protection?0:1,1);if(this.writeheader(s,s.bitrate_index,4),this.writeheader(s,s.samplerate_index,2),this.writeheader(s,s.padding,1),this.writeheader(s,e.extension,1),this.writeheader(s,e.mode.ordinal(),2),this.writeheader(s,s.mode_ext,2),this.writeheader(s,e.copyright,1),this.writeheader(s,e.original,1),this.writeheader(s,e.emphasis,2),e.error_protection&&this.writeheader(s,0,16),e.version==1){for(C(n.main_data_begin>=0),this.writeheader(s,n.main_data_begin,9),s.channels_out==2?this.writeheader(s,n.private_bits,3):this.writeheader(s,n.private_bits,5),a=0;a<s.channels_out;a++)for(let h=0;h<4;h++)this.writeheader(s,n.scfsi[a][h],1);for(l=0;l<2;l++)for(a=0;a<s.channels_out;a++){var _=n.tt[l][a];if(this.writeheader(s,_.part2_3_length,12),this.writeheader(s,_.big_values/2,9),this.writeheader(s,_.global_gain,8),this.writeheader(s,_.scalefac_compress,4),this.writeheader(s,_.window_switching_flag,1),_.window_switching_flag){this.writeheader(s,_.block_type,2),this.writeheader(s,_.mixed_block_flag,1);for(let h=0;h<2;h++)this.writeheader(s,_.table_select[h],5);for(let h=0;h<3;h++)this.writeheader(s,_.subblock_gain[h],3);_.block_type==2&&_.mixed_block_flag==1&&(this.writeheader(s,_.region0_count,4),this.writeheader(s,_.region1_count,3))}else{for(let h=0;h<3;h++)this.writeheader(s,_.table_select[h],5);this.writeheader(s,_.region0_count,4),this.writeheader(s,_.region1_count,3)}this.writeheader(s,_.preflag,1),this.writeheader(s,_.scalefac_scale,1),this.writeheader(s,_.count1table_select,1)}}else for(C(n.main_data_begin>=0),this.writeheader(s,n.main_data_begin,8),this.writeheader(s,n.private_bits,s.channels_out),l=0,a=0;a<s.channels_out;a++){var _=n.tt[l][a];if(this.writeheader(s,_.part2_3_length,12),this.writeheader(s,_.big_values/2,9),this.writeheader(s,_.global_gain,8),this.writeheader(s,_.scalefac_compress,9),this.writeheader(s,_.window_switching_flag,1),_.window_switching_flag){this.writeheader(s,_.block_type,2),this.writeheader(s,_.mixed_block_flag,1);for(let c=0;c<2;c++)this.writeheader(s,_.table_select[c],5);for(let c=0;c<3;c++)this.writeheader(s,_.subblock_gain[c],3);_.block_type==2&&_.mixed_block_flag==1&&(this.writeheader(s,_.region0_count,4),this.writeheader(s,_.region1_count,3))}else{for(let c=0;c<3;c++)this.writeheader(s,_.table_select[c],5);this.writeheader(s,_.region0_count,4),this.writeheader(s,_.region1_count,3)}this.writeheader(s,_.scalefac_scale,1),this.writeheader(s,_.count1table_select,1)}e.error_protection&&this.CRC_writeheader(s,s.header[s.h_ptr].buf);{var r=s.h_ptr;s.h_ptr=r+1&I0-1,C(s.header&&s.header[r]&&s.header[s.h_ptr]),s.header[s.h_ptr].write_timing=s.header[r].write_timing+t,s.h_ptr==s.w_ptr&&console.error("Error: MAX_HEADER_BUF too small in bitstream.c")}}huffman_coder_count1(e,t){C(r0&&t.count1table_select+32<r0.length);var s=r0[t.count1table_select+32],n,l=0,a=t.big_values,_=t.big_values;for(C(t.count1table_select<2),n=(t.count1-t.big_values)/4;n>0;--n){var r=0,h=0,c;c=t.l3_enc[a+0],c!==0&&(h+=8,t.xr[_+0]<0&&(r=1),C(c===1)),c=t.l3_enc[a+1],c!==0&&(h+=4,r<<=1,t.xr[_+1]<0&&(r|=1),C(c===1)),c=t.l3_enc[a+2],c!==0&&(h+=2,r<<=1,t.xr[_+2]<0&&(r|=1),C(c===1)),c=t.l3_enc[a+3],c!==0&&(h+=1,r<<=1,t.xr[_+3]<0&&(r|=1),C(c===1)),a+=4,_+=4,C(s.table&&s.hlen&&h<s.table.length&&h<s.hlen.length);var m=s.table[h],o=s.hlen[h],f=Ut(h);C(o>=0&&f>=0),this.putbits2(e,m,o),f>0&&this.putbits2(e,r,f),l+=o+f}return l}Huffmancode(e,t,s,n,l){C(r0&&t<r0.length);var a=r0[t],_=0;if(C(t<32),t==0)return 0;for(var r=s;r<n;r+=2){var h=0,c=0,m=a.linmax?a.xlen:0,o=a.xlen,f=0,i=Math.abs(l.l3_enc[r]),b=Math.abs(l.l3_enc[r+1]),d=l.l3_enc[r]<0,v=l.l3_enc[r+1]<0;if(t>15){if(C(m>0),i>=o){var M=i-o;C(M<=a.linmax),f=M,c=m,i=o}if(b>=o){var p=b-o;C(p<=a.linmax),f=f<<m|p,c+=m,b=o}}else C(i<=o),C(b<=o);var B=0,w=0;i!=0&&(B=d?1:0,w=1),b!=0&&(B=B<<1|(v?1:0),w++),f=f<<w|B,c+=w;var y=i*(o+1)+b;C(a.table&&a.hlen&&y<a.table.length&&y<a.hlen.length),h=a.hlen[y],C(h>=0&&c>=0),this.putbits2(e,a.table[y],h),c>0&&this.putbits2(e,f,c),_+=h+c}return _}ShortHuffmancodebits(e,t){C(e.scalefac_band&&e.scalefac_band.s);var s=this.Huffmancode(e,t.table_select[0],0,t.big_values,t);return s}LongHuffmancodebits(e,t){var s,n,l,a;s=t.big_values,C(0<=s&&s<=576),C(e.scalefac_band&&e.scalefac_band.l);var _=t.region0_count+1;return C(0<=_&&_<e.scalefac_band.l.length),l=e.scalefac_band.l[_],_+=t.region1_count+1,C(0<=_&&_<e.scalefac_band.l.length),a=e.scalefac_band.l[_],l>s&&(l=s),a>s&&(a=s),n=this.Huffmancode(e,t.table_select[0],0,l,t),n+=this.Huffmancode(e,t.table_select[1],l,a,t),n+=this.Huffmancode(e,t.table_select[2],a,s,t),n}writeMainData(e){var t,s,n,l,a=0,_=e.internal_flags,r=_.l3_side;if(e.version==1)for(t=0;t<2;t++)for(s=0;s<_.channels_out;s++){var h=r.tt[t][s],c=zt[h.scalefac_compress],m=jt[h.scalefac_compress],o=0;for(n=0;n<h.sfbdivide;n++)h.scalefac[n]!=-1&&(this.putbits2(_,h.scalefac[n],c),o+=c);for(;n<h.sfbmax;n++)h.scalefac[n]!=-1&&(this.putbits2(_,h.scalefac[n],m),o+=m);var f=0;h.window_switching_flag&&h.block_type==it?f=this.ShortHuffmancodebits(_,h):f=this.LongHuffmancodebits(_,h),f+=this.huffman_coder_count1(_,h),C(o+f==h.part2_3_length),a+=o+f}else for(t=0,s=0;s<_.channels_out;s++){var h=r.tt[t][s],i,b,o=0;C(h.sfb_partition_table!=null);var f=0;if(n=0,b=0,h.window_switching_flag&&h.block_type==it){for(;b<4;b++){var d=h.sfb_partition_table[b]/3,v=h.slen[b];for(i=0;i<d;i++,n++)this.putbits2(_,Math.max(h.scalefac[n*3+0],0),v),this.putbits2(_,Math.max(h.scalefac[n*3+1],0),v),this.putbits2(_,Math.max(h.scalefac[n*3+2],0),v),o+=3*v}f=this.ShortHuffmancodebits(_,h)}else{for(;b<4;b++){var d=h.sfb_partition_table[b],v=h.slen[b];for(i=0;i<d;i++,n++)this.putbits2(_,Math.max(h.scalefac[n],0),v),o+=v}f=this.LongHuffmancodebits(_,h)}f+=this.huffman_coder_count1(_,h),C(o+f==h.part2_3_length),a+=o+f}return a}compute_flushbits(e,t){var s=e.internal_flags,n,l,a,_,r;return C(s.header),r=s.w_ptr,_=(s.h_ptr-1+I0)%I0,C(s.header[_]),n=s.header[_].write_timing-this.totbit,t.total=n,n>=0&&(l=(_-r+1+I0)%I0,n-=l*8*s.sideinfo_len),a=this.getframebits(e),n+=a,t.total+=a,t.total%8!=0?t.total=1+Math.floor(t.total/8):t.total=t.total/8,t.total+=this.bufByteIdx+1,n<0?(console.error("strange error flushing buffer ... flushbits < 0"),-1):n}flush_bitstream(e){var t=e.internal_flags,s,n;C(t.header);var l=(t.h_ptr-1+I0)%I0;C(t.header[l]),s=t.l3_side;let a=new De;if(n=this.compute_flushbits(e,a),!(n<0)){if(this.drain_into_ancillary(e,n),C(A.EQ(t.header[l].write_timing+this.getframebits(e),this.totbit)),t.ResvSize=0,s.main_data_begin=0,t.findReplayGain&&this.context&&this.ga){let r=this.ga;var _=r.GetTitleGain(t.rgdata);C(A.NEQ(_,r.GAIN_NOT_ENOUGH_SAMPLES)),t.RadioGain=Math.floor(_*10+.5)}t.findPeakSample&&(t.PeakSample>0?t.noclipGainChange=Math.ceil(Math.log10(t.PeakSample/32767)*20*10):t.noclipGainChange=-1/0,t.noclipGainChange>0&&(A.EQ(e.scale,1)||A.EQ(e.scale,0))?t.noclipScale=t.PeakSample>0?Math.floor(32767/t.PeakSample*100)/100:1:t.noclipScale=-1)}}add_dummy_byte(e,t,s){for(var n=e.internal_flags,l;s-- >0;)for(this.putbits_noheaders(n,t,8),l=0;l<I0;++l)n.header&&n.header[l]&&(n.header[l].write_timing+=8)}format_bitstream(e){var t=e.internal_flags,s;s=t.l3_side;var n=this.getframebits(e);this.drain_into_ancillary(e,s.resvDrain_pre),this.encodeSideInfo2(e,n);var l=this.writeMainData(e),a=8*t.sideinfo_len;this.drain_into_ancillary(e,s.resvDrain_post);var _=a+l+s.resvDrain_post,r=n-_;s.main_data_begin=(t.ResvSize+r)/8;let h=new De;if(this.compute_flushbits(e,h)!=t.ResvSize&&console.error("Internal buffer inconsistency. flushbits <> ResvSize"),Math.abs(s.main_data_begin*8-t.ResvSize)>1&&(console.error(`Bit reservoir error: MDB*8 (${s.main_data_begin*8}) != ResvSize (${t.ResvSize})`),console.error(`  Frame deficit: ${r}, Bits written: ${_}, BPF: ${n}`),t.ResvSize=s.main_data_begin*8),C(this.totbit%8==0),this.totbit>1e9){var c,m=this.totbit-this.totbit%n;for(c=0;c<I0;++c)t.header&&t.header[c]&&(t.header[c].write_timing-=m);this.totbit-=m}return 0}copy_buffer(e,t,s,n,l){var a=this.bufByteIdx+1;if(a<=0)return 0;if(n!=0&&a>n)return console.error("Output buffer too small in copy_buffer"),-1;if(C(this.buf),C(t),c0.arraycopy(this.buf,0,t,s,a),this.bufByteIdx=-1,this.bufBitIdx=0,l!=0&&this.vbr){var _=N0(1);_[0]=e.nMusicCRC,this.vbr.updateMusicCRC(_,t,s,a),e.nMusicCRC=_[0],a>0&&(C(e.VBR_seek_table),e.VBR_seek_table.nBytesWritten+=a)}if(e.decode_on_the_fly&&this.mpg)for(var r=q0([2,1152]),h=a,c=-1,m=s,o;c!=0&&h>0;){c=this.mpg.hip_decode1_unclipped(e.hip,t,m,h,r[0],r[1]);var f=h;if(h-=f,m+=f,c==-1)console.error("hip_decode1_unclipped error during decode-on-the-fly"),c=0;else if(c>0){if(C(c<=1152),e.findPeakSample){for(o=0;o<c;o++){let i=Math.abs(r[0][o]);i>e.PeakSample&&(e.PeakSample=i)}if(e.channels_out>1)for(o=0;o<c;o++){let i=Math.abs(r[1][o]);i>e.PeakSample&&(e.PeakSample=i)}}if(e.findReplayGain&&this.context&&this.ga){let i=this.ga;if(i.AnalyzeSamples(e.rgdata,r[0],0,r[1],0,c,e.channels_out)==i.GAIN_ANALYSIS_ERROR)return console.error("GainAnalysis.AnalyzeSamples error"),-6}}}return a}init_bit_stream_w(e){this.buf=X0(ve),e.h_ptr=e.w_ptr=0,e.header&&e.header[e.h_ptr]?e.header[e.h_ptr].write_timing=0:console.error("Header buffer not initialized before init_bit_stream_w"),this.bufByteIdx=-1,this.bufBitIdx=0,this.totbit=0}};var Ze,Ke,Ge=class{constructor(){et(this,Ze,null);et(this,Ke,null)}setModules(e,t){(!e||!t)&&console.warn("VBRQuantize.setModules called with invalid arguments."),tt(this,Ze,e),tt(this,Ke,t)}};Ze=new WeakMap,Ke=new WeakMap;function ze(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var f1=p0,ds=N0;function b1(){this.global_gain=0,this.sfb_count1=0,this.step=ds(39),this.noise=f1(39),this.noise_log=f1(39)}var{VbrMode:u1,Float:E_,ShortBlock:B_,Util:xt,Arrays:Me,new_float:Ae,new_float_n:T_,new_int:y_,assert:R0}=G,je=class{constructor(){S(this,"bs",null);S(this,"rv",null);S(this,"qupvt",null);S(this,"tk",null);S(this,"vbr");this.vbr=new Ge}setModules(e,t,s,n){this.bs=e,this.rv=t,this.qupvt=s,this.tk=n,this.vbr.setModules(this.qupvt,this.tk)}ms_convert(e,t){let s=e.tt[t][0].xr,n=e.tt[t][1].xr;for(let l=0;l<576;++l){let a=s[l],_=n[l];s[l]=(a+_)*(xt.SQRT2*.5),n[l]=(a-_)*(xt.SQRT2*.5)}}init_xrpow(e,t,s){let n=e.internal_flags,l=0,a=0|t.max_nonzero_coeff;R0(s!=null,"xrpow array must be provided"),t.xrpow_max=0,R0(0<=a&&a<=575,`Invalid upper bound: ${a}`),Me.fill(s,a+1,576,0);for(let _=0;_<=a;++_){let r=Math.abs(t.xr[_]);l+=r,s[_]=Math.sqrt(r*Math.sqrt(r)),s[_]>t.xrpow_max&&(t.xrpow_max=s[_])}if(l>1e-20){let _=(n.substep_shaping&2)!==0?1:0;for(let r=0;r<t.psymax;r++)n.pseudohalf[r]=_;return!0}return Me.fill(t.l3_enc,0,576,0),!1}init_outer_loop(e,t){let s=e.internal_flags;t.part2_3_length=0,t.big_values=0,t.count1=0,t.global_gain=210,t.scalefac_compress=0,t.table_select[0]=0,t.table_select[1]=0,t.table_select[2]=0,t.subblock_gain[0]=0,t.subblock_gain[1]=0,t.subblock_gain[2]=0,t.region0_count=0,t.region1_count=0,t.preflag=0,t.scalefac_scale=0,t.count1table_select=0,t.part2_length=0,t.sfb_lmax=x.SBPSY_l,t.sfb_smin=x.SBPSY_s,t.psy_lmax=s.sfb21_extra?x.SBMAX_l:x.SBPSY_l,t.psymax=t.psy_lmax,t.sfbmax=t.sfb_lmax,t.sfbdivide=11;for(let n=0;n<x.SBMAX_l;n++)t.width[n]=s.scalefac_band.l[n+1]-s.scalefac_band.l[n],t.window[n]=0;if(t.block_type===x.SHORT_TYPE){let n=Ae(576);t.sfb_smin=0,t.sfb_lmax=0,t.mixed_block_flag!==0&&(t.sfb_smin=3,t.sfb_lmax=s.mode_gr*2+4),t.psymax=t.sfb_lmax+3*((s.sfb21_extra?x.SBMAX_s:x.SBPSY_s)-t.sfb_smin),t.sfbmax=t.sfb_lmax+3*(x.SBPSY_s-t.sfb_smin),t.sfbdivide=t.sfbmax-18,t.psy_lmax=t.sfb_lmax;let l=s.scalefac_band.l[t.sfb_lmax];System.arraycopy(t.xr,0,n,0,576);for(let _=t.sfb_smin;_<x.SBMAX_s;_++){let r=s.scalefac_band.s[_],h=s.scalefac_band.s[_+1];for(let c=0;c<3;c++)for(let m=r;m<h;m++)t.xr[l++]=n[3*m+c]}R0(l<=576,"Short block reordering overflowed xr array");let a=t.sfb_lmax;for(let _=t.sfb_smin;_<x.SBMAX_s;_++){let r=s.scalefac_band.s[_+1]-s.scalefac_band.s[_];t.width[a]=t.width[a+1]=t.width[a+2]=r,t.window[a]=0,t.window[a+1]=1,t.window[a+2]=2,a+=3}}t.count1bits=0,t.slen[0]=0,t.slen[1]=0,t.slen[2]=0,t.slen[3]=0,t.max_nonzero_coeff=575,Me.fill(t.scalefac,0),this._psfb21_analogsilence(s,t)}_psfb21_analogsilence(e,t){let s=e.ATH,n=t.xr;if(t.block_type!=x.SHORT_TYPE){let l=!1;for(let a=x.PSFB21-1;a>=0&&!l;a--){let _=e.scalefac_band.psfb21[a],r=e.scalefac_band.psfb21[a+1],h=this.qupvt.athAdjust(s.adjust,s.psfb21[a],s.floor);e.nsPsy.longfact[21]>1e-12&&(h*=e.nsPsy.longfact[21]);for(let c=r-1;c>=_;c--)if(Math.abs(n[c])<h)n[c]=0;else{l=!0;break}}}else for(let l=0;l<3;l++){let a=!1;for(let _=x.PSFB12-1;_>=0&&!a;_--){let r=e.scalefac_band.s[_],h=e.scalefac_band.s[_+1],c=e.scalefac_band.psfb12[_],m=e.scalefac_band.psfb12[_+1],o=e.scalefac_band.s[13]-e.scalefac_band.s[12],f=e.scalefac_band.psfb12[_+1]-e.scalefac_band.psfb12[_],i=e.scalefac_band.s[12]*3+o*l+(e.scalefac_band.psfb12[_]-e.scalefac_band.psfb12[0]),b=i+f,d=this.qupvt.athAdjust(s.adjust,s.psfb12[_],s.floor);e.nsPsy.shortfact[12]>1e-12&&(d*=e.nsPsy.shortfact[12]);for(let v=b-1;v>=i;v--);}}}trancate_smallspectrums(e,t,s,n){if((e.substep_shaping&4)==0&&t.block_type==x.SHORT_TYPE||(e.substep_shaping&128)!=0)return;let l=Ae(M0.SFBMAX),a=new ze;this.qupvt.calc_noise(t,s,l,a,null);for(let h=0;h<576;h++)n[h]=t.l3_enc[h]!==0?Math.abs(t.xr[h]):0;let _=0,r=t.block_type===x.SHORT_TYPE?6:8;for(let h=r;h<t.psymax;h++){let c=t.width[h],m=_;if(_+=c,l[h]>=1||c===0||(Me.sort(n,m,m+c),Math.abs(n[m+c-1])<1e-9))continue;let o=(1-l[h])*s[h],f=0,i=0,b=0;for(let d=0;d<c;d++){let v=n[m+d],M=v*v;if(i+M>o){f=v*.9999,d>0?f=n[m+d-1]:f=0;break}i+=M,b++}if(b===c&&(f=n[m+c-1]*1.0001),f>1e-9)for(let d=0;d<c;d++){let v=m+d;Math.abs(t.xr[v])<=f&&(t.l3_enc[v]=0)}}t.part2_3_length=this.tk.noquant_count_bits(e,t,null)}outer_loop(e,t,s,n,l,a){let _=e.internal_flags,r=new V0,h=Ae(576),c=Ae(M0.SFBMAX),m=new ze,o=new b1,f=9999999,i=!1,b=!1,d=0;if(this._bin_search_StepSize(_,t,a,l,n),_.noise_shaping===0)return 100;this.qupvt.calc_noise(t,s,c,m,o),m.bits=t.part2_3_length,f=t.part2_3_length,r.assign(t);let v=0;for(System.arraycopy(n,0,h,0,576);!i;){e:do{let M=new ze,p,B=255;if(p=(_.substep_shaping&2)!==0?20:3,_.sfb21_extra&&(c[r.sfbmax]>1||r.block_type===x.SHORT_TYPE&&(c[r.sfbmax+1]>1||c[r.sfbmax+2]>1))||!this._balance_noise(e,r,c,n,b))break e;r.scalefac_scale!==0&&(B=254);let w=a-r.part2_length;if(w<=0)break e;let y=this.tk.count_bits(_,n,r,o);for(;y>w&&r.global_gain<=B;)r.global_gain++,y=this.tk.count_bits(_,n,r,o);if(r.part2_3_length=y,r.global_gain>B)break e;if(m.over_count===0){for(;r.part2_3_length>f&&r.global_gain<=B;)r.global_gain++,r.part2_3_length=this.tk.count_bits(_,n,r,o);if(r.global_gain>B)break e}this.qupvt.calc_noise(r,s,c,M,o),M.bits=r.part2_3_length;let u=t.block_type!==x.SHORT_TYPE?e.quant_comp:e.quant_comp_short;if(this._quant_compare(u,m,M,r,c))f=r.part2_3_length,m=M,t.assign(r),v=0,System.arraycopy(n,0,h,0,576);else if(_.full_outer_loop===0&&(v++,v>p&&m.over_count===0||_.noise_shaping_amp===3&&b&&(v>30||r.global_gain-d>15)))break e}while(r.global_gain+r.scalefac_scale<255);_.noise_shaping_amp===3?b?i=!0:(r.assign(t),System.arraycopy(h,0,n,0,576),v=0,d=r.global_gain,b=!0):i=!0}return R0(t.global_gain+t.scalefac_scale<=255,"Final global gain exceeds limit"),e.VBR===u1.vbr_rh||e.VBR===u1.vbr_mtrh?System.arraycopy(h,0,n,0,576):(_.substep_shaping&1)!==0&&this.trancate_smallspectrums(_,t,s,n),m.over_count}_bin_search_StepSize(e,t,s,n,l){var a,_=e.CurrentStep[n],r=!1,h=e.OldValue[n],c=0;for(t.global_gain=h,s-=t.part2_length,R0(_!==0,"CurrentStep cannot be zero in bin_search");a=this.tk.count_bits(e,l,t,null),!(_===1||a===s);){var m;a>s?(c===2&&(r=!0),r&&(_/=2),c=1,m=Math.floor(_)):(c===1&&(r=!0),r&&(_/=2),c=2,m=-Math.floor(_)),_<1&&(_=1),t.global_gain+=m,t.global_gain<0&&(t.global_gain=0,r=!0,_=1),t.global_gain>255&&(t.global_gain=255,r=!0,_=1),_<1&&(_=1)}for(R0(t.global_gain>=0&&t.global_gain<256,"Invalid global gain after bin_search");a>s&&t.global_gain<255;)t.global_gain++,a=this.tk.count_bits(e,l,t,null);e.CurrentStep[n]=Math.abs(h-t.global_gain)>=4?4:2,e.OldValue[n]=t.global_gain,t.part2_3_length=a}_balance_noise(e,t,s,n,l){let a=e.internal_flags;if(this._amp_scalefac_bands(e,t,s,n,l),this._loop_break(t))return!1;let _=!1;return a.mode_gr===2?_=this.tk.scale_bitcount(t):_=this.tk.scale_bitcount_lsf(a,t),_?(a.noise_shaping>1&&(Me.fill(a.pseudohalf,0),t.scalefac_scale===0?(this._inc_scalefac_scale(t,n),_=!1):t.block_type===x.SHORT_TYPE&&a.subblock_gain>0&&(_=this._inc_subblock_gain(a,t,n)||this._loop_break(t))),_||(a.mode_gr===2?_=this.tk.scale_bitcount(t):_=this.tk.scale_bitcount_lsf(a,t)),!_):!0}_amp_scalefac_bands(e,t,s,n,l){let a=e.internal_flags,_=t.scalefac_scale===0?1.2968395546510096:1.6817928305074292,r=0;for(let m=0;m<t.sfbmax;m++)r<s[m]&&(r=s[m]);let h=a.noise_shaping_amp;switch(h===3&&(h=l?2:1),h){case 2:break;case 1:r=r>1?Math.pow(r,.5):r*.95;break;case 0:default:r=r>1?1:r*.95;break}let c=0;for(let m=0;m<t.sfbmax;m++){let o=t.width[m];if(c+=o,!(s[m]<r)){if((a.substep_shaping&2)!==0&&(a.pseudohalf[m]=a.pseudohalf[m]===0?1:0,a.pseudohalf[m]===0&&h===2))return;t.scalefac[m]++;for(let f=-o;f<0;f++)n[c+f]*=_,n[c+f]>t.xrpow_max&&(t.xrpow_max=n[c+f]);if(h===2)return}}}_loop_break(e){for(let t=0;t<e.sfbmax;t++)if(e.scalefac[t]+e.subblock_gain[e.window[t]]===0)return!1;return!0}_quant_compare(e,t,s,n,l){let a;switch(e){default:case 9:{t.over_count>0?(a=s.over_SSD<=t.over_SSD,s.over_SSD===t.over_SSD&&(a=s.bits<t.bits)):a=s.max_noise<0&&s.max_noise*10+s.bits<=t.max_noise*10+t.bits;break}case 0:a=s.over_count<t.over_count||s.over_count===t.over_count&&s.over_noise<t.over_noise||s.over_count===t.over_count&&Math.abs(s.over_noise-t.over_noise)<1e-9&&s.tot_noise<t.tot_noise;break;case 8:s.max_noise=this._get_klemm_noise(l,n);case 1:a=s.max_noise<t.max_noise;break;case 2:a=s.tot_noise<t.tot_noise;break;case 3:a=s.tot_noise<t.tot_noise&&s.max_noise<t.max_noise;break;case 4:a=s.max_noise<=0&&t.max_noise>.2||s.max_noise<=0&&t.max_noise<0&&t.max_noise>s.max_noise-.2&&s.tot_noise<t.tot_noise||s.max_noise<=0&&t.max_noise>0&&t.max_noise>s.max_noise-.2&&s.tot_noise<t.tot_noise+t.over_noise||s.max_noise>0&&t.max_noise>-.05&&t.max_noise>s.max_noise-.1&&s.tot_noise+s.over_noise<t.tot_noise+t.over_noise||s.max_noise>0&&t.max_noise>-.1&&t.max_noise>s.max_noise-.15&&s.tot_noise+s.over_noise+s.over_noise<t.tot_noise+t.over_noise+t.over_noise;break;case 5:a=s.over_noise<t.over_noise||Math.abs(s.over_noise-t.over_noise)<1e-9&&s.tot_noise<t.tot_noise;break;case 6:a=s.over_noise<t.over_noise||Math.abs(s.over_noise-t.over_noise)<1e-9&&(s.max_noise<t.max_noise||Math.abs(s.max_noise-t.max_noise)<1e-9&&s.tot_noise<=t.tot_noise);break;case 7:a=s.over_count<t.over_count||s.over_noise<t.over_noise;break}return t.over_count===0&&(a=a&&s.bits<t.bits),a}_get_klemm_noise(e,t){let s=1e-37;for(let n=0;n<t.psymax;n++)s+=xt.FAST_LOG10(.368+.632*e[n]*e[n]*e[n]);return Math.max(1e-20,s)}_inc_scalefac_scale(e,t){let s=1.2968395546510096,n=0;for(let l=0;l<e.sfbmax;l++){let a=e.width[l],_=e.scalefac[l];if(e.preflag!==0&&(_+=this.qupvt.pretab[l]),n+=a,(_&1)!==0){_++;for(let r=-a;r<0;r++)t[n+r]*=s,t[n+r]>e.xrpow_max&&(e.xrpow_max=t[n+r])}e.scalefac[l]=_>>1}e.preflag=0,e.scalefac_scale=1}_inc_subblock_gain(e,t,s){let n,l=t.scalefac;for(n=0;n<t.sfb_lmax;n++)if(l[n]>=16)return!0;for(let a=0;a<3;a++){let _=0,r=0;for(n=t.sfb_lmax+a;n<t.sfbdivide;n+=3)_<l[n]&&(_=l[n]);for(;n<t.sfbmax;n+=3)r<l[n]&&(r=l[n]);if(_<16&&r<8)continue;if(t.subblock_gain[a]>=7)return!0;t.subblock_gain[a]++;let h=e.scalefac_band.l[t.sfb_lmax];for(n=t.sfb_lmax+a;n<t.sfbmax;n+=3){let c=t.width[n],m=l[n];if(R0(m>=0),m=m-(4>>t.scalefac_scale),m>=0){l[n]=m,h+=c*3;continue}l[n]=0;let o=210+(m<<t.scalefac_scale+1),f=this.qupvt.IPOW20(o);h+=c*(a+1);for(let i=-c;i<0;i++)s[h+i]*=f,s[h+i]>t.xrpow_max&&(t.xrpow_max=s[h+i]);h+=c*(3-a-1)}if(n<x.SBMAX_s*3+t.sfb_lmax){let c=this.qupvt.IPOW20(202),m=t.width[n-3];h+=m*(a+1);for(let o=-m;o<0;o++)s[h+o]*=c,s[h+o]>t.xrpow_max&&(t.xrpow_max=s[h+o])}}return!1}iteration_finish_one(e,t,s){let n=e.internal_flags,l=n.l3_side,a=l.tt[t][s];this.tk.best_scalefac_store(n,t,s,l),n.use_best_huffman===1&&this.tk.best_huffman_divide(n,a),this.rv.ResvAdjust(n,a)}VBR_encode_granule(e,t,s,n,l,a,_){let r=e.internal_flags,h=new V0,c=Ae(576),m=_,o=_,f=a,i=Math.floor((o+f)/2),b=o-f,d=0,v=0,M=r.sfb21_extra;R0(m<=LameInternalFlags.MAX_BITS_PER_CHANNEL,"Initial max_bits exceeds limit");do{if(R0(i>=f,`this_bits ${i} < min_bits ${f}`),R0(i<=o,`this_bits ${i} > max_bits ${o}`),R0(f<=o,`min_bits ${f} > max_bits ${o}`),i>m-42?r.sfb21_extra=!1:r.sfb21_extra=M,d=this.outer_loop(e,t,s,n,l,i),d<=0){v=1;let p=t.part2_3_length;h.assign(t),System.arraycopy(n,0,c,0,576),o=p-32,o<f&&(o=f)}else f=i+32,f>m&&(f=m),v===1&&(v=2,t.assign(h),System.arraycopy(c,0,n,0,576));o<f&&(o=f),b=o-f,i=Math.floor((o+f)/2)}while(b>12);r.sfb21_extra=M,v===2&&t.assign(h),R0(t.part2_3_length<=m+100,`VBR encode used too many bits: ${t.part2_3_length} > ${m}`)}get_framebits(e,t){let s=e.internal_flags,n,l=s.VBR_min_bitrate;s.bitrate_index=1,n=this.bs.getframebits(e),s.bitrate_index=l;for(let a=1;a<=s.VBR_max_bitrate;a++){s.bitrate_index=a;let _=new W0(0);t[a]=this.rv.ResvFrameBegin(e,_)}s.bitrate_index=e.brate}VBR_old_prepare(e,t,s,n,l,a,_,r,h){let c=e.internal_flags,m=1,o=0;c.bitrate_index=c.VBR_max_bitrate;let f=this.rv.ResvFrameBegin(e,new W0(0))/c.mode_gr;for(let b=0;b<c.mode_gr;b++){let d=this.qupvt.on_pe(e,t,r[b],f,b,0);c.mode_ext===x.MPG_MD_MS_LR&&(this.ms_convert(c.l3_side,b),this.qupvt.reduce_side(r[b],s[b],f,d));for(let v=0;v<c.channels_out;++v){let M=c.l3_side.tt[b][v],p=0,B=0;M.block_type!==x.SHORT_TYPE?(p=1.28/(1+Math.exp(3.5-t[b][v]/300))-.05,B=c.PSY.mask_adjust-p):(p=2.56/(1+Math.exp(3.5-t[b][v]/300))-.14,B=c.PSY.mask_adjust_short-p),c.masking_lower=Math.pow(10,B*.1),this.init_outer_loop(c,M),h[b][v]=this.qupvt.calc_xmin(e,n[b][v],M,l[b][v]),h[b][v]!==0&&(m=0),_[b][v]=126,o+=r[b][v]}}let i=a[c.VBR_max_bitrate];if(o>i)for(let b=0;b<c.mode_gr;b++)for(let d=0;d<c.channels_out;d++)r[b][d]=Math.floor(r[b][d]*i/o);for(let b=0;b<c.mode_gr;b++)for(let d=0;d<c.channels_out;d++)_[b][d]>r[b][d]&&(_[b][d]=r[b][d]);return m}bitpressure_strategy(e,t,s,n){let l=e.internal_flags;for(let a=0;a<l.mode_gr;a++)for(let _=0;_<l.channels_out;_++){let r=l.l3_side.tt[a][_],h=t[a][_],c=0;for(let m=0;m<r.psy_lmax;m++)h[c++]*=1+.029*m*m/(x.SBMAX_l*x.SBMAX_l);if(r.block_type===x.SHORT_TYPE)for(let m=r.sfb_smin;m<x.SBMAX_s;m++){let o=1+.029*m*m/(x.SBMAX_s*x.SBMAX_s);c<h.length&&(h[c++]*=o),c<h.length&&(h[c++]*=o),c<h.length&&(h[c++]*=o)}n[a][_]=0|Math.max(s[a][_],.9*n[a][_])}}VBR_new_prepare(e,t,s,n,l,a){let _=e.internal_flags,r=1,h=0,c=0,m;if(e.free_format){_.bitrate_index=0;let f=new W0(h);m=this.rv.ResvFrameBegin(e,f),h=f.bits,l[0]=m}else{_.bitrate_index=_.VBR_max_bitrate;let f=new W0(h);m=this.rv.ResvFrameBegin(e,f),h=f.bits,this.get_framebits(e,l),_.bitrate_index=e.brate}let o=h/_.mode_gr;for(let f=0;f<_.mode_gr;f++){this.qupvt.on_pe(e,t,a[f],o,f,0),_.mode_ext===x.MPG_MD_MS_LR&&this.ms_convert(_.l3_side,f);for(let i=0;i<_.channels_out;++i){let b=_.l3_side.tt[f][i];_.masking_lower=Math.pow(10,_.PSY.mask_adjust*.1),this.init_outer_loop(_,b),this.qupvt.calc_xmin(e,s[f][i],b,n[f][i])!==0&&(r=0),c+=a[f][i]}}if(c>m)for(let f=0;f<_.mode_gr;f++)for(let i=0;i<_.channels_out;i++)a[f][i]=Math.floor(a[f][i]*m/c);return r}calc_target_bits(e,t,s,n,l,a){let _=e.internal_flags,r=_.l3_side,h,c,m;_.bitrate_index=_.VBR_max_bitrate;let o=new W0(0);a[0]=this.rv.ResvFrameBegin(e,o),_.bitrate_index=1,m=this.bs.getframebits(e)-_.sideinfo_len*8,l[0]=Math.floor(m/(_.mode_gr*_.channels_out)),m=e.VBR_mean_bitrate_kbps*e.framesize*1e3,m/=e.out_samplerate,m-=_.sideinfo_len*8,(_.substep_shaping&1)!==0&&(m*=1.09),m/=_.mode_gr*_.channels_out,h=.93+.07*(11-e.compression_ratio)/(11-5.5),h<.9&&(h=.9),h>1&&(h=1);for(let f=0;f<_.mode_gr;f++){let i=0;for(let b=0;b<_.channels_out;b++){let d=Math.floor(h*m),v=0;t[f][b]>700&&(v=Math.floor((t[f][b]-700)/1.4),r.tt[f][b].block_type===x.SHORT_TYPE&&v<m/2&&(v=Math.floor(m/2)),v>m*1.5?v=Math.floor(m*1.5):v<0&&(v=0),d+=v),d>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(d=LameInternalFlags.MAX_BITS_PER_CHANNEL),n[f][b]=d,i+=d}if(i>LameInternalFlags.MAX_BITS_PER_GRANULE)for(let b=0;b<_.channels_out;++b)n[f][b]=Math.floor(n[f][b]*LameInternalFlags.MAX_BITS_PER_GRANULE/i)}if(_.mode_ext===x.MPG_MD_MS_LR)for(let f=0;f<_.mode_gr;f++)this.qupvt.reduce_side(n[f],s[f],m*_.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);c=0;for(let f=0;f<_.mode_gr;f++)for(let i=0;i<_.channels_out;i++)n[f][i]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(n[f][i]=LameInternalFlags.MAX_BITS_PER_CHANNEL),c+=n[f][i];if(c>a[0])for(let f=0;f<_.mode_gr;f++)for(let i=0;i<_.channels_out;i++)n[f][i]=Math.floor(n[f][i]*a[0]/c)}},W0=class{constructor(e){this.bits=e}};var xs=c0,pt=J;var d1=o0;var ps=E0;var Ue=X0;var Ss=C;ce.NUMTOCENTRIES=100;ce.MAXFRAMESIZE=2880;function ce(){var A,e,t;this.setModules=function(R,T,k){A=R,e=T,t=k};var s=1,n=2,l=4,a=8,_=ce.NUMTOCENTRIES,r=ce.MAXFRAMESIZE,h=_+4+4+4+4+4,c=h+9+1+1+8+1+1+3+1+1+2+4+2+2,m=128,o=64,f=32,i=null,b="Xing",d="Info",v=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function M(R,T){if(R.nVbrNumFrames++,R.sum+=T,R.seen++,!(R.seen<R.want)&&(R.pos<R.size&&(R.bag[R.pos]=R.sum,R.pos++,R.seen=0),R.pos==R.size)){for(var k=1;k<R.size;k+=2)R.bag[k/2]=R.bag[k];R.want*=2,R.pos/=2}}function p(R,T){if(!(R.pos<=0))for(var k=1;k<_;++k){var O=k/_,P,q,Y=0|Math.floor(O*R.pos);Y>R.pos-1&&(Y=R.pos-1),P=R.bag[Y],q=R.sum;var t0=0|256*P/q;t0>255&&(t0=255),T[k]=255&t0}}this.addVbrFrame=function(R){var T=R.internal_flags,k=Tables.bitrate_table[R.version][T.bitrate_index];Ss(T.VBR_seek_table.bag!=null),M(T.VBR_seek_table,k)};function B(R,T){var k=R[T+0]&255;return k<<=8,k|=R[T+1]&255,k<<=8,k|=R[T+2]&255,k<<=8,k|=R[T+3]&255,k}function w(R,T,k){R[T+0]=255&(k>>24&255),R[T+1]=255&(k>>16&255),R[T+2]=255&(k>>8&255),R[T+3]=255&(k&255)}function y(R,T,k){R[T+0]=255&(k>>8&255),R[T+1]=255&(k&255)}function u(R,T){return new String(R,T,b.length(),i).equals(b)||new String(R,T,d.length(),i).equals(d)}function E(R,T,k){return 255&(R<<T|k&~(-1<<T))}function I(R,T){var k=R.internal_flags;T[0]=E(T[0],8,255),T[1]=E(T[1],3,7),T[1]=E(T[1],1,R.out_samplerate<16e3?0:1),T[1]=E(T[1],1,R.version),T[1]=E(T[1],2,1),T[1]=E(T[1],1,R.error_protection?0:1),T[2]=E(T[2],4,k.bitrate_index),T[2]=E(T[2],2,k.samplerate_index),T[2]=E(T[2],1,0),T[2]=E(T[2],1,R.extension),T[3]=E(T[3],2,R.mode.ordinal()),T[3]=E(T[3],2,k.mode_ext),T[3]=E(T[3],1,R.copyright),T[3]=E(T[3],1,R.original),T[3]=E(T[3],2,R.emphasis),T[0]=255;var O=255&(T[1]&241),P;R.version==1?P=m:R.out_samplerate<16e3?P=f:P=o,R.VBR==pt.vbr_off&&(P=R.brate);var q;R.free_format?q=0:q=255&16*A.BitrateIndex(P,R.version,R.out_samplerate),R.version==1?(T[1]=255&(O|10),O=255&(T[2]&13),T[2]=255&(q|O)):(T[1]=255&(O|2),O=255&(T[2]&13),T[2]=255&(q|O))}this.getVbrTag=function(R){var T=new VBRTagData,k=0;T.flags=0;var O=R[k+1]>>3&1,P=R[k+2]>>2&3,q=R[k+3]>>6&3,Y=R[k+2]>>4&15;if(Y=Tables.bitrate_table[O][Y],R[k+1]>>4==14?T.samprate=Tables.samplerate_table[2][P]:T.samprate=Tables.samplerate_table[O][P],O!=0?q!=3?k+=36:k+=21:q!=3?k+=21:k+=13,!u(R,k))return null;k+=4,T.hId=O;var t0=T.flags=B(R,k);if(k+=4,(t0&s)!=0&&(T.frames=B(R,k),k+=4),(t0&n)!=0&&(T.bytes=B(R,k),k+=4),(t0&l)!=0){if(T.toc!=null)for(var H=0;H<_;H++)T.toc[H]=R[k+H];k+=_}T.vbrScale=-1,(t0&a)!=0&&(T.vbrScale=B(R,k),k+=4),T.headersize=(O+1)*72e3*Y/T.samprate,k+=21;var Z=R[k+0]<<4;Z+=R[k+1]>>4;var D=(R[k+1]&15)<<8;return D+=R[k+2]&255,(Z<0||Z>3e3)&&(Z=-1),(D<0||D>3e3)&&(D=-1),T.encDelay=Z,T.encPadding=D,T},this.InitVbrTag=function(R){var T=R.internal_flags,k;R.version==1?k=m:R.out_samplerate<16e3?k=f:k=o,R.VBR==pt.vbr_off&&(k=R.brate);var O=(R.version+1)*72e3*k/R.out_samplerate,P=T.sideinfo_len+c;if(T.VBR_seek_table.TotalFrameSize=O,O<P||O>r){R.bWriteVbrTag=!1;return}T.VBR_seek_table.nVbrNumFrames=0,T.VBR_seek_table.nBytesWritten=0,T.VBR_seek_table.sum=0,T.VBR_seek_table.seen=0,T.VBR_seek_table.want=1,T.VBR_seek_table.pos=0,T.VBR_seek_table.bag==null&&(T.VBR_seek_table.bag=new int[400],T.VBR_seek_table.size=400);var q=Ue(r);I(R,q);for(var Y=T.VBR_seek_table.TotalFrameSize,t0=0;t0<Y;++t0)e.add_dummy_byte(R,q[t0]&255,1)};function N(R,T){var k=T^R;return T=T>>8^v[k&255],T}this.updateMusicCRC=function(R,T,k,O){for(var P=0;P<O;++P)R[0]=N(T[k+P],R[0])};function X(R,T,k,O,P){var q=R.internal_flags,Y=0,t0=R.encoder_delay,H=R.encoder_padding,Z=100-10*R.VBR_q-R.quality,D=t.getLameVeryShortVersion(),$,s0=0,a0,h0=[1,5,3,2,4,0,3],p1=0|(R.lowpassfreq/100+.5>255?255:R.lowpassfreq/100+.5),vt=0,Q0=0,S1=0,v1=R.internal_flags.noise_shaping,G0=0,Mt=0,me=0,At=0,wt=0,M1=(R.exp_nspsytune&1)!=0,A1=(R.exp_nspsytune&2)!=0,Rt=!1,Et=!1,Bt=R.internal_flags.nogap_total,Tt=R.internal_flags.nogap_current,yt=R.ATHtype,It=0,fe;switch(R.VBR){case vbr_abr:fe=R.VBR_mean_bitrate_kbps;break;case vbr_off:fe=R.brate;break;default:fe=R.VBR_min_bitrate_kbps}switch(R.VBR.ordinal()<h0.length?$=h0[R.VBR.ordinal()]:$=0,a0=16*s0+$,q.findReplayGain&&(q.RadioGain>510&&(q.RadioGain=510),q.RadioGain<-510&&(q.RadioGain=-510),Q0=8192,Q0|=3072,q.RadioGain>=0?Q0|=q.RadioGain:(Q0|=512,Q0|=-q.RadioGain)),q.findPeakSample&&(vt=Math.abs(0|q.PeakSample/32767*Math.pow(2,23)+.5)),Bt!=-1&&(Tt>0&&(Et=!0),Tt<Bt-1&&(Rt=!0)),It=yt+((M1?1:0)<<4)+((A1?1:0)<<5)+((Rt?1:0)<<6)+((Et?1:0)<<7),Z<0&&(Z=0),R.mode){case MONO:G0=0;break;case STEREO:G0=1;break;case DUAL_CHANNEL:G0=2;break;case JOINT_STEREO:R.force_ms?G0=4:G0=3;break;case NOT_SET:default:G0=7;break}R.in_samplerate<=32e3?me=0:R.in_samplerate==48e3?me=2:R.in_samplerate>48e3?me=3:me=1,(R.short_blocks==d1.short_block_forced||R.short_blocks==d1.short_block_dispensed||R.lowpassfreq==-1&&R.highpassfreq==-1||R.scale_left<R.scale_right||R.scale_left>R.scale_right||R.disable_reservoir&&R.brate<320||R.noATH||R.ATHonly||yt==0||R.in_samplerate<=32e3)&&(Mt=1),At=v1+(G0<<2)+(Mt<<5)+(me<<6),wt=q.nMusicCRC,w(k,O+Y,Z),Y+=4;for(var we=0;we<9;we++)k[O+Y+we]=255&D.charAt(we);Y+=9,k[O+Y]=255&a0,Y++,k[O+Y]=255&p1,Y++,w(k,O+Y,vt),Y+=4,y(k,O+Y,Q0),Y+=2,y(k,O+Y,S1),Y+=2,k[O+Y]=255&It,Y++,fe>=255?k[O+Y]=255:k[O+Y]=255&fe,Y++,k[O+Y]=255&t0>>4,k[O+Y+1]=255&(t0<<4)+(H>>8),k[O+Y+2]=255&H,Y+=3,k[O+Y]=255&At,Y++,k[O+Y++]=0,y(k,O+Y,R.preset),Y+=2,w(k,O+Y,T),Y+=4,y(k,O+Y,wt),Y+=2;for(var ge=0;ge<Y;ge++)P=N(k[O+ge],P);return y(k,O+Y,P),Y+=2,Y}function F(R){R.seek(0);var T=Ue(10);R.readFully(T);var k;return new String(T,"ISO-8859-1").startsWith("ID3")?k=0:k=((T[6]&127)<<21|(T[7]&127)<<14|(T[8]&127)<<7|T[9]&127)+T.length,k}this.getLameTagFrame=function(R,T){var k=R.internal_flags;if(!R.bWriteVbrTag||k.Class_ID!=Lame.LAME_ID||k.VBR_seek_table.pos<=0)return 0;if(T.length<k.VBR_seek_table.TotalFrameSize)return k.VBR_seek_table.TotalFrameSize;ps.fill(T,0,k.VBR_seek_table.TotalFrameSize,0),I(R,T);var O=Ue(_);if(R.free_format)for(var P=1;P<_;++P)O[P]=255&255*P/100;else p(k.VBR_seek_table,O);var q=k.sideinfo_len;R.error_protection&&(q-=2),R.VBR==pt.vbr_off?(T[q++]=255&d.charAt(0),T[q++]=255&d.charAt(1),T[q++]=255&d.charAt(2),T[q++]=255&d.charAt(3)):(T[q++]=255&b.charAt(0),T[q++]=255&b.charAt(1),T[q++]=255&b.charAt(2),T[q++]=255&b.charAt(3)),w(T,q,s+n+l+a),q+=4,w(T,q,k.VBR_seek_table.nVbrNumFrames),q+=4;var Y=k.VBR_seek_table.nBytesWritten+k.VBR_seek_table.TotalFrameSize;w(T,q,0|Y),q+=4,xs.arraycopy(O,0,T,q,O.length),q+=O.length,R.error_protection&&e.CRC_writeheader(k,T);for(var t0=0,P=0;P<q;P++)t0=N(T[P],t0);return q+=X(R,Y,T,q,t0),k.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(R,T){var k=R.internal_flags;if(k.VBR_seek_table.pos<=0||(T.seek(T.length()),T.length()==0))return-1;var O=F(T);T.seek(O);var P=Ue(r),q=getLameTagFrame(R,P);return q>P.length?-1:(q<1||T.write(P,0,q),0)}}function St(){this.flags=0,this.year=0,this.title=null,this.artist=null,this.album=null,this.comment=null,this.track_id3v1=0,this.genre_id3v1=0,this.albumart=null,this.albumart_size=0,this.padding_size=0,this.albumart_mimetype=null,this.values=[],this.num_values=0,this.v2_head=null,this.v2_tail=null}St.prototype.setModules=function(A,e){this.bs=A,this.ver=e};var We=C;function x1(){var A;this.setModules=function(e){A=e},this.ResvFrameBegin=function(e,t){var s=e.internal_flags,n,l=s.l3_side,a=A.getframebits(e);t.bits=(a-s.sideinfo_len*8)/s.mode_gr;var _=8*256*s.mode_gr-8;e.brate>320?n=8*int(e.brate*1e3/(e.out_samplerate/1152)/8+.5):(n=8*1440,e.strict_ISO&&(n=8*int(32e4/(e.out_samplerate/1152)/8+.5))),s.ResvMax=n-a,s.ResvMax>_&&(s.ResvMax=_),(s.ResvMax<0||e.disable_reservoir)&&(s.ResvMax=0);var r=t.bits*s.mode_gr+Math.min(s.ResvSize,s.ResvMax);return r>n&&(r=n),We(s.ResvMax%8==0),We(s.ResvMax>=0),l.resvDrain_pre=0,s.pinfo!=null&&(s.pinfo.mean_bits=t.bits/2,s.pinfo.resvsize=s.ResvSize),r},this.ResvMaxBits=function(e,t,s,n){var l=e.internal_flags,a,_=l.ResvSize,r=l.ResvMax;n!=0&&(_+=t),(l.substep_shaping&1)!=0&&(r*=.9),s.bits=t,_*10>r*9?(a=_-r*9/10,s.bits+=a,l.substep_shaping|=128):(a=0,l.substep_shaping&=127,!e.disable_reservoir&&(l.substep_shaping&1)==0&&(s.bits-=.1*t));var h=_<l.ResvMax*6/10?_:l.ResvMax*6/10;return h-=a,h<0&&(h=0),h},this.ResvAdjust=function(e,t){e.ResvSize-=t.part2_3_length+t.part2_length},this.ResvFrameEnd=function(e,t){var s,n=e.l3_side;e.ResvSize+=t*e.mode_gr;var l=0;n.resvDrain_post=0,n.resvDrain_pre=0,(s=e.ResvSize%8)!=0&&(l+=s),s=e.ResvSize-l-e.ResvMax,s>0&&(We(s%8==0),We(s>=0),l+=s);{var a=Math.min(n.main_data_begin*8,l)/8;n.resvDrain_pre+=8*a,l-=8*a,e.ResvSize-=8*a,n.main_data_begin-=a}n.resvDrain_post+=l,e.ResvSize-=l}}var{VbrMode:H0}=G,e0=class{constructor(e,t,s,n,l,a,_,r,h,c,m,o,f,i,b){this.vbr_q=e,this.quant_comp=t,this.quant_comp_s=s,this.expY=n,this.st_lrm=l,this.st_s=a,this.masking_adj=_,this.masking_adj_short=r,this.ath_lower=h,this.ath_curve=c,this.ath_sensitivity=m,this.interch=o,this.safejoint=f,this.sfb21mod=i,this.msfix=b}},l0=class{constructor(e,t,s,n,l,a,_,r,h,c,m,o,f,i){this.kbps=e,this.quant_comp=t,this.quant_comp_s=s,this.safejoint=n,this.nsmsfix=l,this.st_lrm=a,this.st_s=_,this.nsbass=r,this.scale=h,this.masking_adj=c,this.ath_lower=m,this.ath_curve=o,this.interch=f,this.sfscale=i}},Qe=class{constructor(){S(this,"lame",null);S(this,"vbr_old_switch_map",[new e0(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e0(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e0(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e0(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e0(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e0(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e0(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e0(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e0(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e0(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e0(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)]);S(this,"vbr_psy_switch_map",[new e0(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e0(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e0(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e0(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e0(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e0(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e0(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e0(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e0(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e0(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e0(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)]);S(this,"abr_switch_map",[new l0(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new l0(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new l0(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new l0(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new l0(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new l0(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new l0(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new l0(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new l0(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new l0(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new l0(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new l0(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new l0(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new l0(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new l0(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new l0(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new l0(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)])}setModules(e){this.lame=e}_apply_vbr_preset(e,t,s){let n=e.VBR===H0.vbr_rh?this.vbr_old_switch_map:this.vbr_psy_switch_map,l=e.VBR_q_frac,a=Math.max(0,Math.min(t,n.length-2)),_=a+1,r=n[a],h=n[_],c=new e0(r.vbr_q,r.quant_comp,r.quant_comp_s,r.expY,r.st_lrm+l*(h.st_lrm-r.st_lrm),r.st_s+l*(h.st_s-r.st_s),r.masking_adj+l*(h.masking_adj-r.masking_adj),r.masking_adj_short+l*(h.masking_adj_short-r.masking_adj_short),r.ath_lower+l*(h.ath_lower-r.ath_lower),r.ath_curve+l*(h.ath_curve-r.ath_curve),r.ath_sensitivity+l*(h.ath_sensitivity-r.ath_sensitivity),r.interch+l*(h.interch-r.interch),r.safejoint,r.sfb21mod,r.msfix+l*(h.msfix-r.msfix));this._lame_set_VBR_q(e,c.vbr_q),(s!==0||e.quant_comp===-1)&&(e.quant_comp=c.quant_comp),(s!==0||e.quant_comp_short===-1)&&(e.quant_comp_short=c.quant_comp_s),c.expY!==0&&(e.experimentalY=!0),(s!==0||e.internal_flags.nsPsy.attackthre===-1)&&(e.internal_flags.nsPsy.attackthre=c.st_lrm),(s!==0||e.internal_flags.nsPsy.attackthre_s===-1)&&(e.internal_flags.nsPsy.attackthre_s=c.st_s),(s!==0||Math.abs(e.maskingadjust)<1e-6)&&(e.maskingadjust=c.masking_adj),(s!==0||Math.abs(e.maskingadjust_short)<1e-6)&&(e.maskingadjust_short=c.masking_adj_short),(s!==0||Math.abs(e.ATHlower)<1e-6)&&(e.ATHlower=-c.ath_lower/10),(s!==0||e.ATHcurve===-1)&&(e.ATHcurve=c.ath_curve),(s!==0||e.athaa_sensitivity===0)&&(e.athaa_sensitivity=c.ath_sensitivity),c.interch>0&&(s!==0||e.interChRatio===-1)&&(e.interChRatio=c.interch),c.safejoint>0&&(e.exp_nspsytune|=c.safejoint),c.sfb21mod>0&&(e.exp_nspsytune|=c.sfb21mod<<20),(s!==0||e.msfix===-1)&&(e.msfix=c.msfix),s===0&&(e.VBR_q=t,e.VBR_q_frac=l)}_apply_abr_preset(e,t,s){let n=t,l=this.lame._nearestBitrateFullIndex(t);e.VBR=H0.vbr_abr,e.VBR_mean_bitrate_kbps=n,e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320),e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.brate=e.VBR_mean_bitrate_kbps,e.VBR_mean_bitrate_kbps>320&&(e.disable_reservoir=!0);let a=this.abr_switch_map[l];if(!a)return console.error(`ABR preset not found for index ${l} (bitrate ${t})`),t;if(a.safejoint>0&&(e.exp_nspsytune|=2),a.sfscale>0&&(e.internal_flags.noise_shaping=2),Math.abs(a.nsbass)>1e-6){let r=Math.floor(a.nsbass*4);r<0&&(r+=64),e.exp_nspsytune|=r<<2}(s!==0||e.quant_comp===-1)&&(e.quant_comp=a.quant_comp),(s!==0||e.quant_comp_short===-1)&&(e.quant_comp_short=a.quant_comp_s),(s!==0||e.msfix===-1)&&(e.msfix=a.nsmsfix),(s!==0||e.internal_flags.nsPsy.attackthre===-1)&&(e.internal_flags.nsPsy.attackthre=a.st_lrm),(s!==0||e.internal_flags.nsPsy.attackthre_s===-1)&&(e.internal_flags.nsPsy.attackthre_s=a.st_s),(s!==0||e.scale===-1)&&(e.scale=a.scale),(s!==0||Math.abs(e.maskingadjust)<1e-6)&&(e.maskingadjust=a.masking_adj);let _=a.masking_adj>0?a.masking_adj*.9:a.masking_adj*1.1;return(s!==0||Math.abs(e.maskingadjust_short)<1e-6)&&(e.maskingadjust_short=_),(s!==0||Math.abs(e.ATHlower)<1e-6)&&(e.ATHlower=-a.ath_lower/10),(s!==0||e.ATHcurve===-1)&&(e.ATHcurve=a.ath_curve),(s!==0||e.interChRatio===-1)&&(e.interChRatio=a.interch),t}_lame_set_VBR_q(e,t){let s=0;return t<0&&(s=-1,t=0),t>9&&(s=-1,t=9),e.VBR_q=t,e.VBR_q_frac=0,s}apply_preset(e,t,s){let n=t;switch(t){case _0.R3MIX:t=_0.V3,e.VBR=H0.vbr_mtrh;break;case _0.MEDIUM:t=_0.V4,e.VBR=H0.vbr_rh;break;case _0.MEDIUM_FAST:t=_0.V4,e.VBR=H0.vbr_mtrh;break;case _0.STANDARD:t=_0.V2,e.VBR=H0.vbr_rh;break;case _0.STANDARD_FAST:t=_0.V2,e.VBR=H0.vbr_mtrh;break;case _0.EXTREME:t=_0.V0,e.VBR=H0.vbr_rh;break;case _0.EXTREME_FAST:t=_0.V0,e.VBR=H0.vbr_mtrh;break;case _0.INSANE:return t=320,e.preset=t,this._apply_abr_preset(e,t,s),e.VBR=H0.vbr_off,t}if(e.preset=t,t>=_0.V9&&t<=_0.V0){let l=9-Math.floor((t-_0.V9)/10);return this._apply_vbr_preset(e,l,s),t}return t>=8&&t<=320?this._apply_abr_preset(e,t,s):(console.warn(`Preset value ${n} not recognized.`),e.preset=0,n)}};var $e=class{constructor(){this.id3=new St,this.reservoir=new x1,this.quantizePVT=new d0,this.takehiro=new Ce(this),this.quantize=new je,this.vbrTag=new ce,this.presets=new Qe,this.lame=new he,this.version=new Be(this),this.bitStream=new Pe(this),this.gainAnalysis=new z,this.psyModel=new re,this.quantizePVT.setModules(this.takehiro,this.reservoir,this.psyModel),this.takehiro.setModules(this.quantizePVT),this.quantize.setModules(this.bitStream,this.reservoir,this.quantizePVT,this.takehiro),this.presets.setModules(this.lame),this.bitStream.setModules(this.gainAnalysis,null,this.version,this.vbrTag),this.id3.setModules(this.bitStream,this.version),this.reservoir.setModules(this.bitStream),this.vbrTag.setModules(this.lame,this.bitStream,this.version),this.lame.setModules(this.gainAnalysis,this.bitStream,this.presets,this.quantizePVT,this.quantize,this.vbrTag,this.version,this.id3,null)}};var Je=class{constructor(e){var n,l;if(this.context=new $e,this.gfp=this.context.lame.lame_init(),!this.gfp)throw new Error("Failed to initialize LAME library.");this.gfp.num_channels=e.channels,this.gfp.in_samplerate=e.sampleRate,this.gfp.brate=e.bitRate;let t={0:C0.STEREO,1:C0.JOINT_STEREO,2:C0.DUAL_CHANNEL,3:C0.MONO,4:C0.NOT_SET};this.gfp.mode=t[(n=e.mode)!=null?n:0],(this.gfp.mode===C0.NOT_SET||this.gfp.num_channels===1)&&(this.gfp.mode=e.channels===1?C0.MONO:C0.STEREO),this.gfp.quality=(l=e.quality)!=null?l:3,this.gfp.VBR=J.vbr_off,this.gfp.bWriteVbrTag=!1,this.gfp.disable_reservoir=!0,this.gfp.write_id3tag_automatic=!1;let s=this.context.lame.lame_init_params(this.gfp);if(s!==0)throw new Error(`Failed to initialize LAME encoder parameters (code ${s})`);this.maxSamples=e.maxBuffer||1152,this.mp3buf_size=Math.floor(1.25*this.maxSamples+7200),this.mp3buf=new Uint8Array(this.mp3buf_size)}encodeBuffer(e,t){let s=t!=null?t:null,n=e instanceof Float32Array;if(this.gfp.num_channels===1)s=e;else{if(!s)throw new Error("Right channel buffer required for stereo encoding.");if(e.length!==s.length)throw new Error("Left and right channel buffers must have the same length.");if(e.constructor!==s.constructor)throw new Error("Left and right channel buffers must have the same type (Float32Array or Int16Array).")}e.length>this.maxSamples&&(console.warn(`Input buffer size (${e.length}) exceeds configured maxSamples (${this.maxSamples}). Resizing MP3 buffer.`),this.maxSamples=e.length,this.mp3buf_size=Math.floor(1.25*this.maxSamples+7200),this.mp3buf=new Uint8Array(this.mp3buf_size));let l=0;if(n){let a=s instanceof Float32Array?s:this.gfp.num_channels===1?e:null;if(this.gfp.num_channels===2&&!a)throw new Error("Right Float32Array buffer needed for stereo float encoding.");l=this.context.lame.lame_encode_buffer_ieee_float(this.gfp,e,a,e.length,this.mp3buf,0,this.mp3buf_size)}else{let a=s instanceof Int16Array?s:this.gfp.num_channels===1?e:null;if(this.gfp.num_channels===2&&!a)throw new Error("Right Int16Array buffer needed for stereo int encoding.");l=this.context.lame.lame_encode_buffer(this.gfp,e,a,e.length,this.mp3buf,0,this.mp3buf_size)}if(l<0)throw new Error(`LAME encoding failed with error code: ${l}`);return new Int8Array(this.mp3buf.buffer,this.mp3buf.byteOffset,l)}flush(){if(!this.gfp)return console.warn("Encoder already closed or not initialized."),new Int8Array(0);let e=this.context.lame.lame_encode_flush(this.gfp,this.mp3buf,0,this.mp3buf_size);if(e<0)throw new Error(`LAME flush failed with error code: ${e}`);return new Int8Array(this.mp3buf.buffer,this.mp3buf.byteOffset,e)}close(){if(this.gfp){try{this.context.lame.lame_encode_flush(this.gfp,this.mp3buf,0,this.mp3buf_size)}catch(e){console.error("Error during LAME close/flush:",e)}this.gfp=null}}};
//!protection_bit
//# sourceMappingURL=index.cjs.map